"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[970],{8970:(e,l,a)=>{a.r(l),a.d(l,{default:()=>O});var o=a(9835),t=a(6970),n=a(1957),i=a(499),s=a(1569),u=a(9876);const d=(0,o._)("div",{class:"flex items-center justify-between q-mb-md"},[(0,o._)("p",{class:"no-margin text-h6 text-bold"},"Задачи")],-1),p={class:"row q-col-gutter-md"},r={class:"col-12 col-md-9"},c={class:"row items-center justify-end"},m={class:"col-12 col-md-3"},_={class:"text-bold"},w={key:0},v={key:1},b={key:2},g={key:3},f={class:"q-gutter-md"},k=(0,o._)("br",null,null,-1),y={key:0},W=(0,o._)("br",null,null,-1),x=(0,o._)("p",null,"Комментарий к задаче",-1),h={__name:"admin_tasks",setup(e){const l=(0,u.E)(),a=((0,i.iH)(null),(0,i.iH)(!1),(0,i.iH)([])),h=(0,i.iH)([]),q=(0,i.iH)({user__id:null,is_done:!1,dead_line_date__exact:null}),Q=(0,i.iH)(""),V=(0,i.iH)(5),Z=(0,i.iH)(1),U=(0,i.iH)(!1),j={sortBy:"desc",descending:!1,page:1,rowsPerPage:25},C=[{name:"priority",align:"left",label:"Приоритет",field:e=>e.priority,sortable:!0},{name:"user",align:"left",label:"Пользователь",field:e=>e.user?.fio,sortable:!0},{name:"task",align:"left",label:"Задача",field:e=>e.task,sortable:!0},{name:"is_done",align:"left",label:"Выполнено",field:e=>e.is_done,sortable:!0},{name:"is_repeatable",align:"left",label:"Ежедневная",field:e=>e.is_repeatable,sortable:!0},{name:"dead_line",align:"left",label:"Дата",field:e=>new Date(e.dead_line_date).toLocaleDateString(),sortable:!0},{name:"dead_line_time",align:"left",label:"Время",field:e=>e.dead_line_time,sortable:!0}];(0,o.wF)((async()=>{await D();const e=await l.getUsers();a.value=e}));const D=async()=>{U.value=!U.value;const e=await(0,s.api)(`/api/form/task?admin=true&page=${Z.value}&${Q.value}`);h.value=e.data.results,V.value=Math.ceil(e.data.count/15),U.value=!U.value},z=async e=>{await s.api.patch(`/api/form/task/${e.id}`,{result_comment:e.result_comment}),await D()},H=(e,l)=>{l((async()=>{e&&(U.value=!U.value,U.value=!U.value)}))},P=async()=>{console.log(Z.value),await D()},I=async e=>{if(Q.value="",q.value.is_done||(Q.value=""),"apply"===e)for(let[l,a]of Object.entries(q.value))console.log(l,a),a&&(Q.value+=`${l}=${a}&`);"clear"===e&&(Q.value="",q.value={user__id:null,is_done:!1,dead_line_date__exact:null}),await D()};return(e,l)=>{const i=(0,o.up)("q-item-label"),s=(0,o.up)("q-item-section"),u=(0,o.up)("q-item"),Q=(0,o.up)("q-select"),D=(0,o.up)("q-btn"),T=(0,o.up)("q-date"),Y=(0,o.up)("q-popup-proxy"),$=(0,o.up)("q-icon"),F=(0,o.up)("q-input"),S=(0,o.up)("q-checkbox"),B=(0,o.up)("q-th"),M=(0,o.up)("q-tr"),K=(0,o.up)("q-td"),L=(0,o.up)("q-badge"),E=(0,o.up)("q-table"),O=(0,o.up)("q-pagination"),A=(0,o.up)("q-page"),G=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(A,{padding:""},{default:(0,o.w5)((()=>[d,(0,o._)("div",p,[(0,o._)("div",r,[(0,o.Wm)(Q,{class:"q-mb-xs",dense:"",outlined:"",modelValue:q.value.user__id,"onUpdate:modelValue":l[0]||(l[0]=e=>q.value.user__id=e),loading:U.value,options:a.value,"option-label":"fio",label:"Выберите пользователя","map-options":"","option-value":"id","emit-value":"","use-input":"",onFilter:H,"fill-input":"",clearable:""},{option:(0,o.w5)((e=>[(0,o.Wm)(u,(0,t.vs)((0,o.F4)(e.itemProps)),{default:(0,o.w5)((()=>[(0,o.Wm)(s,{side:""},{default:(0,o.w5)((()=>[(0,o.Wm)(i,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(e.opt.role?.name),1)])),_:2},1024),(0,o.Wm)(i,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)("Роль")])),_:1})])),_:2},1024),(0,o.Wm)(s,null,{default:(0,o.w5)((()=>[(0,o.Wm)(i,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(e.opt.fio),1)])),_:2},1024),(0,o.Wm)(i,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)("ФИО")])),_:1})])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","loading","options"]),(0,o.Wm)(F,{outlined:"",dense:"",modelValue:q.value.dead_line_date__exact,"onUpdate:modelValue":l[2]||(l[2]=e=>q.value.dead_line_date__exact=e),label:"Выполнить до",clearable:""},{append:(0,o.w5)((()=>[(0,o.Wm)($,{name:"event",class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(Y,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,o.w5)((()=>[(0,o.Wm)(T,{modelValue:q.value.dead_line_date__exact,"onUpdate:modelValue":l[1]||(l[1]=e=>q.value.dead_line_date__exact=e),mask:"YYYY-MM-DD"},{default:(0,o.w5)((()=>[(0,o._)("div",c,[(0,o.wy)((0,o.Wm)(D,{label:"Выбрать",color:"primary",flat:""},null,512),[[G]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(S,{label:"Выполнено",modelValue:q.value.is_done,"onUpdate:modelValue":l[3]||(l[3]=e=>q.value.is_done=e)},null,8,["modelValue"])]),(0,o._)("div",m,[(0,o.wy)((0,o.Wm)(D,{class:"q-mb-sm full-width",label:"Применить фильтр",color:"positive",onClick:l[4]||(l[4]=e=>I("apply")),unelevated:"","no-caps":""},null,512),[[G]]),(0,o.wy)((0,o.Wm)(D,{class:"full-width",label:"Сбросить фильтр",color:"dark",onClick:l[5]||(l[5]=e=>I("clear")),unelevated:"","no-caps":""},null,512),[[G]])])]),(0,o.Wm)(E,{flat:"",rows:h.value,columns:C,"row-key":"id","table-header-class":"table-header",pagination:j},{header:(0,o.w5)((e=>[(0,o.Wm)(M,{props:e,class:"bg-grey-2"},{default:(0,o.w5)((()=>[(0,o.Wm)(B,{"auto-width":""}),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.cols,(l=>((0,o.wg)(),(0,o.j4)(B,{key:l.name,props:e},{default:(0,o.w5)((()=>[(0,o._)("span",_,(0,t.zw)(l.label),1)])),_:2},1032,["props"])))),128)),(0,o.Wm)(B,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,o.w5)((l=>[(0,o.Wm)(M,{props:l},{default:(0,o.w5)((()=>[(0,o.Wm)(K,{"auto-width":""},{default:(0,o.w5)((()=>[(0,o.Wm)(D,{size:"sm",color:"accent",round:"",dense:"",onClick:e=>l.expand=!l.expand,icon:l.expand?"remove":"add"},null,8,["onClick","icon"])])),_:2},1024),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.cols,(e=>((0,o.wg)(),(0,o.j4)(K,{key:e.name,props:l},{default:(0,o.w5)((()=>["is_done"===e.name?((0,o.wg)(),(0,o.iD)("span",w,[e.value?((0,o.wg)(),(0,o.j4)($,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,o.wg)(),(0,o.j4)($,{key:1,name:"close",size:"20px",color:"negative"}))])):"is_repeatable"===e.name?((0,o.wg)(),(0,o.iD)("span",v,[e.value?((0,o.wg)(),(0,o.j4)($,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,o.wg)(),(0,o.j4)($,{key:1,name:"close",size:"20px",color:"negative"}))])):"priority"===e.name?((0,o.wg)(),(0,o.iD)("span",b,[1===e.value?((0,o.wg)(),(0,o.j4)(L,{key:0,color:"positive",label:"Низкий"})):2===e.value?((0,o.wg)(),(0,o.j4)(L,{key:1,color:"warning",label:"Средний"})):3===e.value?((0,o.wg)(),(0,o.j4)(L,{key:2,color:"negative",label:"Высокий"})):(0,o.kq)("",!0)])):((0,o.wg)(),(0,o.iD)("span",g,(0,t.zw)(e.value?.slice(0,25)+"..."),1))])),_:2},1032,["props"])))),128)),(0,o.Wm)(K,{"auto-width":""},{default:(0,o.w5)((()=>[(0,o._)("div",f,[(0,o.Wm)(D,{dense:"",color:"negative",icon:"delete",onClick:a=>e.deleteItem(l.row.id)},null,8,["onClick"])])])),_:2},1024)])),_:2},1032,["props"]),(0,o.wy)((0,o.Wm)(M,{props:l},{default:(0,o.w5)((()=>[(0,o.Wm)(K,{colspan:"100%"},{default:(0,o.w5)((()=>[(0,o._)("p",null,[(0,o.Uk)("Задача: "),k,(0,o.Uk)((0,t.zw)(l.row.task),1)]),l.row.is_done?((0,o.wg)(),(0,o.iD)("div",y,[(0,o._)("p",null,[(0,o.Uk)("Результат выполнения задачи "),W,(0,o.Uk)((0,t.zw)(l.row.result),1)]),x,(0,o.Wm)(F,{class:"q-mb-md",modelValue:l.row.result_comment,"onUpdate:modelValue":e=>l.row.result_comment=e,dense:"",type:"textarea",outlined:""},null,8,["modelValue","onUpdate:modelValue"]),(0,o.Wm)(D,{dense:"",color:"positive",icon:"save","no-caps":"",unelevated:"",label:"Сохранить",onClick:e=>z(l.row)},null,8,["onClick"])])):(0,o.kq)("",!0)])),_:2},1024)])),_:2},1032,["props"]),[[n.F8,l.expand]])])),_:1},8,["rows"]),(0,o.Wm)(O,{modelValue:Z.value,"onUpdate:modelValue":[l[6]||(l[6]=e=>Z.value=e),P],max:V.value,"max-pages":6,"direction-links":"","boundary-numbers":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])),_:1})}}};var q=a(9885),Q=a(136),V=a(8879),Z=a(6384),U=a(490),j=a(6749),C=a(3115),D=a(3119),z=a(2857),H=a(2765),P=a(2535),I=a(1006),T=a(1746),Y=a(1233),$=a(1682),F=a(7220),S=a(990),B=a(996),M=a(2146),K=a(9984),L=a.n(K);const E=h,O=E;L()(h,"components",{QPage:q.Z,QSpace:Q.Z,QBtn:V.Z,QSelect:Z.Z,QItem:U.Z,QItemSection:j.Z,QItemLabel:C.Z,QInput:D.Z,QIcon:z.Z,QPopupProxy:H.Z,QDate:P.Z,QCheckbox:I.Z,QTable:T.Z,QTr:Y.Z,QTh:$.Z,QTd:F.Z,QBadge:S.Z,QPagination:B.Z}),L()(h,"directives",{ClosePopup:M.Z})}}]);