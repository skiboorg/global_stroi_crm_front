"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[540],{5540:(e,l,a)=>{a.r(l),a.d(l,{default:()=>K});var n=a(9835),t=a(6970),o=a(499),u=a(1569),d=a(8550),i=a(1862),s=a(9876),m=a(4139),r=a(2637),c=a(8227),p=a(1375);const v={class:"flex items-center justify-between q-mb-md"},b=(0,n._)("p",{class:"no-margin text-h6 text-bold"},"Исходящие ",-1),f={class:"row q-col-gutter-md q-mb-md"},_={class:"col-12 col-md-10"},g={class:"col-12 col-md-2"},w={class:"text-bold"},h=["innerHTML"],q={class:"q-gutter-md"},V={key:0},W=["href"],k={__name:"outgoing",setup(e){(0,s.E)();const l=[{name:"inner_id",align:"left",label:"Номер",field:e=>e.inner_id,sortable:!0},{name:"name",align:"left",label:"Наименование",field:e=>e.name,sortable:!0},{name:"receiver",align:"left",label:"Получатель",field:e=>e.receiver,sortable:!0},{name:"send_method",align:"left",label:"Способ отправки",field:e=>e.send_method,sortable:!0},{name:"send_method",align:"left",label:"Трек-номер",field:e=>e.track_number,sortable:!0},{name:"executor_fio",align:"left",label:"Ф.И.О исполнителя ",field:e=>e.executor_fio,sortable:!0},{name:"send_date",align:"left",label:"Дата отправки",field:e=>new Date(e.send_date).toLocaleDateString(),sortable:!0},{name:"file",align:"left",label:"Файл",field:e=>e.file?`<a href="${e.file}" target="_blank">Открыть</a>`:"Нет",sortable:!0}],a=(0,o.iH)(!1),k=((0,o.iH)(!1),(0,o.iH)({}),(0,o.iH)(null),["Служба доставки","E-mail","ЭДО","Под роспись","Другое"]),y=(0,o.iH)({id:null,name:null,receiver:null,send_method:null,executor_fio:null,send_date:null,file:null,track_number:null}),Z={sortBy:"desc",descending:!1,page:1,rowsPerPage:15},x=(0,o.iH)(1),H=(0,o.iH)(!1),Q=(0,o.iH)([]),C=(0,o.iH)(5),D=(0,o.iH)(null),U=(0,o.iH)({q:""}),T=async()=>{console.log(x.value),await S()};(0,n.wF)((async()=>{await S()}));const S=async()=>{H.value=!H.value;const e=await(0,u.api)(`/api/catalog/outgoing?page=${x.value}&q=${U.value.q}`);Q.value=e.data.results,C.value=Math.ceil(e.data.count/15),H.value=!H.value},L=async e=>{await u.api.delete(`/api/catalog/outgoing/${e}`),await S()},P=e=>{e?(y.value=e,y.value.send_date=y.value.send_date?new Date(y.value.send_date).toLocaleDateString():null):y.value={id:null,name:null,receiver:null,send_method:null,executor_fio:null,send_date:null,track_number:null},a.value=!0},$=async()=>{let e,l=new FormData;delete y.value.file;for(let[a,n]of Object.entries(y.value))l.append(a,JSON.stringify(n));D.value&&l.append("file",D.value),e=y.value.id?await(0,u.api)({method:"put",url:`/api/catalog/outgoing/${y.value.id}`,data:l,headers:{"Content-Type":"multipart/form-data"}}):await(0,u.api)({method:"post",url:"/api/catalog/outgoing",data:l,headers:{"Content-Type":"multipart/form-data"}}),(0,r.d)(e.data.success?"positive":"negative",e.data.message),a.value=!1,D.value=null},j=e=>{y.value.send_date=new Date(e).toLocaleDateString()},F=async()=>{await S()};return(e,o)=>{const u=(0,n.up)("q-space"),s=(0,n.up)("q-input"),r=(0,n.up)("q-btn"),B=(0,n.up)("q-th"),M=(0,n.up)("q-tr"),Y=(0,n.up)("q-td"),z=(0,n.up)("q-table"),E=(0,n.up)("q-pagination"),K=(0,n.up)("q-page"),O=(0,n.up)("q-select"),A=(0,n.up)("q-file"),I=(0,n.up)("q-card-section"),J=(0,n.up)("q-card-actions"),N=(0,n.up)("q-form"),G=(0,n.up)("q-card"),R=(0,n.up)("q-dialog"),X=(0,n.Q2)("close-popup");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(K,{padding:""},{default:(0,n.w5)((()=>[(0,n.Wm)(p.Z),(0,n._)("div",v,[b,(0,n.Wm)(u),(0,n.Wm)(d.Z,{icon:"add",label:"Добавить",onClick:o[0]||(o[0]=e=>P(null))})]),(0,n._)("div",f,[(0,n._)("div",_,[(0,n.Wm)(s,{dense:"",modelValue:U.value.q,"onUpdate:modelValue":o[1]||(o[1]=e=>U.value.q=e),label:"Поиск по названию, номеру, получателю, исполнителю",outlined:""},null,8,["modelValue"])]),(0,n._)("div",g,[(0,n.Wm)(r,{class:"full-width",label:"Найти","no-caps":"",color:"primary",unelevated:"",onClick:S})])]),(0,n.Wm)(z,{flat:"",rows:Q.value,columns:l,"row-key":"name","hide-pagination":"",pagination:Z,"onUpdate:pagination":o[2]||(o[2]=e=>Z=e),loading:H.value,"table-header-class":"table-header"},{header:(0,n.w5)((e=>[(0,n.Wm)(M,{props:e,class:"bg-grey-2"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.cols,(l=>((0,n.wg)(),(0,n.j4)(B,{key:l.name,props:e},{default:(0,n.w5)((()=>[(0,n._)("span",w,(0,t.zw)(l.label),1)])),_:2},1032,["props"])))),128)),(0,n.Wm)(B,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,n.w5)((e=>[(0,n.Wm)(M,{props:e},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.cols,(l=>((0,n.wg)(),(0,n.j4)(Y,{key:l.name,props:e},{default:(0,n.w5)((()=>[(0,n._)("span",{innerHTML:l.value},null,8,h)])),_:2},1032,["props"])))),128)),(0,n.Wm)(Y,{"auto-width":""},{default:(0,n.w5)((()=>[(0,n._)("div",q,[(0,n.Wm)(i.Z,{dense:"",onClick:l=>P(e.row)},null,8,["onClick"]),(0,n.Wm)(c.Z,{onConfirm:l=>L(e.row.id)},null,8,["onConfirm"])])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","loading"]),(0,n.Wm)(E,{modelValue:x.value,"onUpdate:modelValue":[o[3]||(o[3]=e=>x.value=e),T],max:C.value,"max-pages":6,"direction-links":"","boundary-numbers":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])),_:1}),(0,n.Wm)(R,{modelValue:a.value,"onUpdate:modelValue":o[11]||(o[11]=e=>a.value=e),onBeforeHide:F},{default:(0,n.w5)((()=>[(0,n.Wm)(G,{style:{width:"700px","max-width":"100vw"}},{default:(0,n.w5)((()=>[(0,n.Wm)(N,{onSubmit:$},{default:(0,n.w5)((()=>[(0,n.Wm)(I,{class:"q-pb-none"},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{outlined:"",dense:"",label:"Наименование и содержание документа",modelValue:y.value.name,"onUpdate:modelValue":o[4]||(o[4]=e=>y.value.name=e),"lazy-rules":"",rules:[e=>null!==e&&""!==e||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,n.Wm)(s,{class:"q-mb-md",outlined:"",dense:"",label:"Получатель",modelValue:y.value.receiver,"onUpdate:modelValue":o[5]||(o[5]=e=>y.value.receiver=e)},null,8,["modelValue"]),(0,n.Wm)(m.Z,{dense:"",class:"q-mb-md",modelValue:y.value.send_date,"onUpdate:modelValue":o[6]||(o[6]=e=>y.value.send_date=e),label:"Дата отправки",onSelected:j},null,8,["modelValue"]),(0,n.Wm)(O,{outlined:"",dense:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:y.value.send_method,"onUpdate:modelValue":o[7]||(o[7]=e=>y.value.send_method=e),options:k,label:"Способ отправки"},null,8,["modelValue"]),(0,n.Wm)(s,{class:"q-mb-md",outlined:"",dense:"",label:"Ф.И.О исполнителя ",modelValue:y.value.executor_fio,"onUpdate:modelValue":o[8]||(o[8]=e=>y.value.executor_fio=e)},null,8,["modelValue"]),(0,n.Wm)(s,{class:"q-mb-md",outlined:"",dense:"",label:"Трек-номер ",modelValue:y.value.track_number,"onUpdate:modelValue":o[9]||(o[9]=e=>y.value.track_number=e)},null,8,["modelValue"]),y.value.file?((0,n.wg)(),(0,n.iD)("p",V,[(0,n._)("a",{href:y.value.file,target:"_blank"},"Загруженный ранее файл",8,W)])):(0,n.kq)("",!0),(0,n.Wm)(A,{class:"q-mb-md",outlined:"",dense:"",label:"Файл",modelValue:D.value,"onUpdate:modelValue":o[10]||(o[10]=e=>D.value=e)},null,8,["modelValue"])])),_:1}),(0,n.Wm)(J,{align:"center"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{label:"Сохранить",type:"submit","no-caps":"",color:"positive"}),(0,n.wy)((0,n.Wm)(r,{label:"Отмена","no-caps":"",color:"dark"},null,512),[[X]])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var y=a(9885),Z=a(136),x=a(3119),H=a(8879),Q=a(1746),C=a(1233),D=a(1682),U=a(7220),T=a(996),S=a(2074),L=a(4458),P=a(8326),$=a(3190),j=a(6384),F=a(3837),B=a(1821),M=a(2146),Y=a(9984),z=a.n(Y);const E=k,K=E;z()(k,"components",{QPage:y.Z,QSpace:Z.Z,QInput:x.Z,QBtn:H.Z,QTable:Q.Z,QTr:C.Z,QTh:D.Z,QTd:U.Z,QPagination:T.Z,QDialog:S.Z,QCard:L.Z,QForm:P.Z,QCardSection:$.Z,QSelect:j.Z,QFile:F.Z,QCardActions:B.Z}),z()(k,"directives",{ClosePopup:M.Z})}}]);