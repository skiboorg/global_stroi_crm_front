"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[949],{9949:(e,a,l)=>{l.r(a),l.d(a,{default:()=>I});var t=l(9835),o=l(6970),n=l(499),i=l(1569),s=l(9876);const u=(0,t._)("div",{class:"flex items-center justify-between q-mb-md"},[(0,t._)("p",{class:"no-margin text-h6 text-bold"},"Журнал событий")],-1),d={class:"row q-col-gutter-md q-mb-md"},p={class:"col-12 col-md-6"},r={class:"row items-center justify-end"},c={class:"col-12 col-md-6"},m={class:"text-bold"},_={__name:"history",setup(e){const a=(0,s.E)(),l=(0,n.iH)([]),_=(0,n.iH)([]),w=[{name:"id",align:"left",label:"ID",field:e=>e.id,sortable:!0},{name:"user",align:"left",label:"Пользователь",field:e=>e.user.fio,sortable:!0},{name:"created_at_date",align:"left",label:"Дата",field:e=>new Date(e.created_at_date).toLocaleDateString(),sortable:!0},{name:"created_at_time",align:"left",label:"Время",field:e=>e.created_at_time?.split(".")[0],sortable:!0},{name:"event",align:"left",label:"Заполнена",field:e=>e.event,sortable:!0}],v=(0,n.iH)({user_id:null,created_at_date:null}),f=(0,n.iH)(1),b=(0,n.iH)(!1),g=(0,n.iH)(""),y=(0,n.iH)({sortBy:"desc",descending:!1,page:1,rowsPerPage:30}),q=(0,n.iH)(5),h=async()=>{await W()};(0,t.wF)((async()=>{const e=await a.getUsers();_.value=e,await W()}));const W=async()=>{b.value=!b.value;const e=await(0,i.api)(`/api/user/history?all=true&page=${f.value}&${g.value}`);l.value=e.data.results,q.value=Math.ceil(e.data.count/30),b.value=!b.value},k=async e=>{if(g.value="","apply"===e)for(let[a,l]of Object.entries(v.value))console.log(a,l),l&&(g.value+=`${a}=${l}&`);"clear"===e&&(g.value="",v.value={user_id:null,created_at_date:null}),await W()};return(e,a)=>{const n=(0,t.up)("q-item-label"),i=(0,t.up)("q-item-section"),s=(0,t.up)("q-item"),g=(0,t.up)("q-select"),W=(0,t.up)("q-btn"),Q=(0,t.up)("q-date"),Z=(0,t.up)("q-popup-proxy"),x=(0,t.up)("q-icon"),V=(0,t.up)("q-input"),H=(0,t.up)("q-th"),U=(0,t.up)("q-tr"),D=(0,t.up)("q-td"),P=(0,t.up)("q-table"),j=(0,t.up)("q-pagination"),I=(0,t.up)("q-page"),T=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(I,{padding:""},{default:(0,t.w5)((()=>[u,(0,t._)("div",d,[(0,t._)("div",p,[(0,t.Wm)(g,{class:"q-mb-xs",dense:"",outlined:"",modelValue:v.value.user_id,"onUpdate:modelValue":a[0]||(a[0]=e=>v.value.user_id=e),loading:b.value,options:_.value,"option-label":"fio",label:"Выберите пользователя","map-options":"","option-value":"id","emit-value":"","use-input":""},{option:(0,t.w5)((e=>[(0,t.Wm)(s,(0,o.vs)((0,t.F4)(e.itemProps)),{default:(0,t.w5)((()=>[(0,t.Wm)(i,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)(n,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.opt.role?.name),1)])),_:2},1024),(0,t.Wm)(n,{caption:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Роль")])),_:1})])),_:2},1024),(0,t.Wm)(i,null,{default:(0,t.w5)((()=>[(0,t.Wm)(n,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.opt.fio),1)])),_:2},1024),(0,t.Wm)(n,{caption:""},{default:(0,t.w5)((()=>[(0,t.Uk)("ФИО")])),_:1})])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","loading","options"]),(0,t.Wm)(V,{outlined:"",dense:"",modelValue:v.value.created_at_date,"onUpdate:modelValue":a[2]||(a[2]=e=>v.value.created_at_date=e),label:"Дата"},{append:(0,t.w5)((()=>[(0,t.Wm)(x,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(Q,{modelValue:v.value.created_at_date,"onUpdate:modelValue":a[1]||(a[1]=e=>v.value.created_at_date=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",r,[(0,t.wy)((0,t.Wm)(W,{label:"Выбрать",color:"primary",flat:""},null,512),[[T]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,t._)("div",c,[(0,t.wy)((0,t.Wm)(W,{class:"q-mb-sm full-width",label:"Применить фильтр",color:"positive",onClick:a[3]||(a[3]=e=>k("apply")),unelevated:"","no-caps":""},null,512),[[T]]),(0,t.wy)((0,t.Wm)(W,{class:"full-width",label:"Сбросить фильтр",color:"dark",onClick:a[4]||(a[4]=e=>k("clear")),unelevated:"","no-caps":""},null,512),[[T]])])]),(0,t.Wm)(P,{flat:"",rows:l.value,columns:w,"row-key":"name","table-header-class":"table-header","hide-pagination":"",pagination:y.value,"onUpdate:pagination":a[5]||(a[5]=e=>y.value=e),loading:b.value,class:"q-mb-md"},{header:(0,t.w5)((e=>[(0,t.Wm)(U,{props:e,class:"bg-grey-2"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(a=>((0,t.wg)(),(0,t.j4)(H,{key:a.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",m,(0,o.zw)(a.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,t.w5)((e=>[(0,t.Wm)(U,{props:e},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(a=>((0,t.wg)(),(0,t.j4)(D,{key:a.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",null,(0,o.zw)(a.value),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),_:1},8,["rows","pagination","loading"]),(0,t.Wm)(j,{modelValue:f.value,"onUpdate:modelValue":[a[6]||(a[6]=e=>f.value=e),h],max:q.value,"max-pages":6,"direction-links":"","boundary-numbers":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])),_:1})}}};var w=l(9885),v=l(6384),f=l(490),b=l(6749),g=l(3115),y=l(3119),q=l(2857),h=l(2765),W=l(2535),k=l(8879),Q=l(1746),Z=l(1233),x=l(1682),V=l(7220),H=l(996),U=l(2146),D=l(9984),P=l.n(D);const j=_,I=j;P()(_,"components",{QPage:w.Z,QSelect:v.Z,QItem:f.Z,QItemSection:b.Z,QItemLabel:g.Z,QInput:y.Z,QIcon:q.Z,QPopupProxy:h.Z,QDate:W.Z,QBtn:k.Z,QTable:Q.Z,QTr:Z.Z,QTh:x.Z,QTd:V.Z,QPagination:H.Z}),P()(_,"directives",{ClosePopup:U.Z})}}]);