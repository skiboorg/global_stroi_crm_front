"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[457],{2637:(l,e,a)=>{a.d(e,{d:()=>n});var o=a(6827),u=a(8346);function n(l,e){o.Z.create({message:e,html:!0,color:l,position:u.Z.lt.sm?"bottom":"bottom-right"})}},8550:(l,e,a)=>{a.d(e,{Z:()=>s});var o=a(9835);const u={__name:"AddButton",props:["label","icon","loading","color"],setup(l){return(e,a)=>{const u=(0,o.up)("q-btn");return e.auth.user.role?.permission?.can_add?((0,o.wg)(),(0,o.j4)(u,{key:0,"no-caps":"",unelevated:"",loading:l.loading,color:l.color?l.color:"primary",label:l.label,icon:l.icon?l.icon:"add"},null,8,["loading","color","label","icon"])):(0,o.kq)("",!0)}}};var n=a(8879),t=a(9984),d=a.n(t);const i=u,s=i;d()(u,"components",{QBtn:n.Z})},4139:(l,e,a)=>{a.d(e,{Z:()=>_});var o=a(9835),u=a(499);const n={class:"row items-center justify-end"},t={__name:"DateInput",props:["label"],emits:["selected"],setup(l,{emit:e}){const a=(0,u.iH)(null),t=(0,u.iH)(null);return(e,u)=>{const d=(0,o.up)("q-btn"),i=(0,o.up)("q-date"),s=(0,o.up)("q-popup-proxy"),m=(0,o.up)("q-icon"),r=(0,o.up)("q-input"),p=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(r,{outlined:"",modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=l=>a.value=l),label:l.label},{append:(0,o.w5)((()=>[(0,o.Wm)(m,{name:"event",class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(s,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,o.w5)((()=>[(0,o.Wm)(i,{modelValue:t.value,"onUpdate:modelValue":u[1]||(u[1]=l=>t.value=l),mask:"YYYY-MM-DD"},{default:(0,o.w5)((()=>[(0,o._)("div",n,[(0,o.wy)((0,o.Wm)(d,{onClick:u[0]||(u[0]=l=>e.$emit("selected",t.value)),label:"Выбрать",color:"primary",flat:""},null,512),[[p]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","label"])}}};var d=a(3119),i=a(2857),s=a(2765),m=a(2535),r=a(8879),p=a(2146),c=a(9984),v=a.n(c);const w=t,_=w;v()(t,"components",{QInput:d.Z,QIcon:i.Z,QPopupProxy:s.Z,QDate:m.Z,QBtn:r.Z}),v()(t,"directives",{ClosePopup:p.Z})},8227:(l,e,a)=>{a.d(e,{Z:()=>w});var o=a(9835),u=a(499);const n={__name:"DeleteButton",props:["label","icon","loading","color"],emits:["confirm"],setup(l,{emit:e}){const a=(0,u.iH)(!1);return(e,u)=>{const n=(0,o.up)("q-btn"),t=(0,o.up)("q-card-section"),d=(0,o.up)("q-card-actions"),i=(0,o.up)("q-card"),s=(0,o.up)("q-dialog"),m=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)(o.HY,null,[e.auth.user.role?.permission?.can_add?((0,o.wg)(),(0,o.j4)(n,{key:0,"no-caps":"",unelevated:"",dense:"",loading:l.loading,color:l.color?l.color:"negative",label:l.label,onClick:u[0]||(u[0]=l=>a.value=!0),icon:l.icon?l.icon:"delete"},null,8,["loading","color","label","icon"])):(0,o.kq)("",!0),(0,o.Wm)(s,{modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=l=>a.value=l)},{default:(0,o.w5)((()=>[(0,o.Wm)(i,{style:{width:"300px","max-width":"100vw"}},{default:(0,o.w5)((()=>[(0,o.Wm)(t,{class:"text-center text-bold"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Вы уверены? ")])),_:1}),(0,o.Wm)(d,{align:"center"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(n,{color:"negative",unelevated:"","no-caps":"",label:"Да",onClick:u[1]||(u[1]=l=>e.$emit("confirm"))},null,512),[[m]]),(0,o.wy)((0,o.Wm)(n,{color:"positive",unelevated:"","no-caps":"",label:"Нет"},null,512),[[m]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var t=a(8879),d=a(2074),i=a(4458),s=a(3190),m=a(1821),r=a(2146),p=a(9984),c=a.n(p);const v=n,w=v;c()(n,"components",{QBtn:t.Z,QDialog:d.Z,QCard:i.Z,QCardSection:s.Z,QCardActions:m.Z}),c()(n,"directives",{ClosePopup:r.Z})},1862:(l,e,a)=>{a.d(e,{Z:()=>s});var o=a(9835);const u={__name:"EditButton",props:["label","icon","color"],setup(l){return(e,a)=>{const u=(0,o.up)("q-btn");return e.auth.user.role?.permission?.can_edit?((0,o.wg)(),(0,o.j4)(u,{key:0,"no-caps":"",unelevated:"",color:l.color,label:l.label,icon:l.icon?l.icon:"edit"},null,8,["color","label","icon"])):(0,o.kq)("",!0)}}};var n=a(8879),t=a(9984),d=a.n(t);const i=u,s=i;d()(u,"components",{QBtn:n.Z})},9457:(l,e,a)=>{a.r(e),a.d(e,{default:()=>J});var o=a(9835),u=a(6970),n=a(499),t=a(1569),d=a(8550),i=a(1862),s=a(9876),m=a(4139),r=a(2637),p=a(8227);const c={class:"flex items-center justify-between q-mb-md"},v=(0,o._)("p",{class:"no-margin text-h6 text-bold"},"Поставщики ",-1),w={class:"row q-col-gutter-md q-mb-md"},_={class:"col-12 col-md-10"},f={class:"col-12 col-md-2"},g={class:"text-bold"},b={class:"q-gutter-md"},W={key:2},k=["href"],q=["href"],V=["href"],h={__name:"suppliers",setup(l){(0,s.E)();const e=[{name:"name",align:"left",label:"Наименование поставщика",field:l=>l.name,sortable:!0},{name:"inn",align:"left",label:"ИНН",field:l=>l.inn,sortable:!0},{name:"phone",align:"left",label:"Телефон",field:l=>l.phone,sortable:!0}],a=(0,n.iH)(!1),h=(0,n.iH)(!1),y=(0,n.iH)({}),Z=((0,n.iH)(null),["Разовый","Нет"]),U=(0,n.iH)({id:null,name:null,inn:null,fio:null,phone:null,email:null,have_dogovor:!1,dogovor_date:null,dogovor_type:null,store_address:null,goods_features:null,link:null}),Q={sortBy:"desc",descending:!1,page:1,rowsPerPage:15},C=(0,n.iH)(1),x=(0,n.iH)(!1),D=(0,n.iH)([]),H=(0,n.iH)(5),z=(0,n.iH)(null),j=(0,n.iH)({q:""}),S=async()=>{console.log(C.value),await B()};(0,o.wF)((async()=>{await B()}));const B=async()=>{x.value=!x.value;const l=await(0,t.api)(`/api/catalog/supplier?page=${C.value}&q=${j.value.q}`);D.value=l.data.results,H.value=Math.ceil(l.data.count/15),x.value=!x.value},P=async l=>{await t.api.delete(`/api/catalog/supplier/${l}`),await B()},T=l=>{l?(U.value=l,U.value.dogovor_date=U.value.dogovor_date?new Date(U.value.dogovor_date).toLocaleDateString():null):U.value={id:null,name:null,inn:null,fio:null,phone:null,email:null,have_dogovor:!1,dogovor_date:null,dogovor_type:null,store_address:null,goods_features:null,link:null},a.value=!0},Y=async()=>{let l=new FormData;delete U.value.file;for(let[e,a]of Object.entries(U.value))l.append(e,JSON.stringify(a));if(z.value&&l.append("file",z.value),U.value.id){const e=await(0,t.api)({method:"put",url:`/api/catalog/supplier/${U.value.id}`,data:l,headers:{"Content-Type":"multipart/form-data"}});console.log(e.data),await B(),(0,r.d)("positive","Поставщик успешно обновлен")}else{await(0,t.api)({method:"post",url:"/api/catalog/supplier",data:l,headers:{"Content-Type":"multipart/form-data"}});(0,r.d)("positive","Поставщик успешно создан"),await B()}a.value=!1},I=l=>{U.value.dogovor_date=new Date(l).toLocaleDateString()};return(l,n)=>{const t=(0,o.up)("q-space"),s=(0,o.up)("q-input"),r=(0,o.up)("q-btn"),$=(0,o.up)("q-th"),F=(0,o.up)("q-tr"),L=(0,o.up)("q-td"),A=(0,o.up)("q-table"),M=(0,o.up)("q-pagination"),E=(0,o.up)("q-page"),K=(0,o.up)("q-checkbox"),O=(0,o.up)("q-select"),J=(0,o.up)("q-file"),N=(0,o.up)("q-card-section"),G=(0,o.up)("q-card-actions"),R=(0,o.up)("q-form"),X=(0,o.up)("q-card"),ll=(0,o.up)("q-dialog"),el=(0,o.up)("q-item-section"),al=(0,o.up)("q-item"),ol=(0,o.up)("q-list"),ul=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(E,{padding:""},{default:(0,o.w5)((()=>[(0,o._)("div",c,[v,(0,o.Wm)(t),(0,o.Wm)(d.Z,{icon:"add",label:"Добавить поставщика",onClick:n[0]||(n[0]=l=>T(null))})]),(0,o._)("div",w,[(0,o._)("div",_,[(0,o.Wm)(s,{dense:"",modelValue:j.value.q,"onUpdate:modelValue":n[1]||(n[1]=l=>j.value.q=l),label:"Поиск по наименованию, инн, фио, телефону",outlined:""},null,8,["modelValue"])]),(0,o._)("div",f,[(0,o.Wm)(r,{class:"full-width",label:"Найти","no-caps":"",color:"primary",unelevated:"",onClick:B})])]),(0,o.Wm)(A,{flat:"",rows:D.value,columns:e,"row-key":"name","hide-pagination":"",pagination:Q,"onUpdate:pagination":n[2]||(n[2]=l=>Q=l),loading:x.value,"table-header-class":"table-header"},{header:(0,o.w5)((l=>[(0,o.Wm)(F,{props:l,class:"bg-grey-2"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.cols,(e=>((0,o.wg)(),(0,o.j4)($,{key:e.name,props:l},{default:(0,o.w5)((()=>[(0,o._)("span",g,(0,u.zw)(e.label),1)])),_:2},1032,["props"])))),128)),(0,o.Wm)($,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,o.w5)((l=>[(0,o.Wm)(F,{props:l},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.cols,(e=>((0,o.wg)(),(0,o.j4)(L,{key:e.name,onClick:e=>(y.value=l.row,h.value=!0),props:l},{default:(0,o.w5)((()=>[(0,o._)("span",null,(0,u.zw)(e.value),1)])),_:2},1032,["onClick","props"])))),128)),(0,o.Wm)(L,{"auto-width":""},{default:(0,o.w5)((()=>[(0,o._)("div",b,[(0,o.Wm)(i.Z,{dense:"",onClick:e=>T(l.row)},null,8,["onClick"]),(0,o.Wm)(p.Z,{onConfirm:e=>P(l.row.id)},null,8,["onConfirm"])])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","loading"]),(0,o.Wm)(M,{modelValue:C.value,"onUpdate:modelValue":[n[3]||(n[3]=l=>C.value=l),S],max:H.value,"max-pages":6,"direction-links":"","boundary-numbers":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])),_:1}),(0,o.Wm)(ll,{modelValue:a.value,"onUpdate:modelValue":n[16]||(n[16]=l=>a.value=l)},{default:(0,o.w5)((()=>[(0,o.Wm)(X,{style:{width:"700px","max-width":"100vw"}},{default:(0,o.w5)((()=>[(0,o.Wm)(R,{onSubmit:Y},{default:(0,o.w5)((()=>[(0,o.Wm)(N,{class:"q-pb-none"},{default:(0,o.w5)((()=>[(0,o.Wm)(s,{outlined:"",dense:"",label:"Наименование",modelValue:U.value.name,"onUpdate:modelValue":n[4]||(n[4]=l=>U.value.name=l),"lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,o.Wm)(s,{outlined:"",dense:"",label:"ИНН",modelValue:U.value.inn,"onUpdate:modelValue":n[5]||(n[5]=l=>U.value.inn=l),"lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,o.Wm)(s,{class:"q-mb-md",outlined:"",dense:"",label:"ФИО",modelValue:U.value.fio,"onUpdate:modelValue":n[6]||(n[6]=l=>U.value.fio=l)},null,8,["modelValue"]),(0,o.Wm)(s,{class:"q-mb-md",outlined:"",dense:"",label:"Телефон",mask:"+7 (###) ###-##-##","fill-mask":"",modelValue:U.value.phone,"onUpdate:modelValue":n[7]||(n[7]=l=>U.value.phone=l)},null,8,["modelValue"]),(0,o.Wm)(s,{class:"q-mb-md",outlined:"",dense:"",label:"Почта",modelValue:U.value.email,"onUpdate:modelValue":n[8]||(n[8]=l=>U.value.email=l)},null,8,["modelValue"]),(0,o.Wm)(s,{class:"q-mb-md",outlined:"",dense:"",label:"Ссылка",modelValue:U.value.link,"onUpdate:modelValue":n[9]||(n[9]=l=>U.value.link=l)},null,8,["modelValue"]),(0,o.Wm)(K,{class:"q-mb-md",label:"Есть договор",modelValue:U.value.have_dogovor,"onUpdate:modelValue":n[10]||(n[10]=l=>U.value.have_dogovor=l)},null,8,["modelValue"]),U.value.have_dogovor?((0,o.wg)(),(0,o.j4)(m.Z,{key:0,dense:"",class:"q-mb-md",modelValue:U.value.dogovor_date,"onUpdate:modelValue":n[11]||(n[11]=l=>U.value.dogovor_date=l),label:"Дата заключения",onSelected:I},null,8,["modelValue"])):(0,o.kq)("",!0),U.value.have_dogovor?((0,o.wg)(),(0,o.j4)(O,{key:1,outlined:"",dense:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:U.value.dogovor_type,"onUpdate:modelValue":n[12]||(n[12]=l=>U.value.dogovor_type=l),options:Z,label:"Тип договора"},null,8,["modelValue"])):(0,o.kq)("",!0),(0,o.Wm)(s,{class:"q-mb-md",type:"textarea",outlined:"",dense:"",label:"Адрес склада для самовывоза",modelValue:U.value.store_address,"onUpdate:modelValue":n[13]||(n[13]=l=>U.value.store_address=l)},null,8,["modelValue"]),(0,o.Wm)(s,{class:"q-mb-md",type:"textarea",outlined:"",dense:"",label:"Особенности получения грузов",modelValue:U.value.goods_features,"onUpdate:modelValue":n[14]||(n[14]=l=>U.value.goods_features=l)},null,8,["modelValue"]),U.value.file?((0,o.wg)(),(0,o.iD)("p",W,[(0,o._)("a",{href:U.value.file,target:"_blank"},"Загруженный ранее файл",8,k)])):(0,o.kq)("",!0),(0,o.Wm)(J,{class:"q-mb-md",outlined:"",dense:"",label:"Файл",modelValue:z.value,"onUpdate:modelValue":n[15]||(n[15]=l=>z.value=l)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(G,{align:"center"},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{label:"Сохранить",type:"submit","no-caps":"",color:"positive"}),(0,o.wy)((0,o.Wm)(r,{label:"Отмена","no-caps":"",color:"dark"},null,512),[[ul]])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(ll,{modelValue:h.value,"onUpdate:modelValue":n[17]||(n[17]=l=>h.value=l)},{default:(0,o.w5)((()=>[(0,o.Wm)(X,{style:{width:"700px","max-width":"100vw"}},{default:(0,o.w5)((()=>[(0,o.Wm)(N,null,{default:(0,o.w5)((()=>[(0,o.Wm)(ol,{separator:""},{default:(0,o.w5)((()=>[(0,o.Wm)(al,null,{default:(0,o.w5)((()=>[(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Наименование")])),_:1}),(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,u.zw)(y.value.name),1)])),_:1})])),_:1}),(0,o.Wm)(al,null,{default:(0,o.w5)((()=>[(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)("ИНН")])),_:1}),(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,u.zw)(y.value.inn),1)])),_:1})])),_:1}),(0,o.Wm)(al,null,{default:(0,o.w5)((()=>[(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)("ФИО")])),_:1}),(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,u.zw)(y.value.fio),1)])),_:1})])),_:1}),(0,o.Wm)(al,null,{default:(0,o.w5)((()=>[(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Телефон")])),_:1}),(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,u.zw)(y.value.phone),1)])),_:1})])),_:1}),(0,o.Wm)(al,null,{default:(0,o.w5)((()=>[(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Почта")])),_:1}),(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,u.zw)(y.value.email),1)])),_:1})])),_:1}),(0,o.Wm)(al,null,{default:(0,o.w5)((()=>[(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Наличие договора")])),_:1}),(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,u.zw)(y.value.have_dogovor),1)])),_:1})])),_:1}),(0,o.Wm)(al,null,{default:(0,o.w5)((()=>[(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Дата заключения")])),_:1}),(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,u.zw)(new Date(y.value.dogovor_date).toLocaleDateString()),1)])),_:1})])),_:1}),(0,o.Wm)(al,null,{default:(0,o.w5)((()=>[(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Тип договора")])),_:1}),(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,u.zw)(y.value.dogovor_type),1)])),_:1})])),_:1}),(0,o.Wm)(al,null,{default:(0,o.w5)((()=>[(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Адрес склада для самовывоза")])),_:1}),(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,u.zw)(y.value.store_address),1)])),_:1})])),_:1}),(0,o.Wm)(al,null,{default:(0,o.w5)((()=>[(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Особенности получения грузов")])),_:1}),(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,u.zw)(y.value.goods_features),1)])),_:1})])),_:1}),(0,o.Wm)(al,null,{default:(0,o.w5)((()=>[(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Ссылка")])),_:1}),(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[y.value.link?((0,o.wg)(),(0,o.iD)("a",{key:0,href:y.value.link,target:"_blank"},"Открыть",8,q)):(0,o.kq)("",!0)])),_:1})])),_:1}),(0,o.Wm)(al,null,{default:(0,o.w5)((()=>[(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Файл")])),_:1}),(0,o.Wm)(el,null,{default:(0,o.w5)((()=>[y.value.file?((0,o.wg)(),(0,o.iD)("a",{key:0,href:y.value.file,target:"_blank"},"Открыть",8,V)):(0,o.kq)("",!0)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var y=a(9885),Z=a(136),U=a(3119),Q=a(8879),C=a(1746),x=a(1233),D=a(1682),H=a(7220),z=a(996),j=a(2074),S=a(4458),B=a(8326),P=a(3190),T=a(1006),Y=a(6384),I=a(9420),$=a(1821),F=a(3246),L=a(490),A=a(6749),M=a(2146),E=a(9984),K=a.n(E);const O=h,J=O;K()(h,"components",{QPage:y.Z,QSpace:Z.Z,QInput:U.Z,QBtn:Q.Z,QTable:C.Z,QTr:x.Z,QTh:D.Z,QTd:H.Z,QPagination:z.Z,QDialog:j.Z,QCard:S.Z,QForm:B.Z,QCardSection:P.Z,QCheckbox:T.Z,QSelect:Y.Z,QFile:I.Z,QCardActions:$.Z,QList:F.Z,QItem:L.Z,QItemSection:A.Z}),K()(h,"directives",{ClosePopup:M.Z})}}]);