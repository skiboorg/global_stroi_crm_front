"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[927],{2637:(e,l,a)=>{a.d(l,{d:()=>n});var o=a(6827),t=a(8346);function n(e,l){o.Z.create({message:l,html:!0,color:e,position:t.Z.lt.sm?"bottom":"bottom-right"})}},8550:(e,l,a)=>{a.d(l,{Z:()=>s});var o=a(9835);const t={__name:"AddButton",props:["label","icon","loading","color"],setup(e){return(l,a)=>{const t=(0,o.up)("q-btn");return l.auth.user.role?.permission?.can_add?((0,o.wg)(),(0,o.j4)(t,{key:0,"no-caps":"",unelevated:"",loading:e.loading,color:e.color?e.color:"primary",label:e.label,icon:e.icon?e.icon:"add"},null,8,["loading","color","label","icon"])):(0,o.kq)("",!0)}}};var n=a(8879),i=a(9984),u=a.n(i);const d=t,s=d;u()(t,"components",{QBtn:n.Z})},8227:(e,l,a)=>{a.d(l,{Z:()=>v});var o=a(9835),t=a(499);const n={__name:"DeleteButton",props:["label","icon","loading","color"],emits:["confirm"],setup(e,{emit:l}){const a=(0,t.iH)(!1);return(l,t)=>{const n=(0,o.up)("q-btn"),i=(0,o.up)("q-card-section"),u=(0,o.up)("q-card-actions"),d=(0,o.up)("q-card"),s=(0,o.up)("q-dialog"),m=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)(o.HY,null,[l.auth.user.role?.permission?.can_add?((0,o.wg)(),(0,o.j4)(n,{key:0,"no-caps":"",unelevated:"",dense:"",loading:e.loading,color:e.color?e.color:"negative",label:e.label,onClick:t[0]||(t[0]=e=>a.value=!0),icon:e.icon?e.icon:"delete"},null,8,["loading","color","label","icon"])):(0,o.kq)("",!0),(0,o.Wm)(s,{modelValue:a.value,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{style:{width:"300px","max-width":"100vw"}},{default:(0,o.w5)((()=>[(0,o.Wm)(i,{class:"text-center text-bold"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Вы уверены? ")])),_:1}),(0,o.Wm)(u,{align:"center"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(n,{color:"negative",unelevated:"","no-caps":"",label:"Да",onClick:t[1]||(t[1]=e=>l.$emit("confirm"))},null,512),[[m]]),(0,o.wy)((0,o.Wm)(n,{color:"positive",unelevated:"","no-caps":"",label:"Нет"},null,512),[[m]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var i=a(8879),u=a(2074),d=a(4458),s=a(3190),m=a(1821),r=a(2146),p=a(9984),c=a.n(p);const _=n,v=_;c()(n,"components",{QBtn:i.Z,QDialog:u.Z,QCard:d.Z,QCardSection:s.Z,QCardActions:m.Z}),c()(n,"directives",{ClosePopup:r.Z})},4762:(e,l,a)=>{a.r(l),a.d(l,{default:()=>we});var o=a(9835),t=a(6970),n=a(1957),i=a(499),u=a(1569),d=a(9876),s=a(8550),m=a(2637),r=a(8227);const p=(0,o._)("br",null,null,-1),c=(0,o._)("br",null,null,-1),_=(0,o._)("br",null,null,-1),v=(0,o._)("br",null,null,-1),w=(0,o._)("br",null,null,-1),b=(0,o._)("br",null,null,-1),g=(0,o._)("br",null,null,-1),f=(0,o._)("br",null,null,-1),k=(0,o._)("br",null,null,-1),y=(0,o._)("br",null,null,-1),W=(0,o._)("div",{class:"flex items-center justify-between q-mb-md"},[(0,o._)("p",{class:"no-margin text-h6 text-bold"},"Задачи")],-1),q={class:"row q-col-gutter-md q-mb-lg"},x={class:"col-12 col-md-9"},V={class:"row items-center justify-end"},h={class:"col-12 col-md-3"},Z={class:"text-bold"},Q={key:0},U={key:1},C={key:2},D={key:3,class:"no-margin ellipsis",style:{"max-width":"300px"}},j={class:"q-gutter-md"},H=(0,o._)("p",{class:"text-bold q-mb-sm"},"Задача:",-1),z={key:0},P=(0,o._)("p",{class:"text-bold q-mb-sm"},"Результат выполнения задачи",-1),S=(0,o._)("p",{class:"text-bold q-mb-sm"},"Оценка выполнения задачи",-1),$={class:"q-mt-md"},Y=(0,o._)("p",null,null,-1),B={class:"q-mb-md"},I={__name:"admin_tasks",setup(e){const l=(0,d.E)(),a=((0,i.iH)(null),(0,i.iH)([])),I=(0,i.iH)([]),T=(0,i.iH)(!1),F=["10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00"],M=[{label:"Низкий",value:1},{label:"Средний",value:2},{label:"Высокий",value:3}],L=(0,i.iH)({priority:1,task:null,dead_line_time:"20:00",is_repeatable:!1}),A=(0,i.iH)({user__id:null,is_done:!1,dead_line_date__exact:null}),E=(0,i.iH)(""),K=(0,i.iH)(5),O=(0,i.iH)(1),R=(0,i.iH)(!1),G={sortBy:"desc",descending:!1,page:1,rowsPerPage:25},J=[{name:"id",align:"left",label:"ID",field:e=>e.id,sortable:!0},{name:"priority",align:"left",label:"Приоритет",field:e=>e.priority,sortable:!0},{name:"user",align:"left",label:"Пользователь",field:e=>e.user?.fio,sortable:!0},{name:"task",align:"left",label:"Задача",field:e=>e.task,sortable:!0},{name:"is_done",align:"left",label:"Выполнено",field:e=>e.is_done,sortable:!0},{name:"is_repeatable",align:"left",label:"Ежедневная",field:e=>e.is_repeatable,sortable:!0},{name:"dead_line",align:"left",label:"Дата",field:e=>new Date(e.dead_line_date).toLocaleDateString(),sortable:!0},{name:"dead_line_time",align:"left",label:"Время",field:e=>e.dead_line_time,sortable:!0},{name:"task_value",align:"left",label:"Оценка",field:e=>e.task_value?e.task_value:"Нет",sortable:!0},{name:"user_comment",align:"left",label:"Обратная связь",field:e=>e.user_comment?e.user_comment:"Нет",sortable:!0}];(0,o.wF)((async()=>{await N();const e=await l.getUsers(null,!0);a.value=e}));const N=async()=>{R.value=!R.value;const e=await(0,u.api)(`/api/task/task?admin=true&page=${O.value}&${E.value}`);I.value=e.data.results,K.value=Math.ceil(e.data.count/15),R.value=!R.value},X=async e=>{await u.api.patch(`/api/task/task/${e.id}`,{task_value:e.task_value,admin_comment:e.admin_comment}),await N(),(0,m.d)("positive","Данные обновлены")},ee=(e,l)=>{l((async()=>{if(e){R.value=!R.value;const l=await(0,u.api)(`/api/user/user?q=${e}&page_size=10000`);a.value=l.data,R.value=!R.value}}))},le=async()=>{console.log(O.value),await N()},ae=async e=>{if(E.value="",A.value.is_done||(E.value=""),"apply"===e)for(let[l,a]of Object.entries(A.value))console.log(l,a),a&&(E.value+=`${l}=${a}&`);"clear"===e&&(E.value="",A.value={user__id:null,is_done:!1,dead_line_date__exact:null}),await N()},oe=async()=>{R.value=!R.value,L.value.user_id=A.value.user__id;await u.api.post("/api/task/task",L.value);(0,m.d)("positive","Задача добавлена"),L.value={priority:1,task:null,dead_line_time:"20:00",is_repeatable:!1},T.value=!1,await N(),R.value=!R.value},te=async e=>{R.value=!R.value;await u.api.delete(`/api/task/task/${e}`);await N(),R.value=!R.value};return(e,l)=>{const i=(0,o.up)("q-card-section"),u=(0,o.up)("q-card"),d=(0,o.up)("q-expansion-item"),m=(0,o.up)("q-item-label"),E=(0,o.up)("q-item-section"),N=(0,o.up)("q-item"),ne=(0,o.up)("q-select"),ie=(0,o.up)("q-btn"),ue=(0,o.up)("q-date"),de=(0,o.up)("q-popup-proxy"),se=(0,o.up)("q-icon"),me=(0,o.up)("q-input"),re=(0,o.up)("q-checkbox"),pe=(0,o.up)("q-th"),ce=(0,o.up)("q-tr"),_e=(0,o.up)("q-td"),ve=(0,o.up)("q-badge"),we=(0,o.up)("q-tooltip"),be=(0,o.up)("q-rating"),ge=(0,o.up)("q-table"),fe=(0,o.up)("q-pagination"),ke=(0,o.up)("q-page"),ye=(0,o.up)("q-form"),We=(0,o.up)("q-dialog"),qe=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(ke,{padding:""},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{"expand-separator":"",icon:"help",label:"Описание раздела",class:"q-mb-md"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(i,null,{default:(0,o.w5)((()=>[(0,o.Uk)(" Оценку задач осуществляет сотрудник организации с правами администратора системы."),p,c,(0,o.Uk)(" У каждого отдела компании в соответствии с организационной структурой есть руководитель."),_,v,(0,o.Uk)(" Оценка субъективная, руководитель должен объяснить почему он оценил выполнение вашей задачи именно так."),w,b,(0,o.Uk)(" После оценки у задачи появляется оценка по 5 (пяти) бальной шкале и комментарий к ней. "),g,f,(0,o.Uk)(" Система автоматически, после выставления оценки, в раздел обратная связь выставляет комментарий пользователя – Согласен. "),k,y,(0,o.Uk)(" Пользователь на конкретной задаче может изменить обратную связь на - не согласен, надо обсудить. ")])),_:1})])),_:1})])),_:1}),W,(0,o._)("div",q,[(0,o._)("div",x,[(0,o.Wm)(ne,{class:"q-mb-xs",dense:"",outlined:"",modelValue:A.value.user__id,"onUpdate:modelValue":l[0]||(l[0]=e=>A.value.user__id=e),loading:R.value,options:a.value,"option-label":"fio",label:"Выберите пользователя","map-options":"","option-value":"id","emit-value":"","use-input":"",onFilter:ee,clearable:""},{option:(0,o.w5)((e=>[(0,o.Wm)(N,(0,t.vs)((0,o.F4)(e.itemProps)),{default:(0,o.w5)((()=>[(0,o.Wm)(E,{side:""},{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(e.opt.role?.name),1)])),_:2},1024),(0,o.Wm)(m,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)("Роль")])),_:1})])),_:2},1024),(0,o.Wm)(E,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(e.opt.fio),1)])),_:2},1024),(0,o.Wm)(m,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)("ФИО")])),_:1})])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","loading","options"]),(0,o.Wm)(me,{outlined:"",dense:"",modelValue:A.value.dead_line_date__exact,"onUpdate:modelValue":l[2]||(l[2]=e=>A.value.dead_line_date__exact=e),label:"Выполнить до",clearable:""},{append:(0,o.w5)((()=>[(0,o.Wm)(se,{name:"event",class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(de,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,o.w5)((()=>[(0,o.Wm)(ue,{modelValue:A.value.dead_line_date__exact,"onUpdate:modelValue":l[1]||(l[1]=e=>A.value.dead_line_date__exact=e),mask:"YYYY-MM-DD"},{default:(0,o.w5)((()=>[(0,o._)("div",V,[(0,o.wy)((0,o.Wm)(ie,{label:"Выбрать",color:"primary",flat:""},null,512),[[qe]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(re,{label:"Выполнено",modelValue:A.value.is_done,"onUpdate:modelValue":l[3]||(l[3]=e=>A.value.is_done=e)},null,8,["modelValue"])]),(0,o._)("div",h,[(0,o.wy)((0,o.Wm)(ie,{class:"q-mb-sm full-width",label:"Применить фильтр",color:"positive",onClick:l[4]||(l[4]=e=>ae("apply")),unelevated:"","no-caps":""},null,512),[[qe]]),(0,o.wy)((0,o.Wm)(ie,{class:"full-width",label:"Сбросить фильтр",color:"dark",onClick:l[5]||(l[5]=e=>ae("clear")),unelevated:"","no-caps":""},null,512),[[qe]]),A.value.user__id?(0,o.wy)(((0,o.wg)(),(0,o.j4)(s.Z,{key:0,class:"full-width q-mt-sm",label:"Создать задачу",color:"warning",onClick:l[6]||(l[6]=e=>T.value=!0),unelevated:"","no-caps":""},null,512)),[[qe]]):(0,o.kq)("",!0)])]),(0,o.Wm)(ge,{flat:"",rows:I.value,columns:J,"row-key":"id","hide-pagination":"","table-header-class":"table-header",pagination:G},{header:(0,o.w5)((e=>[(0,o.Wm)(ce,{props:e,class:"bg-grey-2"},{default:(0,o.w5)((()=>[(0,o.Wm)(pe,{"auto-width":""}),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.cols,(l=>((0,o.wg)(),(0,o.j4)(pe,{key:l.name,props:e},{default:(0,o.w5)((()=>[(0,o._)("span",Z,(0,t.zw)(l.label),1)])),_:2},1032,["props"])))),128)),(0,o.Wm)(pe,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,o.w5)((e=>[(0,o.Wm)(ce,{props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(_e,{"auto-width":""},{default:(0,o.w5)((()=>[(0,o.Wm)(ie,{size:"sm",color:"primary",round:"",unelevated:"",dense:"",onClick:l=>e.expand=!e.expand,icon:e.expand?"visibility_off":"visibility"},null,8,["onClick","icon"])])),_:2},1024),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.cols,(l=>((0,o.wg)(),(0,o.j4)(_e,{key:l.name,props:e},{default:(0,o.w5)((()=>["is_done"===l.name?((0,o.wg)(),(0,o.iD)("span",Q,[l.value?((0,o.wg)(),(0,o.j4)(se,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,o.wg)(),(0,o.j4)(se,{key:1,name:"close",size:"20px",color:"negative"}))])):"is_repeatable"===l.name?((0,o.wg)(),(0,o.iD)("span",U,[l.value?((0,o.wg)(),(0,o.j4)(se,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,o.wg)(),(0,o.j4)(se,{key:1,name:"close",size:"20px",color:"negative"}))])):"priority"===l.name?((0,o.wg)(),(0,o.iD)("span",C,[1===l.value?((0,o.wg)(),(0,o.j4)(ve,{key:0,color:"positive",label:"Низкий"})):2===l.value?((0,o.wg)(),(0,o.j4)(ve,{key:1,color:"warning",label:"Средний"})):3===l.value?((0,o.wg)(),(0,o.j4)(ve,{key:2,color:"negative",label:"Высокий"})):(0,o.kq)("",!0)])):((0,o.wg)(),(0,o.iD)("p",D,(0,t.zw)(l.value),1))])),_:2},1032,["props"])))),128)),(0,o.Wm)(_e,{"auto-width":""},{default:(0,o.w5)((()=>[(0,o._)("div",j,[(0,o.Wm)(r.Z,{onConfirm:l=>te(e.row.id)},null,8,["onConfirm"])])])),_:2},1024)])),_:2},1032,["props"]),(0,o.wy)((0,o.Wm)(ce,{props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(_e,{colspan:"100%"},{default:(0,o.w5)((()=>[H,(0,o._)("p",null,(0,t.zw)(e.row.task),1),e.row.is_done?((0,o.wg)(),(0,o.iD)("div",z,[P,(0,o._)("p",null,(0,t.zw)(e.row.result),1),S,(0,o.Wm)(be,{modelValue:e.row.task_value,"onUpdate:modelValue":l=>e.row.task_value=l,size:"2em",class:"q-mb-md",max:5,color:"primary"},{"tip-1":(0,o.w5)((()=>[(0,o.Wm)(we,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Очень плохо")])),_:1})])),"tip-2":(0,o.w5)((()=>[(0,o.Wm)(we,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Плохо")])),_:1})])),"tip-3":(0,o.w5)((()=>[(0,o.Wm)(we,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Пойдет")])),_:1})])),"tip-4":(0,o.w5)((()=>[(0,o.Wm)(we,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Хорошо")])),_:1})])),"tip-5":(0,o.w5)((()=>[(0,o.Wm)(we,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Отлично")])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,o.Wm)(me,{outlined:"",dense:"",modelValue:e.row.admin_comment,"onUpdate:modelValue":l=>e.row.admin_comment=l,type:"textarea",label:"Обратная связь"},null,8,["modelValue","onUpdate:modelValue"]),(0,o._)("div",$,[(0,o.Wm)(ie,{dense:"",color:"positive",icon:"save","no-caps":"",unelevated:"",label:"Сохранить",onClick:l=>X(e.row)},null,8,["onClick"])])])):(0,o.kq)("",!0)])),_:2},1024)])),_:2},1032,["props"]),[[n.F8,e.expand]])])),_:1},8,["rows"]),(0,o.Wm)(fe,{modelValue:O.value,"onUpdate:modelValue":[l[7]||(l[7]=e=>O.value=e),le],max:K.value,"max-pages":6,"direction-links":"","boundary-numbers":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])),_:1}),(0,o.Wm)(We,{modelValue:T.value,"onUpdate:modelValue":l[12]||(l[12]=e=>T.value=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{style:{width:"700px","max-width":"100vw"}},{default:(0,o.w5)((()=>[(0,o.Wm)(i,null,{default:(0,o.w5)((()=>[(0,o.Wm)(ye,{onSubmit:(0,n.iM)(oe,["prevent"])},{default:(0,o.w5)((()=>[(0,o.Wm)(ne,{outlined:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:L.value.priority,"onUpdate:modelValue":l[8]||(l[8]=e=>L.value.priority=e),options:M,label:"Приоритет"},null,8,["modelValue"]),(0,o.Wm)(me,{modelValue:L.value.task,"onUpdate:modelValue":l[9]||(l[9]=e=>L.value.task=e),type:"textarea",label:"Задача *",outlined:"","lazy-rules":"",rules:[e=>null!==e&&""!==e||"Это обязательное поле"]},null,8,["modelValue","rules"]),Y,(0,o.Wm)(ne,{outlined:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:L.value.dead_line_time,"onUpdate:modelValue":l[10]||(l[10]=e=>L.value.dead_line_time=e),options:F,label:`Выполнить ${(new Date).toLocaleDateString()} до`},null,8,["modelValue","label"]),(0,o._)("div",B,[(0,o.Wm)(re,{modelValue:L.value.is_repeatable,"onUpdate:modelValue":l[11]||(l[11]=e=>L.value.is_repeatable=e),label:"Ежедневная задача"},null,8,["modelValue"])]),(0,o.Wm)(ie,{icon:"save",color:"positive","no-caps":"",unelevated:"",type:"submit",loading:R.value,label:"Сохранить"},null,8,["loading"])])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var T=a(9885),F=a(651),M=a(4458),L=a(3190),A=a(136),E=a(8879),K=a(6384),O=a(490),R=a(6749),G=a(3115),J=a(3119),N=a(2857),X=a(2765),ee=a(4939),le=a(1006),ae=a(1746),oe=a(1233),te=a(1682),ne=a(7220),ie=a(990),ue=a(1570),de=a(6858),se=a(996),me=a(2074),re=a(8326),pe=a(2146),ce=a(9984),_e=a.n(ce);const ve=I,we=ve;_e()(I,"components",{QPage:T.Z,QExpansionItem:F.Z,QCard:M.Z,QCardSection:L.Z,QSpace:A.Z,QBtn:E.Z,QSelect:K.Z,QItem:O.Z,QItemSection:R.Z,QItemLabel:G.Z,QInput:J.Z,QIcon:N.Z,QPopupProxy:X.Z,QDate:ee.Z,QCheckbox:le.Z,QTable:ae.Z,QTr:oe.Z,QTh:te.Z,QTd:ne.Z,QBadge:ie.Z,QRating:ue.Z,QTooltip:de.Z,QPagination:se.Z,QDialog:me.Z,QForm:re.Z}),_e()(I,"directives",{ClosePopup:pe.Z})}}]);