"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[200],{2200:(e,l,a)=>{a.r(l),a.d(l,{default:()=>A});var n=a(9835),t=a(6970),u=a(499),o=a(1569),d=a(8550),i=a(1862),s=a(9876),r=a(4139),m=a(2637),p=a(8227);a(8203);const c=(0,n._)("br",null,null,-1),v=(0,n._)("br",null,null,-1),_=(0,n._)("br",null,null,-1),b=(0,n._)("br",null,null,-1),f={class:"flex items-center justify-between q-mb-md"},w=(0,n._)("p",{class:"no-margin text-h6 text-bold"},"Доверенности ",-1),g={class:"row q-col-gutter-md q-mb-md"},q={class:"col-12 col-md-10"},V={class:"col-12 col-md-2"},W={class:"text-bold"},h=["innerHTML"],k={class:"q-gutter-md"},y={key:1},Z=["href"],D={__name:"doverennosti",setup(e){(0,s.E)();const l=[{name:"inner_id",align:"left",label:"Номер",field:e=>e.inner_id,sortable:!0},{name:"name",align:"left",label:"Наименование",field:e=>e.name,sortable:!0},{name:"receiver",align:"left",label:"Получатель",field:e=>e.receiver,sortable:!0},{name:"start_date",align:"left",label:"Дата начала",field:e=>new Date(e.start_date).toLocaleDateString(),sortable:!0},{name:"end_date",align:"left",label:"Дата окончания",field:e=>new Date(e.end_date).toLocaleDateString(),sortable:!0},{name:"amount",align:"left",label:"Кол-во экземпляров",field:e=>e.amount,sortable:!0},{name:"file",align:"left",label:"Файл",field:e=>e.file?`<a href="${e.file}" target="_blank">Открыть</a>`:"Нет",sortable:!0}],a=(0,u.iH)(!1),D=((0,u.iH)(!1),(0,u.iH)({}),(0,u.iH)(null),(0,u.iH)({id:null,name:null,inner_id:null,receiver:null,start_date:null,end_date:null,amount:null,file:null})),Q={sortBy:"desc",descending:!1,page:1,rowsPerPage:15},H=(0,u.iH)(1),x=(0,u.iH)(!1),C=(0,u.iH)([]),U=(0,u.iH)(5),S=(0,u.iH)(null),T=(0,u.iH)({q:""}),L=async()=>{console.log(H.value),await j()};(0,n.wF)((async()=>{await j()}));const j=async()=>{x.value=!x.value;const e=await(0,o.api)(`/api/catalog/doverennost?page=${H.value}&q=${T.value.q}`);C.value=e.data.results,U.value=Math.ceil(e.data.count/15),x.value=!x.value},P=async e=>{await o.api.delete(`/api/catalog/doverennost/${e}`),await j()},$=e=>{e?(D.value=e,D.value.start_date=D.value.start_date?new Date(D.value.start_date).toLocaleDateString():null,D.value.end_date=D.value.end_date?new Date(D.value.end_date).toLocaleDateString():null):D.value={id:null,inner_id:null,name:null,receiver:null,start_date:null,end_date:null,amount:null},a.value=!0},F=async()=>{let e,l=new FormData;delete D.value.file;for(let[a,n]of Object.entries(D.value))l.append(a,JSON.stringify(n));S.value&&l.append("file",S.value),e=D.value.id?await(0,o.api)({method:"put",url:`/api/catalog/doverennost/${D.value.id}`,data:l,headers:{"Content-Type":"multipart/form-data"}}):await(0,o.api)({method:"post",url:"/api/catalog/doverennost",data:l,headers:{"Content-Type":"multipart/form-data"}}),(0,m.d)(e.data.success?"positive":"negative",e.data.message),await j(),a.value=!1,S.value=null},M=e=>{D.value.start_date=new Date(e).toLocaleDateString()},Y=e=>{D.value.end_date=new Date(e).toLocaleDateString()};return(e,u)=>{const o=(0,n.up)("q-card-section"),s=(0,n.up)("q-card"),m=(0,n.up)("q-expansion-item"),z=(0,n.up)("q-space"),B=(0,n.up)("q-input"),E=(0,n.up)("q-btn"),I=(0,n.up)("q-th"),K=(0,n.up)("q-tr"),O=(0,n.up)("q-td"),A=(0,n.up)("q-table"),J=(0,n.up)("q-pagination"),N=(0,n.up)("q-page"),G=(0,n.up)("q-file"),R=(0,n.up)("q-card-actions"),X=(0,n.up)("q-form"),ee=(0,n.up)("q-dialog"),le=(0,n.Q2)("close-popup");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(N,{padding:""},{default:(0,n.w5)((()=>[(0,n.Wm)(m,{"expand-separator":"",icon:"help",label:"Описание раздела",class:"q-mb-md"},{default:(0,n.w5)((()=>[(0,n.Wm)(s,null,{default:(0,n.w5)((()=>[(0,n.Wm)(o,null,{default:(0,n.w5)((()=>[(0,n.Uk)(" В данный раздел вносятся все доверенности, выданные организацией физическим лицам с обязательным указанием ее номера и количества экземпляров."),c,v,(0,n.Uk)(" Номер система создает автоматически, для составления доверенности укажите номер, следующий за последним номеров, указанным в системе."),_,b,(0,n.Uk)(" В течение 24 часов доверенность можно удалить, в этом случае создавая новую доверенность номер будет такой же как в удаленной доверенности. При создании доверенности, ее электронный образ обязательно необходимо загрузить в систему, в противном случае, нужно будет удалить документ и создать его заново. ")])),_:1})])),_:1})])),_:1}),(0,n._)("div",f,[w,(0,n.Wm)(z),(0,n.Wm)(d.Z,{icon:"add",label:"Добавить",onClick:u[0]||(u[0]=e=>$(null))})]),(0,n._)("div",g,[(0,n._)("div",q,[(0,n.Wm)(B,{dense:"",modelValue:T.value.q,"onUpdate:modelValue":u[1]||(u[1]=e=>T.value.q=e),label:"Поиск по названию, номеру, получателю",outlined:""},null,8,["modelValue"])]),(0,n._)("div",V,[(0,n.Wm)(E,{class:"full-width",label:"Найти","no-caps":"",color:"primary",unelevated:"",onClick:j})])]),(0,n.Wm)(A,{flat:"",rows:C.value,columns:l,"row-key":"name","hide-pagination":"",pagination:Q,"onUpdate:pagination":u[2]||(u[2]=e=>Q=e),loading:x.value,"table-header-class":"table-header"},{header:(0,n.w5)((e=>[(0,n.Wm)(K,{props:e,class:"bg-grey-2"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.cols,(l=>((0,n.wg)(),(0,n.j4)(I,{key:l.name,props:e},{default:(0,n.w5)((()=>[(0,n._)("span",W,(0,t.zw)(l.label),1)])),_:2},1032,["props"])))),128)),(0,n.Wm)(I,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,n.w5)((e=>[(0,n.Wm)(K,{props:e},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.cols,(l=>((0,n.wg)(),(0,n.j4)(O,{key:l.name,props:e},{default:(0,n.w5)((()=>[(0,n._)("span",{innerHTML:l.value},null,8,h)])),_:2},1032,["props"])))),128)),(0,n.Wm)(O,{"auto-width":""},{default:(0,n.w5)((()=>[(0,n._)("div",k,[(0,n.Wm)(i.Z,{dense:"",onClick:l=>$(e.row)},null,8,["onClick"]),(0,n.Wm)(p.Z,{onConfirm:l=>P(e.row.id)},null,8,["onConfirm"])])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","loading"]),(0,n.Wm)(J,{modelValue:H.value,"onUpdate:modelValue":[u[3]||(u[3]=e=>H.value=e),L],max:U.value,"max-pages":6,"direction-links":"","boundary-numbers":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])),_:1}),(0,n.Wm)(ee,{modelValue:a.value,"onUpdate:modelValue":u[11]||(u[11]=e=>a.value=e)},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{style:{width:"700px","max-width":"100vw"}},{default:(0,n.w5)((()=>[(0,n.Wm)(X,{onSubmit:F},{default:(0,n.w5)((()=>[(0,n.Wm)(o,{class:"q-pb-none"},{default:(0,n.w5)((()=>[D.value.inner_id?((0,n.wg)(),(0,n.j4)(B,{key:0,class:"q-mb-md",outlined:"",dense:"",label:"Внутренний номер",modelValue:D.value.inner_id,"onUpdate:modelValue":u[4]||(u[4]=e=>D.value.inner_id=e)},null,8,["modelValue"])):(0,n.kq)("",!0),(0,n.Wm)(B,{outlined:"",dense:"",label:"Наименование документа",modelValue:D.value.name,"onUpdate:modelValue":u[5]||(u[5]=e=>D.value.name=e),"lazy-rules":"",rules:[e=>null!==e&&""!==e||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,n.Wm)(B,{class:"q-mb-md",outlined:"",dense:"",label:"Получатель",modelValue:D.value.receiver,"onUpdate:modelValue":u[6]||(u[6]=e=>D.value.receiver=e)},null,8,["modelValue"]),(0,n.Wm)(r.Z,{dense:"",class:"q-mb-md",modelValue:D.value.start_date,"onUpdate:modelValue":u[7]||(u[7]=e=>D.value.start_date=e),label:"Дата начала",onSelected:M},null,8,["modelValue"]),(0,n.Wm)(r.Z,{dense:"",class:"q-mb-md",modelValue:D.value.end_date,"onUpdate:modelValue":u[8]||(u[8]=e=>D.value.end_date=e),label:"Дата окончания",onSelected:Y},null,8,["modelValue"]),(0,n.Wm)(B,{class:"q-mb-md",outlined:"",dense:"",label:"Кол-во экземпляров",type:"number",modelValue:D.value.amount,"onUpdate:modelValue":u[9]||(u[9]=e=>D.value.amount=e)},null,8,["modelValue"]),D.value.file?((0,n.wg)(),(0,n.iD)("p",y,[(0,n._)("a",{href:D.value.file,target:"_blank"},"Загруженный ранее файл",8,Z)])):(0,n.kq)("",!0),(0,n.Wm)(G,{class:"q-mb-md",outlined:"",dense:"",label:"Файл",modelValue:S.value,"onUpdate:modelValue":u[10]||(u[10]=e=>S.value=e)},null,8,["modelValue"])])),_:1}),(0,n.Wm)(R,{align:"center"},{default:(0,n.w5)((()=>[(0,n.Wm)(E,{label:"Сохранить",type:"submit","no-caps":"",color:"positive"}),(0,n.wy)((0,n.Wm)(E,{label:"Отмена","no-caps":"",color:"dark"},null,512),[[le]])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var Q=a(9885),H=a(651),x=a(4458),C=a(3190),U=a(136),S=a(3119),T=a(8879),L=a(1746),j=a(1233),P=a(1682),$=a(7220),F=a(996),M=a(2074),Y=a(8326),z=a(9420),B=a(1821),E=a(2146),I=a(9984),K=a.n(I);const O=D,A=O;K()(D,"components",{QPage:Q.Z,QExpansionItem:H.Z,QCard:x.Z,QCardSection:C.Z,QSpace:U.Z,QInput:S.Z,QBtn:T.Z,QTable:L.Z,QTr:j.Z,QTh:P.Z,QTd:$.Z,QPagination:F.Z,QDialog:M.Z,QForm:Y.Z,QFile:z.Z,QCardActions:B.Z}),K()(D,"directives",{ClosePopup:E.Z})}}]);