"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[432],{8227:(e,l,a)=>{a.d(l,{Z:()=>w});var t=a(9835),o=a(499);const n={__name:"DeleteButton",props:["label","icon","loading","color"],emits:["confirm"],setup(e,{emit:l}){const a=(0,o.iH)(!1);return(l,o)=>{const n=(0,t.up)("q-btn"),i=(0,t.up)("q-card-section"),u=(0,t.up)("q-card-actions"),s=(0,t.up)("q-card"),d=(0,t.up)("q-dialog"),r=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[l.auth.user.role?.permission?.can_add?((0,t.wg)(),(0,t.j4)(n,{key:0,"no-caps":"",unelevated:"",dense:"",loading:e.loading,color:e.color?e.color:"negative",label:e.label,onClick:o[0]||(o[0]=e=>a.value=!0),icon:e.icon?e.icon:"delete"},null,8,["loading","color","label","icon"])):(0,t.kq)("",!0),(0,t.Wm)(d,{modelValue:a.value,"onUpdate:modelValue":o[2]||(o[2]=e=>a.value=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{style:{width:"300px","max-width":"100vw"}},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{class:"text-center text-bold"},{default:(0,t.w5)((()=>[(0,t.Uk)(" Вы уверены? ")])),_:1}),(0,t.Wm)(u,{align:"center"},{default:(0,t.w5)((()=>[(0,t.wy)((0,t.Wm)(n,{color:"negative",unelevated:"","no-caps":"",label:"Да",onClick:o[1]||(o[1]=e=>l.$emit("confirm"))},null,512),[[r]]),(0,t.wy)((0,t.Wm)(n,{color:"positive",unelevated:"","no-caps":"",label:"Нет"},null,512),[[r]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var i=a(8879),u=a(2074),s=a(4458),d=a(3190),r=a(1821),c=a(2146),p=a(9984),m=a.n(p);const _=n,w=_;m()(n,"components",{QBtn:i.Z,QDialog:u.Z,QCard:s.Z,QCardSection:d.Z,QCardActions:r.Z}),m()(n,"directives",{ClosePopup:c.Z})},6432:(e,l,a)=>{a.r(l),a.d(l,{default:()=>K});var t=a(9835),o=a(6970),n=a(1957),i=(a(8227),a(9876)),u=a(499),s=a(1569);const d={class:"row q-col-gutter-md q-mb-lg"},r={class:"col-3"},c={class:"col-2"},p={class:"row items-center justify-end"},m={class:"col-2"},_={class:"row items-center justify-end"},w={class:"col-5"},v={class:"q-gutter-md"},g={class:"text-bold"},f={key:0},b=["href"],W={key:1,class:"no-margin ellipsis",style:{"max-width":"300px"}},y=(0,t._)("br",null,null,-1),h=(0,t._)("span",null,"Серийные номера:",-1),k={class:"no-margin"},q={__name:"material_acts",setup(e){const l=(0,i.E)(),a=(0,u.iH)([]),q=(0,u.iH)([]),Z=(0,u.iH)(5),Q=(0,u.iH)(1),V=(0,u.iH)(!1),x=(0,u.iH)(""),D={sortBy:"desc",descending:!1,page:1,rowsPerPage:25},U=(0,u.iH)({who_get__id:null,created_at_gte:null,created_at_lte:null}),C=[{name:"id",align:"left",label:"#",field:e=>e.number,sortable:!0},{name:"created_at",align:"left",label:"Дата",field:e=>new Date(e.created_at).toLocaleDateString(),sortable:!0},{name:"store",align:"left",label:"Склад",field:e=>e.store?.address,sortable:!0},{name:"who_give",align:"left",label:"Передал",field:e=>e.who_give.fio,sortable:!0},{name:"who_get",align:"left",label:"Принял",field:e=>e.who_get.fio,sortable:!0},{name:"file",align:"left",label:"Акт",field:e=>"",sortable:!1}];(0,t.wF)((async()=>{await H();const e=await l.getUsers(null,!0);a.value=e}));const H=async()=>{V.value=!V.value;const e=await(0,s.api)(`/api/material_store/material_acts?page=${Q.value}&${x.value}`);q.value=e.data.results,Z.value=Math.ceil(e.data.count/15),V.value=!V.value},Y=async()=>{console.log(Q.value),await H()},z=(e,l)=>{l((async()=>{if(e){V.value=!V.value;const l=await(0,s.api)(`/api/user/user?q=${e}&page_size=10000`);a.value=l.data,V.value=!V.value}}))},P=async e=>{if(x.value="","apply"===e)for(let[l,a]of Object.entries(U.value))console.log(l,a),a&&(x.value+=`${l}=${a}&`);"clear"===e&&(x.value="",U.value={who_get__id:null,created_at_gte:null,created_at_lte:null}),await H()};return(e,l)=>{const i=(0,t.up)("q-item-label"),u=(0,t.up)("q-item-section"),s=(0,t.up)("q-item"),x=(0,t.up)("q-select"),H=(0,t.up)("q-btn"),j=(0,t.up)("q-date"),T=(0,t.up)("q-popup-proxy"),$=(0,t.up)("q-icon"),I=(0,t.up)("q-input"),M=(0,t.up)("q-th"),B=(0,t.up)("q-tr"),F=(0,t.up)("q-td"),S=(0,t.up)("q-table"),K=(0,t.up)("q-pagination"),L=(0,t.up)("q-page"),A=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(L,{padding:""},{default:(0,t.w5)((()=>[(0,t._)("div",d,[(0,t._)("div",r,[(0,t.Wm)(x,{class:"q-mb-xs",dense:"",outlined:"",modelValue:U.value.who_get__id,"onUpdate:modelValue":l[0]||(l[0]=e=>U.value.who_get__id=e),loading:V.value,options:a.value,"option-label":"fio",label:"Выберите получателя","map-options":"","option-value":"id","emit-value":"","use-input":"",onFilter:z,clearable:""},{option:(0,t.w5)((e=>[(0,t.Wm)(s,(0,o.vs)((0,t.F4)(e.itemProps)),{default:(0,t.w5)((()=>[(0,t.Wm)(u,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)(i,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.opt.role?.name),1)])),_:2},1024),(0,t.Wm)(i,{caption:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Роль")])),_:1})])),_:2},1024),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Wm)(i,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.opt.fio),1)])),_:2},1024),(0,t.Wm)(i,{caption:""},{default:(0,t.w5)((()=>[(0,t.Uk)("ФИО")])),_:1})])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","loading","options"])]),(0,t._)("div",c,[(0,t.Wm)(I,{outlined:"",dense:"",modelValue:U.value.created_at_gte,"onUpdate:modelValue":l[2]||(l[2]=e=>U.value.created_at_gte=e),label:"Дата создания от",clearable:""},{append:(0,t.w5)((()=>[(0,t.Wm)($,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(j,{modelValue:U.value.created_at_gte,"onUpdate:modelValue":l[1]||(l[1]=e=>U.value.created_at_gte=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",p,[(0,t.wy)((0,t.Wm)(H,{label:"Выбрать",color:"primary",flat:""},null,512),[[A]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,t._)("div",m,[(0,t.Wm)(I,{outlined:"",dense:"",modelValue:U.value.created_at_lte,"onUpdate:modelValue":l[4]||(l[4]=e=>U.value.created_at_lte=e),label:"Дата создания до",clearable:""},{append:(0,t.w5)((()=>[(0,t.Wm)($,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(T,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(j,{modelValue:U.value.created_at_lte,"onUpdate:modelValue":l[3]||(l[3]=e=>U.value.created_at_lte=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",_,[(0,t.wy)((0,t.Wm)(H,{label:"Выбрать",color:"primary",flat:""},null,512),[[A]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,t._)("div",w,[(0,t._)("div",v,[(0,t.wy)((0,t.Wm)(H,{class:"",label:"Применить фильтр",color:"positive",onClick:l[5]||(l[5]=e=>P("apply")),unelevated:"","no-caps":""},null,512),[[A]]),(0,t.wy)((0,t.Wm)(H,{class:"",label:"Сбросить фильтр",color:"dark",onClick:l[6]||(l[6]=e=>P("clear")),unelevated:"","no-caps":""},null,512),[[A]])])])]),(0,t.Wm)(S,{flat:"",rows:q.value,columns:C,"row-key":"id","hide-pagination":"",class:"q-mb-lg","table-header-class":"table-header",pagination:D},{header:(0,t.w5)((e=>[(0,t.Wm)(B,{props:e,class:"bg-grey-2"},{default:(0,t.w5)((()=>[(0,t.Wm)(M,{"auto-width":""}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(M,{key:l.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",g,(0,o.zw)(l.label),1)])),_:2},1032,["props"])))),128)),(0,t.Wm)(M,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,t.w5)((e=>[(0,t.Wm)(B,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(F,{"auto-width":""},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{size:"sm",color:"primary",round:"",unelevated:"",dense:"",onClick:l=>e.expand=!e.expand,icon:e.expand?"visibility_off":"visibility"},null,8,["onClick","icon"])])),_:2},1024),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(F,{key:l.name,props:e},{default:(0,t.w5)((()=>["file"===l.name?((0,t.wg)(),(0,t.iD)("span",f,[(0,t._)("a",{href:e.row.file,target:"_blank"},"Открыть",8,b)])):((0,t.wg)(),(0,t.iD)("p",W,(0,o.zw)(l.value),1))])),_:2},1032,["props"])))),128)),(0,t.Wm)(F,{"auto-width":""})])),_:2},1032,["props"]),(0,t.wy)((0,t.Wm)(B,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(F,{colspan:"100%"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.row.act_items,(e=>((0,t.wg)(),(0,t.iD)("p",{key:e.id},[(0,t.Uk)((0,o.zw)(e.material.name)+" - "+(0,o.zw)(e.amount)+" - "+(0,o.zw)(e.material.unit),1),y,h,(0,t._)("pre",k,(0,o.zw)(e.give_serial_numbers),1)])))),128))])),_:2},1024)])),_:2},1032,["props"]),[[n.F8,e.expand]])])),_:1},8,["rows"]),(0,t.Wm)(K,{modelValue:Q.value,"onUpdate:modelValue":[l[7]||(l[7]=e=>Q.value=e),Y],max:Z.value,"max-pages":6,"direction-links":"","boundary-numbers":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])),_:1})}}};var Z=a(9885),Q=a(6384),V=a(490),x=a(6749),D=a(3115),U=a(3119),C=a(2857),H=a(2765),Y=a(4939),z=a(8879),P=a(1746),j=a(1233),T=a(1682),$=a(7220),I=a(996),M=a(2146),B=a(9984),F=a.n(B);const S=q,K=S;F()(q,"components",{QPage:Z.Z,QSelect:Q.Z,QItem:V.Z,QItemSection:x.Z,QItemLabel:D.Z,QInput:U.Z,QIcon:C.Z,QPopupProxy:H.Z,QDate:Y.Z,QBtn:z.Z,QTable:P.Z,QTr:j.Z,QTh:T.Z,QTd:$.Z,QPagination:I.Z}),F()(q,"directives",{ClosePopup:M.Z})}}]);