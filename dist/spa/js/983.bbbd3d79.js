"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[983],{6983:(e,l,a)=>{a.r(l),a.d(l,{default:()=>y});a(2879);var t=a(9835),o=a(6970),s=a(499),n=a(1569),i=(a(8550),a(1862),a(9876)),u=a(1375);const r=(0,t._)("div",{class:"flex items-center justify-between q-mb-md"},[(0,t._)("p",{class:"no-margin text-h6 text-bold"},"Отчеты по пользователям")],-1),p={class:"text-bold"},d={__name:"index",setup(e){const l=(0,i.E)(),a=[{name:"firstname",align:"left",label:"ФИО",field:e=>e.fio,sortable:!0},{name:"username",align:"left",label:"Логин",field:e=>e.username,sortable:!0},{name:"role",align:"left",label:"Роль",field:e=>e.role?.name,sortable:!0},{name:"position",align:"left",label:"Телефон",field:e=>e.phone,sortable:!0}],d={sortBy:"desc",descending:!1,page:1,rowsPerPage:100},m=(0,s.iH)([]),w=(0,s.iH)([]),c=(0,s.iH)(!1),_=(0,s.iH)(null),f=(0,s.iH)({q:"",role__id:""}),b=async()=>{_.value?m.value=m.value.filter((e=>e.id===_.value)):m.value=await l.getUsers(`q=${f.value.q}&role__id=${f.value.role__id}`,!0)};(0,t.wF)((async()=>{await g(),w.value=await l.getUsers(null,!0)}));const g=async()=>{m.value=await l.getUsers(`q=${f.value.q}&role__id=${f.value.role__id}`,!0)},v=(e,l)=>{l((async()=>{if(e){c.value=!c.value;const l=await(0,n.api)(`/api/user/user?q=${e}&page_size=10000`);w.value=l.data,c.value=!c.value}}))};return(e,l)=>{const s=(0,t.up)("q-item-label"),n=(0,t.up)("q-item-section"),i=(0,t.up)("q-item"),f=(0,t.up)("q-select"),g=(0,t.up)("q-th"),q=(0,t.up)("q-tr"),h=(0,t.up)("q-td"),k=(0,t.up)("q-table"),W=(0,t.up)("q-page");return(0,t.wg)(),(0,t.j4)(W,{padding:""},{default:(0,t.w5)((()=>[(0,t.Wm)(u.Z),r,(0,t.Wm)(f,{class:"q-mb-xs",dense:"",outlined:"",modelValue:_.value,"onUpdate:modelValue":[l[0]||(l[0]=e=>_.value=e),b],loading:c.value,options:w.value,"option-label":"fio",label:"Выберите пользователя","map-options":"","option-value":"id","emit-value":"","use-input":"",onFilter:v,clearable:""},{option:(0,t.w5)((e=>[(0,t.Wm)(i,(0,o.vs)((0,t.F4)(e.itemProps)),{default:(0,t.w5)((()=>[(0,t.Wm)(n,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.opt.role?.name),1)])),_:2},1024),(0,t.Wm)(s,{caption:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Роль")])),_:1})])),_:2},1024),(0,t.Wm)(n,null,{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.opt.fio),1)])),_:2},1024),(0,t.Wm)(s,{caption:""},{default:(0,t.w5)((()=>[(0,t.Uk)("ФИО")])),_:1})])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","loading","options"]),(0,t.Wm)(k,{flat:"",rows:m.value,columns:a,"row-key":"name","hide-pagination":"","table-header-class":"table-header",pagination:d},{header:(0,t.w5)((e=>[(0,t.Wm)(q,{props:e,class:"bg-grey-2"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(g,{key:l.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",p,(0,o.zw)(l.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,t.w5)((l=>[(0,t.Wm)(q,{props:l},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.cols,(a=>((0,t.wg)(),(0,t.j4)(h,{key:a.name,onClick:a=>e.auth.user.role.permission.can_view?e.$router.push(`/reports/report/${l.row.id}`):null,props:l},{default:(0,t.w5)((()=>[(0,t._)("span",null,(0,o.zw)(a.value),1)])),_:2},1032,["onClick","props"])))),128))])),_:2},1032,["props"])])),_:1},8,["rows"])])),_:1})}}};var m=a(9885),w=a(6384),c=a(490),_=a(6749),f=a(3115),b=a(1746),g=a(1233),v=a(1682),q=a(7220),h=a(9984),k=a.n(h);const W=d,y=W;k()(d,"components",{QPage:m.Z,QSelect:w.Z,QItem:c.Z,QItemSection:_.Z,QItemLabel:f.Z,QTable:b.Z,QTr:g.Z,QTh:v.Z,QTd:q.Z})}}]);