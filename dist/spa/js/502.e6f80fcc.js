"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[502],{8203:(e,l,a)=>{a.d(l,{Z:()=>c});var t=a(9835);function o(e,l){const a=(0,t.up)("q-btn");return(0,t.wg)(),(0,t.j4)(a,{"no-caps":"",outline:"",color:"primary",label:"Назад",icon:"arrow_back",class:"q-mr-md",onClick:l[0]||(l[0]=l=>e.$router.back())})}var s=a(1639),n=a(8879),r=a(9984),u=a.n(r);const i={},d=(0,s.Z)(i,[["render",o]]),c=d;u()(i,"components",{QBtn:n.Z})},3502:(e,l,a)=>{a.r(l),a.d(l,{default:()=>A});var t=a(9835),o=a(6970),s=a(1957),n=a(8203),r=a(1569),u=a(499),i=a(8339),d=a(9876);const c={class:"flex items-center q-mb-lg"},p={class:"no-margin text-h6 text-bold"},_={class:"row q-col-gutter-md q-mb-md"},m={class:"col-12 col-md-3"},w={class:"row items-center justify-end"},b={class:"row items-center justify-end"},g={class:"col-12 col-md-3"},v={key:0,class:"q-mb-lg"},f={class:"text-h6 text-bold"},y={class:"info-table full-width"},k=(0,t._)("tr",null,[(0,t._)("td",{class:"text-bold"},"№"),(0,t._)("td",{class:"text-bold"},"Вопрос"),(0,t._)("td",{class:"text-bold"},"План"),(0,t._)("td",{class:"text-bold"},"Факт"),(0,t._)("td",{class:"text-bold"},"%выполнения")],-1),x=(0,t._)("p",{class:"text-h6 text-bold"},"Задачи за период",-1),h={class:"text-bold"},q={key:0},D={key:1},W={key:2},z={key:3},j=(0,t._)("p",{class:"text-bold q-mb-sm"},"Задача: ",-1),Z=(0,t._)("p",{class:"text-bold q-mb-sm"},"Результат выполнения задачи",-1),Q={key:2},V=(0,t._)("p",{class:"text-h6 text-bold"},"Финансовые показатели",-1),Y={__name:"report",setup(e){(0,d.E)();const l=(0,u.iH)({user__id:null,created_at_gte:null,created_at_lte:null}),a=(0,i.yj)(),Y=(0,u.iH)([]),C=(0,u.iH)(""),H={sortBy:"desc",descending:!1,page:1,rowsPerPage:50},P=[{name:"id",align:"left",label:"ID",field:e=>e.id,sortable:!0},{name:"created_at",align:"left",label:"Дата",field:e=>new Date(e.created_at).toLocaleDateString(),sortable:!0},{name:"priority",align:"left",label:"Приоритет",field:e=>e.priority,sortable:!0},{name:"is_done",align:"left",label:"Выполнено",field:e=>e.is_done,sortable:!0},{name:"task_value",align:"left",label:"Оценка",field:e=>e.task_value?e.task_value:"Нет",sortable:!0},{name:"task_value",align:"left",label:"Комент",field:e=>e.user_comment?e.user_comment:"Нет",sortable:!0}];(0,t.wF)((async()=>{let e=new Date;e.setDate(e.getDate()-1),l.value.created_at_gte=e.toLocaleDateString().split(".").reverse().join("-"),await $("apply")}));const T=async()=>{console.log("query_string",C.value),console.log("filters",l.value);const e=await(0,r.api)(`/api/report/by_user?user_id=${a.params.user_id}&${C.value}`);console.log(e.data),Y.value=e.data},$=async e=>{if(C.value="","apply"===e)for(let[a,t]of Object.entries(l.value))console.log(a,t),t&&(C.value+=`${a}=${t}&`);"clear"===e&&(C.value="",l.value={created_at_gte:null,created_at_lte:null}),await T()};return(e,a)=>{const r=(0,t.up)("q-btn"),u=(0,t.up)("q-date"),i=(0,t.up)("q-popup-proxy"),d=(0,t.up)("q-icon"),C=(0,t.up)("q-input"),T=(0,t.up)("q-th"),B=(0,t.up)("q-tr"),M=(0,t.up)("q-td"),U=(0,t.up)("q-badge"),I=(0,t.up)("q-table"),K=(0,t.up)("q-page"),F=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(K,{padding:""},{default:(0,t.w5)((()=>[(0,t._)("div",c,[(0,t.Wm)(n.Z),(0,t._)("p",p,"Отчет пользователя "+(0,o.zw)(Y.value.user),1)]),(0,t._)("div",_,[(0,t._)("div",m,[(0,t.Wm)(C,{class:"q-mb-xs",outlined:"",dense:"",modelValue:l.value.created_at_gte,"onUpdate:modelValue":a[1]||(a[1]=e=>l.value.created_at_gte=e),label:"Отчет с"},{append:(0,t.w5)((()=>[(0,t.Wm)(d,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{modelValue:l.value.created_at_gte,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value.created_at_gte=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",w,[(0,t.wy)((0,t.Wm)(r,{label:"Выбрать",color:"primary",flat:""},null,512),[[F]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(C,{outlined:"",dense:"",modelValue:l.value.created_at_lte,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.created_at_lte=e),label:"Отчет до"},{append:(0,t.w5)((()=>[(0,t.Wm)(d,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{modelValue:l.value.created_at_lte,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.created_at_lte=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",b,[(0,t.wy)((0,t.Wm)(r,{label:"Выбрать",color:"primary",flat:""},null,512),[[F]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,t._)("div",g,[(0,t.wy)((0,t.Wm)(r,{class:"q-mb-sm full-width",label:"Применить фильтр",color:"positive",onClick:a[4]||(a[4]=e=>$("apply")),unelevated:"","no-caps":""},null,512),[[F]]),(0,t.wy)((0,t.Wm)(r,{class:"full-width",label:"Сбросить фильтр",color:"dark",onClick:a[5]||(a[5]=e=>$("clear")),unelevated:"","no-caps":""},null,512),[[F]])])]),Y.value.form_result?((0,t.wg)(),(0,t.iD)("div",v,[(0,t._)("p",f,"Средняя оценка за период "+(0,o.zw)(Y.value.form_rate),1),(0,t._)("table",y,[k,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(Y.value.form_result,((e,l)=>((0,t.wg)(),(0,t.iD)("tr",{key:l},[(0,t._)("td",null,(0,o.zw)(l+1),1),(0,t._)("td",null,(0,o.zw)(e.label),1),(0,t._)("td",null,(0,o.zw)(e.plan_amount),1),(0,t._)("td",null,(0,o.zw)(e.fact_amount),1),(0,t._)("td",null,(0,o.zw)(e.percent_done),1)])))),128))])])):(0,t.kq)("",!0),x,Y.value.tasks?((0,t.wg)(),(0,t.j4)(I,{key:1,flat:"",rows:Y.value.tasks,columns:P,"row-key":"id",pagination:H,"table-header-class":"table-header"},{header:(0,t.w5)((e=>[(0,t.Wm)(B,{props:e,class:"bg-grey-2"},{default:(0,t.w5)((()=>[(0,t.Wm)(T,{"auto-width":""}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(T,{key:l.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",h,(0,o.zw)(l.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,t.w5)((e=>[(0,t.Wm)(B,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(M,{"auto-width":""},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{size:"sm",color:"primary",round:"",unelevated:"",dense:"",onClick:l=>e.expand=!e.expand,icon:e.expand?"visibility_off":"visibility"},null,8,["onClick","icon"])])),_:2},1024),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(M,{key:l.name,props:e},{default:(0,t.w5)((()=>["is_done"===l.name?((0,t.wg)(),(0,t.iD)("span",q,[l.value?((0,t.wg)(),(0,t.j4)(d,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,t.wg)(),(0,t.j4)(d,{key:1,name:"close",size:"20px",color:"negative"}))])):"is_repeatable"===l.name?((0,t.wg)(),(0,t.iD)("span",D,[l.value?((0,t.wg)(),(0,t.j4)(d,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,t.wg)(),(0,t.j4)(d,{key:1,name:"close",size:"20px",color:"negative"}))])):"priority"===l.name?((0,t.wg)(),(0,t.iD)("span",W,[1===l.value?((0,t.wg)(),(0,t.j4)(U,{key:0,color:"positive",label:"Низкий"})):2===l.value?((0,t.wg)(),(0,t.j4)(U,{key:1,color:"warning",label:"Средний"})):3===l.value?((0,t.wg)(),(0,t.j4)(U,{key:2,color:"negative",label:"Высокий"})):(0,t.kq)("",!0)])):((0,t.wg)(),(0,t.iD)("span",z,(0,o.zw)(l.value),1))])),_:2},1032,["props"])))),128))])),_:2},1032,["props"]),(0,t.wy)((0,t.Wm)(B,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(M,{colspan:"100%"},{default:(0,t.w5)((()=>[j,(0,t._)("p",null,(0,o.zw)(e.row.task),1),Z,(0,t._)("p",null,(0,o.zw)(e.row.result),1)])),_:2},1024)])),_:2},1032,["props"]),[[s.F8,e.expand]])])),_:1},8,["rows"])):((0,t.wg)(),(0,t.iD)("p",Q,"Назначеных задач не было ")),V,(0,t._)("p",null,"Всего заработано: "+(0,o.zw)(Y.value.total_income),1),(0,t._)("p",null,"Всего заработано: "+(0,o.zw)(Y.value.total_outcome),1)])),_:1})}}};var C=a(9885),H=a(3119),P=a(2857),T=a(2765),$=a(2535),B=a(8879),M=a(1746),U=a(1233),I=a(1682),K=a(7220),F=a(990),L=a(2146),S=a(9984),E=a.n(S);const O=Y,A=O;E()(Y,"components",{QPage:C.Z,QInput:H.Z,QIcon:P.Z,QPopupProxy:T.Z,QDate:$.Z,QBtn:B.Z,QTable:M.Z,QTr:U.Z,QTh:I.Z,QTd:K.Z,QBadge:F.Z}),E()(Y,"directives",{ClosePopup:L.Z})}}]);