"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[19],{7019:(e,a,l)=>{l.r(a),l.d(a,{default:()=>T});var t=l(9835),o=l(6970),s=l(499),d=l(1569),i=(l(8550),l(1862),l(9876)),u=l(1375);const n=(0,t._)("div",{class:"flex items-center justify-between q-mb-md"},[(0,t._)("p",{class:"no-margin text-h6 text-bold"},"Оценки")],-1),r={class:"row q-col-gutter-md q-mb-lg"},_={class:"col-12 col-md-9"},m={class:"row items-center justify-end"},c={class:"row items-center justify-end"},p={class:"col-12 col-md-3"},w={class:"text-bold"},f={__name:"finances",setup(e){const a=(0,i.E)(),l=[{name:"username",align:"left",label:"ФИО",field:e=>e.user.fio,sortable:!0},{name:"middle_logins_mark",align:"left",label:"Период",field:e=>e.days_in_period,sortable:!0},{name:"middle_task_mark",align:"left",label:"ЗП в день",field:e=>e.daily_rashod,sortable:!0},{name:"middle_forms_mark",align:"left",label:"ЗП за период",field:e=>e.period_income,sortable:!0},{name:"middle_forms_mark",align:"left",label:"Расходы в день",field:e=>e.daily_rashod,sortable:!0},{name:"middle_forms_mark",align:"left",label:"Расходы за период",field:e=>e.period_outcome,sortable:!0}],f={sortBy:"desc",descending:!1,page:1,rowsPerPage:100},v=(0,s.iH)({user__id:null,created_at_gte:"",created_at_lte:""}),b=(0,s.iH)([]),g=(0,s.iH)([]),y=(0,s.iH)(!1),W=((0,s.iH)(null),(0,s.iH)({q:"",role__id:""}),async()=>{v.value.user__id?b.value=b.value.filter((e=>e.user.id===v.value.user__id)):await h()});(0,t.wF)((async()=>{let e=new Date;e.setDate(e.getDate()-1),v.value.created_at_gte=e.toLocaleDateString().split(".").reverse().join("-"),v.value.created_at_lte=e.toLocaleDateString().split(".").reverse().join("-"),await k(),g.value=await a.getUsers(null,!0)}));const k=async()=>{const e=await(0,d.api)(`/api/report/finance?created_at_gte=${v.value.created_at_gte}&created_at_lte=${v.value.created_at_lte}`);b.value=e.data,v.value.user__id&&(b.value=b.value.filter((e=>e.user.id===v.value.user__id)))},q=async()=>{await k()},h=async()=>{v.value={user__id:null,created_at_gte:"",created_at_lte:""},await k()};return(e,a)=>{const s=(0,t.up)("q-item-label"),d=(0,t.up)("q-item-section"),i=(0,t.up)("q-item"),k=(0,t.up)("q-select"),Z=(0,t.up)("q-btn"),Q=(0,t.up)("q-date"),V=(0,t.up)("q-popup-proxy"),D=(0,t.up)("q-icon"),U=(0,t.up)("q-input"),Y=(0,t.up)("q-th"),j=(0,t.up)("q-tr"),x=(0,t.up)("q-td"),H=(0,t.up)("q-table"),P=(0,t.up)("q-page"),T=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(P,{padding:""},{default:(0,t.w5)((()=>[(0,t.Wm)(u.Z),n,(0,t._)("div",r,[(0,t._)("div",_,[(0,t.Wm)(k,{class:"q-mb-xs",dense:"",outlined:"",modelValue:v.value.user__id,"onUpdate:modelValue":[a[0]||(a[0]=e=>v.value.user__id=e),W],loading:y.value,options:g.value.filter((e=>e.role?.use_in_report)),"option-label":"fio",label:"Выберите пользователя","map-options":"","option-value":"id","emit-value":"","use-input":"",clearable:""},{option:(0,t.w5)((e=>[(0,t.Wm)(i,(0,o.vs)((0,t.F4)(e.itemProps)),{default:(0,t.w5)((()=>[(0,t.Wm)(d,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.opt.role?.name),1)])),_:2},1024),(0,t.Wm)(s,{caption:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Роль")])),_:1})])),_:2},1024),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.opt.fio),1)])),_:2},1024),(0,t.Wm)(s,{caption:""},{default:(0,t.w5)((()=>[(0,t.Uk)("ФИО")])),_:1})])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","loading","options"]),(0,t.Wm)(U,{class:"q-mb-xs",outlined:"",dense:"",modelValue:v.value.created_at_gte,"onUpdate:modelValue":a[2]||(a[2]=e=>v.value.created_at_gte=e),label:"Отчет с"},{append:(0,t.w5)((()=>[(0,t.Wm)(D,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(V,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(Q,{modelValue:v.value.created_at_gte,"onUpdate:modelValue":a[1]||(a[1]=e=>v.value.created_at_gte=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",m,[(0,t.wy)((0,t.Wm)(Z,{label:"Выбрать",color:"primary",flat:""},null,512),[[T]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(U,{outlined:"",dense:"",modelValue:v.value.created_at_lte,"onUpdate:modelValue":a[4]||(a[4]=e=>v.value.created_at_lte=e),label:"Отчет до"},{append:(0,t.w5)((()=>[(0,t.Wm)(D,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(V,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(Q,{modelValue:v.value.created_at_lte,"onUpdate:modelValue":a[3]||(a[3]=e=>v.value.created_at_lte=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",c,[(0,t.wy)((0,t.Wm)(Z,{label:"Выбрать",color:"primary",flat:""},null,512),[[T]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,t._)("div",p,[(0,t.wy)((0,t.Wm)(Z,{class:"q-mb-sm full-width",label:"Применить фильтр",color:"positive",onClick:q,unelevated:"","no-caps":""},null,512),[[T]]),(0,t.wy)((0,t.Wm)(Z,{class:"full-width",label:"Сбросить фильтр",color:"dark",onClick:h,unelevated:"","no-caps":""},null,512),[[T]])])]),(0,t.Wm)(H,{flat:"",rows:b.value,columns:l,"row-key":"name","hide-pagination":"","table-header-class":"table-header",pagination:f},{header:(0,t.w5)((e=>[(0,t.Wm)(j,{props:e,class:"bg-grey-2"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(a=>((0,t.wg)(),(0,t.j4)(Y,{key:a.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",w,(0,o.zw)(a.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,t.w5)((e=>[(0,t.Wm)(j,{props:e},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(a=>((0,t.wg)(),(0,t.j4)(x,{key:a.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",null,(0,o.zw)(a.value),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),_:1},8,["rows"])])),_:1})}}};var v=l(9885),b=l(6384),g=l(490),y=l(6749),W=l(3115),k=l(3119),q=l(2857),h=l(2765),Z=l(4939),Q=l(8879),V=l(1746),D=l(1233),U=l(1682),Y=l(7220),j=l(2146),x=l(9984),H=l.n(x);const P=f,T=P;H()(f,"components",{QPage:v.Z,QSelect:b.Z,QItem:g.Z,QItemSection:y.Z,QItemLabel:W.Z,QInput:k.Z,QIcon:q.Z,QPopupProxy:h.Z,QDate:Z.Z,QBtn:Q.Z,QTable:V.Z,QTr:D.Z,QTh:U.Z,QTd:Y.Z}),H()(f,"directives",{ClosePopup:j.Z})}}]);