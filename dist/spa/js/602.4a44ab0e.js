"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[602],{2637:(l,e,a)=>{a.d(e,{d:()=>n});var o=a(6827),u=a(8346);function n(l,e){o.Z.create({message:e,html:!0,color:l,position:u.Z.lt.sm?"bottom":"bottom-right"})}},8550:(l,e,a)=>{a.d(e,{Z:()=>r});var o=a(9835);const u={__name:"AddButton",props:["label","icon","loading","color"],setup(l){return(e,a)=>{const u=(0,o.up)("q-btn");return e.auth.user.role?.permission?.can_add?((0,o.wg)(),(0,o.j4)(u,{key:0,"no-caps":"",unelevated:"",loading:l.loading,color:l.color?l.color:"primary",label:l.label,icon:l.icon?l.icon:"add"},null,8,["loading","color","label","icon"])):(0,o.kq)("",!0)}}};var n=a(8879),t=a(9984),d=a.n(t);const s=u,r=s;d()(u,"components",{QBtn:n.Z})},8203:(l,e,a)=>{a.d(e,{Z:()=>m});var o=a(9835);function u(l,e){const a=(0,o.up)("q-btn");return(0,o.wg)(),(0,o.j4)(a,{"no-caps":"",outline:"",color:"primary",label:"Назад",icon:"arrow_back",class:"q-mr-md",onClick:e[0]||(e[0]=e=>l.$router.back())})}var n=a(1639),t=a(8879),d=a(9984),s=a.n(d);const r={},i=(0,n.Z)(r,[["render",u]]),m=i;s()(r,"components",{QBtn:t.Z})},1862:(l,e,a)=>{a.d(e,{Z:()=>r});var o=a(9835);const u={__name:"EditButton",props:["label","icon","color"],setup(l){return(e,a)=>{const u=(0,o.up)("q-btn");return e.auth.user.role?.permission?.can_edit?((0,o.wg)(),(0,o.j4)(u,{key:0,"no-caps":"",unelevated:"",color:l.color,label:l.label,icon:l.icon?l.icon:"edit"},null,8,["color","label","icon"])):(0,o.kq)("",!0)}}};var n=a(8879),t=a(9984),d=a.n(t);const s=u,r=s;d()(u,"components",{QBtn:n.Z})},7602:(l,e,a)=>{a.r(e),a.d(e,{default:()=>j});var o=a(9835),u=a(1957),n=a(8203),t=a(499),d=(a(8550),a(2637)),s=a(8339),r=a(1569),i=a(9876),m=a(1862);const p={class:"flex items-center q-mb-md"},c=(0,o._)("p",{class:"no-margin text-h6 text-bold"},"Редактирование пользователя",-1),v={key:0,class:"q-mb-md"},b=["src"],V={class:"row q-col-gutter-md q-mb-md"},_={class:"col-12 col-md-6"},y={class:"col-12 col-md-6"},g={__name:"edit",setup(l){const e=(0,i.E)(),a=(0,s.tv)(),g=(0,s.yj)(),h=(0,t.iH)(!1),f=(0,t.iH)(""),q=(0,t.iH)(null),k=(0,t.iH)({role:null,username:null,department:null,subdivision:null,fio:null,position:null,phone:null,email:null,telega_username:null,timezone:0,daily_rashod:null,daily_payment:null,password:null,is_active:null}),w=(0,o.Fl)((()=>e.departments));(0,o.wF)((async()=>{await W()}));const W=async()=>{console.log(g.params.id);const l=await(0,r.api)(`/api/user/user/${g.params.id}`);console.log(l.data),k.value=l.data,k.value.department=w.value.find((l=>l.id===k.value.department)),k.value.role=l.data.role.id},Z=async()=>{h.value=!h.value,f.value="";let l=new FormData;k.value.department=k.value.department.id;for(let[e,a]of Object.entries(k.value))l.append(e,JSON.stringify(a));q.value&&l.append("avatar",q.value),(0,r.api)({method:"patch",url:`/api/user/user/${k.value.id}`,data:l,headers:{"Content-Type":"multipart/form-data"}}).then((l=>{(0,d.d)("positive","Пользователь успешно изменен"),a.back()})).catch((l=>{let e=Object.keys(l.response.data);for(let a of e)f.value+=l.response.data[a][0];(0,d.d)("negative",f.value)})),h.value=!h.value};return(l,e)=>{const a=(0,o.up)("q-avatar"),t=(0,o.up)("q-select"),d=(0,o.up)("q-input"),s=(0,o.up)("q-checkbox"),r=(0,o.up)("q-file"),i=(0,o.up)("q-form"),g=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(g,{padding:""},{default:(0,o.w5)((()=>[(0,o._)("div",p,[(0,o.Wm)(n.Z),c]),k.value.avatar?((0,o.wg)(),(0,o.iD)("div",v,[(0,o.Wm)(a,{size:"100px"},{default:(0,o.w5)((()=>[(0,o._)("img",{src:k.value.avatar},null,8,b)])),_:1})])):(0,o.kq)("",!0),(0,o.Wm)(i,{onSubmit:(0,u.iM)(Z,["prevent"])},{default:(0,o.w5)((()=>[(0,o._)("div",V,[(0,o._)("div",_,[(0,o.Wm)(t,{outlined:"",modelValue:k.value.role,"onUpdate:modelValue":e[0]||(e[0]=l=>k.value.role=l),options:l.auth.roles,"option-label":"name",label:"Выберите роль*","map-options":"","option-value":"id","emit-value":"",clearable:"","lazy-rules":"",rules:[l=>l||"Это обязательное поле"]},null,8,["modelValue","options","rules"]),(0,o.Wm)(t,{outlined:"",modelValue:k.value.department,"onUpdate:modelValue":e[1]||(e[1]=l=>k.value.department=l),options:w.value,"option-label":"name",label:"Выберите отдел*",clearable:"","lazy-rules":"",rules:[l=>l||"Это обязательное поле"]},null,8,["modelValue","options","rules"]),(0,o.Wm)(t,{outlined:"",modelValue:k.value.subdivision,"onUpdate:modelValue":e[2]||(e[2]=l=>k.value.subdivision=l),options:k.value.department?.divisions,"option-label":"name",label:"Выберите подразделение*","map-options":"","option-value":"id","emit-value":"",clearable:"","lazy-rules":"",rules:[l=>l||"Это обязательное поле"]},null,8,["modelValue","options","rules"]),(0,o.Wm)(d,{outlined:"",modelValue:k.value.username,"onUpdate:modelValue":e[3]||(e[3]=l=>k.value.username=l),label:"Логин*","lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,o.Wm)(d,{outlined:"",modelValue:k.value.password,"onUpdate:modelValue":e[4]||(e[4]=l=>k.value.password=l),class:"q-mb-md",label:"Новый пароль"},null,8,["modelValue"]),(0,o.Wm)(d,{outlined:"",modelValue:k.value.daily_payment,"onUpdate:modelValue":e[5]||(e[5]=l=>k.value.daily_payment=l),type:"number",label:"Дневной доход сотрудника*","lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,o.Wm)(d,{outlined:"",modelValue:k.value.daily_rashod,"onUpdate:modelValue":e[6]||(e[6]=l=>k.value.daily_rashod=l),type:"number",label:"Дневной расход на сотрудника*","lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,o.Wm)(s,{modelValue:k.value.is_active,"onUpdate:modelValue":e[7]||(e[7]=l=>k.value.is_active=l),label:"Пользователь активный"},null,8,["modelValue"])]),(0,o._)("div",y,[(0,o.Wm)(d,{outlined:"",modelValue:k.value.timezone,"onUpdate:modelValue":e[8]||(e[8]=l=>k.value.timezone=l),type:"number",class:"q-mb-md",label:"Часовой пояс"},null,8,["modelValue"]),(0,o.Wm)(d,{outlined:"",modelValue:k.value.telega_username,"onUpdate:modelValue":e[9]||(e[9]=l=>k.value.telega_username=l),label:"Telegram username ID (без символа@)*","lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,o.Wm)(d,{outlined:"",modelValue:k.value.fio,"onUpdate:modelValue":e[10]||(e[10]=l=>k.value.fio=l),label:"ФИО*","lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,o.Wm)(d,{outlined:"",modelValue:k.value.phone,"onUpdate:modelValue":e[11]||(e[11]=l=>k.value.phone=l),label:"Телефон*","lazy-rules":"",mask:"+7 (###) ###-##-##","fill-mask":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,o.Wm)(d,{outlined:"",modelValue:k.value.email,"onUpdate:modelValue":e[12]||(e[12]=l=>k.value.email=l),label:"Email*","lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,o.Wm)(d,{outlined:"",modelValue:k.value.position,"onUpdate:modelValue":e[13]||(e[13]=l=>k.value.position=l),class:"q-mb-md",label:"Должность"},null,8,["modelValue"]),(0,o.Wm)(r,{outlined:"",modelValue:q.value,"onUpdate:modelValue":e[14]||(e[14]=l=>q.value=l),class:"q-mb-md",label:"Фото"},null,8,["modelValue"])])]),(0,o.Wm)(m.Z,{loading:h.value,label:"Сохранить пользователя",type:"submit",color:"positive",icon:"done"},null,8,["loading"])])),_:1},8,["onSubmit"])])),_:1})}}};var h=a(9885),f=a(1357),q=a(8326),k=a(6384),w=a(3119),W=a(1006),Z=a(9420),U=a(9984),z=a.n(U);const Q=g,j=Q;z()(g,"components",{QPage:h.Z,QAvatar:f.Z,QForm:q.Z,QSelect:k.Z,QInput:w.Z,QCheckbox:W.Z,QFile:Z.Z})}}]);