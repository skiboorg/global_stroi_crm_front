"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[425],{1425:(e,l,a)=>{a.r(l),a.d(l,{default:()=>ie});a(2879);var t=a(9835),o=a(6970),i=a(499),n=a(1569),u=a(8550),s=a(9876),d=a(2637),m=a(1801),r=a(1375);const p={class:"row q-col-gutter-md q-mb-md"},c={class:"col-9"},b={class:"col-3"},v={key:0,class:"row q-col-gutter-md"},w={class:"col-9"},_={class:"col-3"},g={key:0,class:"text-negative"},f={key:1,class:"text-negative"},V={class:"text-bold"},y={key:0},W={key:1},q={key:2},h={key:4},k={key:5},Z={key:6},Q={class:"q-gutter-md"},U={class:"row q-col-gutter-md"},x={class:"col-6"},C={class:"col-6"},D={__name:"materials",setup(e){const l=(0,s.E)(),a=(0,i.iH)([]),D=(0,i.iH)([]),H=(0,i.iH)("items"),T=(0,i.iH)(null),z=(0,i.iH)(!1),F=(0,i.iH)(!1),I=(0,i.iH)(null),P=(0,i.iH)([]),j=(0,i.iH)(null),S={sortBy:"desc",descending:!1,page:1,rowsPerPage:50},$=(0,i.iH)({store:null,name:null,serial_numbers:null,unit:null,init_amount:null}),Y=["шт.","м."],B=[{name:"select",align:"left",label:"",sortable:!1},{name:"id",align:"left",label:"#",field:e=>e.id,sortable:!0},{name:"image",align:"left",label:"Изображение",field:e=>e.image,sortable:!0},{name:"store",align:"left",label:"Склад",style:"min-width: 100px; max-width: 200px; white-space: normal;",field:e=>e.store?.address,sortable:!0},{name:"name",align:"left",style:"min-width: 200px; max-width: 300px; white-space: normal;",label:"Наименование",field:e=>e.name,sortable:!0},{name:"serial_numbers",align:"left",label:"Серийные номера",field:e=>e.serial_numbers,sortable:!0},{name:"init_amount",align:"left",label:"Поступило",field:e=>e.init_amount,sortable:!0},{name:"amount",align:"left",label:"Oстаток",field:e=>e.amount,sortable:!0},{name:"give_amount",align:"left",label:"Передать",field:e=>e.amount,sortable:!0}];(0,t.wF)((async()=>{await K();const e=await(0,n.api)("/api/material_store/store");D.value=e.data,P.value=await l.getUsers(null,!0)}));const K=async()=>{const e=await(0,n.api)("/api/material_store/store_material");a.value=e.data},O=(0,t.Fl)((()=>{if(a.value)return a.value.some((e=>e.is_selected&&e.give_amount&&e.give_amount>0))})),A=async()=>{z.value=!0;let e=new FormData;for(let[a,t]of Object.entries($.value))e.append(a,t);I.value&&e.append("file",I.value);try{await(0,n.api)({method:"post",url:"/api/material_store/store_material",data:e,headers:{"Content-Type":"multipart/form-data"}});(0,d.d)("positive","ТМЦ добавлен на склад"),await K(),z.value=!1,F.value=!1}catch(l){(0,d.d)("negative","Проверьте входные данные"),z.value=!1}},E=async(e,l)=>{await n.api.delete(`/api/material_store/${e}/${l}`),await K()},L=(e,l)=>{l((async()=>{if(e){z.value=!0;const l=await(0,n.api)(`/api/user/user?q=${e}&page_size=10000`);P.value=l.data,z.value=!1}}))},G=async()=>{z.value=!0;const e=a.value.filter((e=>e.is_selected&&e.give_amount>0));await n.api.post("/api/material_store/create_give_act",{store:T.value,who_get:j.value,selected_materials:e});await K(),z.value=!1};return(e,l)=>{const i=(0,t.up)("q-tab"),n=(0,t.up)("q-tabs"),s=(0,t.up)("q-separator"),d=(0,t.up)("q-select"),K=(0,t.up)("q-item-label"),J=(0,t.up)("q-item-section"),M=(0,t.up)("q-item"),N=(0,t.up)("q-btn"),R=(0,t.up)("q-th"),X=(0,t.up)("q-tr"),ee=(0,t.up)("q-checkbox"),le=(0,t.up)("q-img"),ae=(0,t.up)("q-input"),te=(0,t.up)("q-td"),oe=(0,t.up)("q-table"),ie=(0,t.up)("q-tab-panel"),ne=(0,t.up)("q-tab-panels"),ue=(0,t.up)("q-file"),se=(0,t.up)("q-card-section"),de=(0,t.up)("q-card-actions"),me=(0,t.up)("q-form"),re=(0,t.up)("q-card"),pe=(0,t.up)("q-dialog"),ce=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(r.Z),(0,t.Wm)(n,{modelValue:H.value,"onUpdate:modelValue":l[0]||(l[0]=e=>H.value=e),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{name:"items",label:"ТМЦ"}),(0,t.Wm)(i,{name:"docs",label:"Акты"})])),_:1},8,["modelValue"]),(0,t.Wm)(s),(0,t.Wm)(ne,{modelValue:H.value,"onUpdate:modelValue":l[4]||(l[4]=e=>H.value=e),animated:""},{default:(0,t.w5)((()=>[(0,t.Wm)(ie,{name:"items"},{default:(0,t.w5)((()=>[(0,t._)("div",p,[(0,t._)("div",c,[(0,t.Wm)(d,{options:D.value,modelValue:T.value,"onUpdate:modelValue":l[1]||(l[1]=e=>T.value=e),clearable:"",outlined:"",dense:"","emit-value":"","option-label":"address","option-value":"id","map-options":"",label:"Выберите склад"},null,8,["options","modelValue"])]),(0,t._)("div",b,[(0,t.Wm)(u.Z,{label:"Добавить ТМЦ",onClick:l[2]||(l[2]=e=>F.value=!0),class:"q-mr-md"})])]),O.value?((0,t.wg)(),(0,t.iD)("div",v,[(0,t._)("div",w,[(0,t.Wm)(d,{class:"q-mb-xs",dense:"",outlined:"",modelValue:j.value,"onUpdate:modelValue":l[3]||(l[3]=e=>j.value=e),loading:z.value,options:P.value,"option-label":"fio",label:"Выберите пользователя","map-options":"","option-value":"id","emit-value":"","use-input":"",onFilter:L,clearable:""},{option:(0,t.w5)((e=>[(0,t.Wm)(M,(0,o.vs)((0,t.F4)(e.itemProps)),{default:(0,t.w5)((()=>[(0,t.Wm)(J,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)(K,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.opt.role?.name),1)])),_:2},1024),(0,t.Wm)(K,{caption:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Роль")])),_:1})])),_:2},1024),(0,t.Wm)(J,null,{default:(0,t.w5)((()=>[(0,t.Wm)(K,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.opt.fio),1)])),_:2},1024),(0,t.Wm)(K,{caption:""},{default:(0,t.w5)((()=>[(0,t.Uk)("ФИО")])),_:1})])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","loading","options"])]),(0,t._)("div",_,[(0,t.Wm)(N,{"no-caps":"",unelevated:"",color:"positive",disable:!j.value,loading:z.value,onClick:G,label:"Передать выбранное"},null,8,["disable","loading"]),T.value?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("p",g,"Выберите склад")),j.value?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("p",f,"Выберите пользователя"))])])):(0,t.kq)("",!0),(0,t.Wm)(oe,{flat:"",rows:T.value?a.value.filter((e=>e.store.id===T.value)):a.value,columns:B,pagination:S,"table-header-class":"table-header","row-key":"id",selection:"multiple",style:{"table-layout":"fixed"},class:"q-mb-lg"},{header:(0,t.w5)((e=>[(0,t.Wm)(X,{props:e,class:"bg-grey-2"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(R,{key:l.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",V,(0,o.zw)(l.label),1)])),_:2},1032,["props"])))),128)),(0,t.Wm)(R,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,t.w5)((l=>[(0,t.Wm)(X,{props:l},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(l.cols,(e=>((0,t.wg)(),(0,t.j4)(te,{key:e.name,props:l},{default:(0,t.w5)((()=>["id"===e.name?((0,t.wg)(),(0,t.iD)("pre",y,(0,o.zw)(l.rowIndex+1),1)):"store"===e.name?((0,t.wg)(),(0,t.iD)("span",W,(0,o.zw)(l.row.store?.address),1)):"select"===e.name?((0,t.wg)(),(0,t.iD)("span",q,[(0,t.Wm)(ee,{modelValue:l.row.is_selected,"onUpdate:modelValue":e=>l.row.is_selected=e},null,8,["modelValue","onUpdate:modelValue"])])):"image"===e.name?((0,t.wg)(),(0,t.j4)(le,{key:3,ratio:16/9,fit:"contain",src:e.value},null,8,["src"])):"serial_numbers"===e.name?((0,t.wg)(),(0,t.iD)("p",h,[(0,t.Wm)(ae,{style:{width:"200px"},type:"textarea",label:"Серийные номера",disable:!l.row.is_selected,outlined:"",dense:"",modelValue:l.row.serial_numbers,"onUpdate:modelValue":e=>l.row.serial_numbers=e},null,8,["disable","modelValue","onUpdate:modelValue"])])):"give_amount"===e.name?((0,t.wg)(),(0,t.iD)("p",k,[(0,t.Wm)(ae,{style:{width:"200px"},type:"number",onChange:e=>l.row.give_amount>l.row.amount?l.row.give_amount=l.row.amount:null,disable:!l.row.is_selected,label:"Кол-во",class:"q-mb-sm",outlined:"",dense:"",modelValue:l.row.give_amount,"onUpdate:modelValue":e=>l.row.give_amount=e},null,8,["onChange","disable","modelValue","onUpdate:modelValue"]),(0,t.Wm)(ae,{style:{width:"200px"},type:"textarea",label:"Серийные номера",disable:!l.row.is_selected,outlined:"",dense:"",modelValue:l.row.give_serial_numbers,"onUpdate:modelValue":e=>l.row.give_serial_numbers=e},null,8,["disable","modelValue","onUpdate:modelValue"])])):((0,t.wg)(),(0,t.iD)("p",Z,(0,o.zw)(e.value),1))])),_:2},1032,["props"])))),128)),(0,t.Wm)(te,{"auto-width":""},{default:(0,t.w5)((()=>[(0,t._)("div",Q,[(0,t.Wm)(N,{icon:"visibility",flat:"",dense:"",onClick:a=>e.$router.push(`/store/material/${l.row.id}`)},null,8,["onClick"]),(0,t.Wm)(u.Z,{dense:"",color:"negative",icon:"delete",onClick:e=>E("store_material",l.row.id)},null,8,["onClick"])])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows"])])),_:1}),(0,t.Wm)(ie,{name:"docs"},{default:(0,t.w5)((()=>[(0,t.Wm)(m.Z)])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(pe,{modelValue:F.value,"onUpdate:modelValue":l[11]||(l[11]=e=>F.value=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(re,{style:{width:"700px","max-width":"100vw"}},{default:(0,t.w5)((()=>[(0,t.Wm)(me,{onSubmit:A},{default:(0,t.w5)((()=>[(0,t.Wm)(se,{class:"q-pb-none"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{class:"q-mb-md",options:D.value,modelValue:$.value.store,"onUpdate:modelValue":l[5]||(l[5]=e=>$.value.store=e),clearable:"",outlined:"",dense:"","emit-value":"","option-label":"address","option-value":"id","map-options":"",label:"Выберите склад"},null,8,["options","modelValue"]),(0,t.Wm)(ae,{dense:"",outlined:"",label:"Название",class:"q-mb-md",modelValue:$.value.name,"onUpdate:modelValue":l[6]||(l[6]=e=>$.value.name=e)},null,8,["modelValue"]),(0,t._)("div",U,[(0,t._)("div",x,[(0,t.Wm)(ae,{type:"number",dense:"",outlined:"",label:"Начальное кол-во",class:"q-mb-md",modelValue:$.value.init_amount,"onUpdate:modelValue":l[7]||(l[7]=e=>$.value.init_amount=e)},null,8,["modelValue"])]),(0,t._)("div",C,[(0,t.Wm)(d,{outlined:"",dense:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:$.value.unit,"onUpdate:modelValue":l[8]||(l[8]=e=>$.value.unit=e),options:Y,label:"Ед. измерения"},null,8,["modelValue"])])]),(0,t.Wm)(ae,{class:"q-mb-md",dense:"",outlined:"",label:"Серийные номера",type:"textarea",modelValue:$.value.serial_numbers,"onUpdate:modelValue":l[9]||(l[9]=e=>$.value.serial_numbers=e)},null,8,["modelValue"]),(0,t.Wm)(ue,{outlined:"",dense:"",label:"Фото",modelValue:I.value,"onUpdate:modelValue":l[10]||(l[10]=e=>I.value=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(de,{align:"center"},{default:(0,t.w5)((()=>[(0,t.Wm)(N,{label:"Сохранить",disable:!$.value.store,loading:z.value,"no-caps":"",color:"positive",type:"submit"},null,8,["disable","loading"]),(0,t.wy)((0,t.Wm)(N,{label:"Отмена",loading:z.value,"no-caps":"",color:"dark"},null,8,["loading"]),[[ce]])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var H=a(7817),T=a(900),z=a(926),F=a(9800),I=a(4106),P=a(6384),j=a(490),S=a(6749),$=a(3115),Y=a(8879),B=a(1746),K=a(1233),O=a(1682),A=a(7220),E=a(1006),L=a(335),G=a(3119),J=a(2074),M=a(4458),N=a(8326),R=a(3190),X=a(3837),ee=a(1821),le=a(2146),ae=a(9984),te=a.n(ae);const oe=D,ie=oe;te()(D,"components",{QTabs:H.Z,QTab:T.Z,QSeparator:z.Z,QTabPanels:F.Z,QTabPanel:I.Z,QSelect:P.Z,QItem:j.Z,QItemSection:S.Z,QItemLabel:$.Z,QBtn:Y.Z,QTable:B.Z,QTr:K.Z,QTh:O.Z,QTd:A.Z,QCheckbox:E.Z,QImg:L.Z,QInput:G.Z,QDialog:J.Z,QCard:M.Z,QForm:N.Z,QCardSection:R.Z,QFile:X.Z,QCardActions:ee.Z}),te()(D,"directives",{ClosePopup:le.Z})}}]);