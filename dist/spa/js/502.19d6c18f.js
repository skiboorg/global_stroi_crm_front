"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[502],{8203:(e,l,a)=>{a.d(l,{Z:()=>c});var t=a(9835);function s(e,l){const a=(0,t.up)("q-btn");return(0,t.wg)(),(0,t.j4)(a,{"no-caps":"",outline:"",color:"primary",label:"Назад",icon:"arrow_back",class:"q-mr-md",onClick:l[0]||(l[0]=l=>e.$router.back())})}var o=a(1639),n=a(8879),d=a(9984),r=a.n(d);const i={},u=(0,o.Z)(i,[["render",s]]),c=u;r()(i,"components",{QBtn:n.Z})},3502:(e,l,a)=>{a.r(l),a.d(l,{default:()=>ie});var t=a(9835),s=a(6970),o=a(1957),n=a(8203),d=a(1569),r=a(499),i=a(8339),u=a(9876),c=a(6928);const _={class:"flex items-center q-mb-lg"},p={class:"no-margin text-h6 text-bold"},w={class:"row q-col-gutter-md q-mb-md"},m={class:"col-12 col-md-3"},b={class:"row items-center justify-end"},v={class:"row items-center justify-end"},g={class:"col-12 col-md-3"},y={class:"text-h6 text-bold"},f={class:"info-table full-width q-mb-lg"},k=(0,t._)("td",{style:{width:"50%"},class:"text-bold"},"Количество авторизаций в системе, штук",-1),h={style:{width:"50%"}},x=(0,t._)("td",{style:{width:"50%"},class:"text-bold"},"Общее время в системе, часов",-1),q={style:{width:"50%"}},D=(0,t._)("td",{style:{width:"50%"},class:"text-bold"},"Оценка",-1),z={style:{width:"50%"}},W={class:"text-h6 text-bold"},j={key:0},Z={class:"text-bold"},Q={key:0},V={key:1},Y={key:2},C={key:3},H=(0,t._)("p",{class:"text-bold q-mb-sm"},"Задача: ",-1),P=(0,t._)("p",{class:"text-bold q-mb-sm"},"Результат выполнения задачи",-1),T={key:1,class:"q-mb-lg"},U={class:"text-h6 text-bold"},$={class:"info-table full-width"},B=(0,t._)("tr",null,[(0,t._)("td",{class:"text-bold"},"№"),(0,t._)("td",{class:"text-bold"},"Вопрос"),(0,t._)("td",{class:"text-bold"},"План"),(0,t._)("td",{class:"text-bold"},"Факт"),(0,t._)("td",{class:"text-bold"},"В процентах")],-1),F={key:2},M=(0,t._)("p",{class:"text-h6 text-bold"},"Финансовые показатели",-1),I={class:"info-table full-width q-mb-lg"},K=(0,t._)("td",{style:{width:"50%"}},"Заработная плата сотрудника на руки",-1),L={style:{width:"50%"},class:"text-bold"},S=(0,t._)("td",{style:{width:"50%"}},"Расходы организации на сотрудника",-1),E={style:{width:"50%"},class:"text-bold"},O={__name:"report",setup(e){(0,u.E)();const{user:l}=(0,c.t)(),a=(0,r.iH)({user__id:null,created_at_gte:null,created_at_lte:null}),O=(0,i.yj)(),A=(0,r.iH)([]),G=(0,r.iH)(""),J={sortBy:"desc",descending:!1,page:1,rowsPerPage:50},N=(0,r.iH)(0),R=[{name:"id",align:"left",label:"ID",field:e=>e.id,sortable:!0},{name:"created_at",align:"left",label:"Дата",field:e=>new Date(e.created_at).toLocaleDateString(),sortable:!0},{name:"priority",align:"left",label:"Приоритет",field:e=>e.priority,sortable:!0},{name:"is_done",align:"left",label:"Выполнено",field:e=>e.is_done,sortable:!0},{name:"task_value",align:"left",label:"Оценка",field:e=>e.task_value?e.task_value:"Нет",sortable:!0},{name:"task_value",align:"left",label:"Обратная связь",field:e=>e.user_comment?e.user_comment:"Нет",sortable:!0}];(0,t.wF)((async()=>{let e=new Date;e.setDate(e.getDate()-1),a.value.created_at_gte=e.toLocaleDateString().split(".").reverse().join("-"),a.value.created_at_lte=e.toLocaleDateString().split(".").reverse().join("-"),await ee("apply")}));const X=async()=>{let e;console.log("query_string",G.value),console.log("filters",a.value),e="own"===O.params.user_id?l.id:O.params.user_id;const t=await(0,d.api)(`/api/report/by_user?user_id=${e}&${G.value}`);console.log("data",t.data.tasks),A.value=t.data;let s=0,o=0;for(let l of t.data?.tasks)l.task_value&&(s+=l.task_value,o+=1);N.value=s>0?parseFloat(s/o).toFixed(0):0},ee=async e=>{if(G.value="","apply"===e)for(let[l,t]of Object.entries(a.value))console.log(l,t),t&&(G.value+=`${l}=${t}&`);"clear"===e&&(G.value="",a.value={created_at_gte:null,created_at_lte:null}),await X()};return(e,l)=>{const d=(0,t.up)("q-btn"),r=(0,t.up)("q-date"),i=(0,t.up)("q-popup-proxy"),u=(0,t.up)("q-icon"),c=(0,t.up)("q-input"),O=(0,t.up)("q-th"),G=(0,t.up)("q-tr"),X=(0,t.up)("q-td"),le=(0,t.up)("q-badge"),ae=(0,t.up)("q-table"),te=(0,t.up)("q-page"),se=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(te,{padding:""},{default:(0,t.w5)((()=>[(0,t._)("div",_,[(0,t.Wm)(n.Z),(0,t._)("p",p,"Отчет пользователя "+(0,s.zw)(A.value.user),1)]),(0,t._)("div",w,[(0,t._)("div",m,[(0,t.Wm)(c,{class:"q-mb-xs",outlined:"",dense:"",modelValue:a.value.created_at_gte,"onUpdate:modelValue":l[1]||(l[1]=e=>a.value.created_at_gte=e),label:"Отчет с"},{append:(0,t.w5)((()=>[(0,t.Wm)(u,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:a.value.created_at_gte,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value.created_at_gte=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",b,[(0,t.wy)((0,t.Wm)(d,{label:"Выбрать",color:"primary",flat:""},null,512),[[se]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(c,{outlined:"",dense:"",modelValue:a.value.created_at_lte,"onUpdate:modelValue":l[3]||(l[3]=e=>a.value.created_at_lte=e),label:"Отчет до"},{append:(0,t.w5)((()=>[(0,t.Wm)(u,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:a.value.created_at_lte,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.created_at_lte=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",v,[(0,t.wy)((0,t.Wm)(d,{label:"Выбрать",color:"primary",flat:""},null,512),[[se]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,t._)("div",g,[(0,t.wy)((0,t.Wm)(d,{class:"q-mb-sm full-width",label:"Применить фильтр",color:"positive",onClick:l[4]||(l[4]=e=>ee("apply")),unelevated:"","no-caps":""},null,512),[[se]]),(0,t.wy)((0,t.Wm)(d,{class:"full-width",label:"Сбросить фильтр",color:"dark",onClick:l[5]||(l[5]=e=>ee("clear")),unelevated:"","no-caps":""},null,512),[[se]])])]),(0,t._)("p",y,"Количество усилий "+(0,s.zw)(A.value.login_mark),1),(0,t._)("table",f,[(0,t._)("tr",null,[k,(0,t._)("td",h,(0,s.zw)(A.value.total_logins),1)]),(0,t._)("tr",null,[x,(0,t._)("td",q,(0,s.zw)(2*A.value.total_logins),1)]),(0,t._)("tr",null,[D,(0,t._)("td",z,(0,s.zw)(A.value.login_mark),1)])]),(0,t._)("p",W,[(0,t.Uk)("Качество усилий "),N.value>0?((0,t.wg)(),(0,t.iD)("span",j,(0,s.zw)(N.value),1)):(0,t.kq)("",!0)]),A.value.tasks?((0,t.wg)(),(0,t.j4)(ae,{key:0,flat:"",rows:A.value.tasks,columns:R,"hide-pagination":"","row-key":"id",pagination:J,"table-header-class":"table-header"},{header:(0,t.w5)((e=>[(0,t.Wm)(G,{props:e,class:"bg-grey-2"},{default:(0,t.w5)((()=>[(0,t.Wm)(O,{"auto-width":""}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(O,{key:l.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",Z,(0,s.zw)(l.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,t.w5)((e=>[(0,t.Wm)(G,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(X,{"auto-width":""},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{size:"sm",color:"primary",round:"",unelevated:"",dense:"",onClick:l=>e.expand=!e.expand,icon:e.expand?"visibility_off":"visibility"},null,8,["onClick","icon"])])),_:2},1024),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(X,{key:l.name,props:e},{default:(0,t.w5)((()=>["is_done"===l.name?((0,t.wg)(),(0,t.iD)("span",Q,[l.value?((0,t.wg)(),(0,t.j4)(u,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,t.wg)(),(0,t.j4)(u,{key:1,name:"close",size:"20px",color:"negative"}))])):"is_repeatable"===l.name?((0,t.wg)(),(0,t.iD)("span",V,[l.value?((0,t.wg)(),(0,t.j4)(u,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,t.wg)(),(0,t.j4)(u,{key:1,name:"close",size:"20px",color:"negative"}))])):"priority"===l.name?((0,t.wg)(),(0,t.iD)("span",Y,[1===l.value?((0,t.wg)(),(0,t.j4)(le,{key:0,color:"positive",label:"Низкий"})):2===l.value?((0,t.wg)(),(0,t.j4)(le,{key:1,color:"warning",label:"Средний"})):3===l.value?((0,t.wg)(),(0,t.j4)(le,{key:2,color:"negative",label:"Высокий"})):(0,t.kq)("",!0)])):((0,t.wg)(),(0,t.iD)("span",C,(0,s.zw)(l.value),1))])),_:2},1032,["props"])))),128))])),_:2},1032,["props"]),(0,t.wy)((0,t.Wm)(G,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(X,{colspan:"100%"},{default:(0,t.w5)((()=>[H,(0,t._)("p",null,(0,s.zw)(e.row.task),1),P,(0,t._)("p",null,(0,s.zw)(e.row.result),1)])),_:2},1024)])),_:2},1032,["props"]),[[o.F8,e.expand]])])),_:1},8,["rows"])):(0,t.kq)("",!0),A.value.form_result?((0,t.wg)(),(0,t.iD)("div",T,[(0,t._)("p",U,"Операционные показатели "+(0,s.zw)(A.value.form_rate),1),(0,t._)("table",$,[B,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(A.value.form_result,((e,l)=>((0,t.wg)(),(0,t.iD)("tr",{key:l},[(0,t._)("td",null,(0,s.zw)(l+1),1),(0,t._)("td",null,(0,s.zw)(e.label),1),(0,t._)("td",null,(0,s.zw)(e.plan_amount),1),(0,t._)("td",null,(0,s.zw)(e.fact_amount),1),(0,t._)("td",null,(0,s.zw)(e.percent_done),1)])))),128))])])):((0,t.wg)(),(0,t.iD)("p",F,"Назначеных задач не было ")),M,(0,t._)("table",I,[(0,t._)("tr",null,[K,(0,t._)("td",L,(0,s.zw)(A.value.period_income),1)]),(0,t._)("tr",null,[S,(0,t._)("td",E,(0,s.zw)(A.value.period_outcome),1)])])])),_:1})}}};var A=a(9885),G=a(3119),J=a(2857),N=a(2765),R=a(2535),X=a(8879),ee=a(1746),le=a(1233),ae=a(1682),te=a(7220),se=a(990),oe=a(2146),ne=a(9984),de=a.n(ne);const re=O,ie=re;de()(O,"components",{QPage:A.Z,QInput:G.Z,QIcon:J.Z,QPopupProxy:N.Z,QDate:R.Z,QBtn:X.Z,QTable:ee.Z,QTr:le.Z,QTh:ae.Z,QTd:te.Z,QBadge:se.Z}),de()(O,"directives",{ClosePopup:oe.Z})}}]);