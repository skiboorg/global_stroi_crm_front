"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[502],{8203:(e,l,a)=>{a.d(l,{Z:()=>c});var t=a(9835);function o(e,l){const a=(0,t.up)("q-btn");return(0,t.wg)(),(0,t.j4)(a,{"no-caps":"",outline:"",color:"primary",label:"Назад",icon:"arrow_back",class:"q-mr-md",onClick:l[0]||(l[0]=l=>e.$router.back())})}var s=a(1639),n=a(8879),r=a(9984),u=a.n(r);const d={},i=(0,s.Z)(d,[["render",o]]),c=i;u()(d,"components",{QBtn:n.Z})},3502:(e,l,a)=>{a.r(l),a.d(l,{default:()=>S});var t=a(9835),o=a(6970),s=a(1957),n=a(8203),r=a(1569),u=a(499),d=a(8339),i=a(9876);const c={class:"flex items-center q-mb-lg"},p={class:"no-margin text-h6 text-bold"},_={class:"row q-col-gutter-md q-mb-md"},m={class:"col-12 col-md-3"},w={class:"row items-center justify-end"},b={class:"row items-center justify-end"},v={class:"col-12 col-md-3"},g={key:0,class:"q-mb-lg"},f={class:"text-h6 text-bold"},y={class:"info-table full-width"},k=(0,t._)("tr",null,[(0,t._)("td",{class:"text-bold"},"№"),(0,t._)("td",{class:"text-bold"},"Вопрос"),(0,t._)("td",{class:"text-bold"},"План"),(0,t._)("td",{class:"text-bold"},"Факт"),(0,t._)("td",{class:"text-bold"},"%выполнения")],-1),x=(0,t._)("p",{class:"text-h6 text-bold"},"Задачи за период",-1),h={class:"text-bold"},q={key:0},W={key:1},D={key:2},j={key:3},z=(0,t._)("p",{class:"text-bold q-mb-sm"},"Задача: ",-1),Z=(0,t._)("p",{class:"text-bold q-mb-sm"},"Результат выполнения задачи",-1),Q={key:2},V={__name:"report",setup(e){(0,i.E)();const l=(0,u.iH)({user__id:null,created_at_gte:null,created_at_lte:null}),a=(0,d.yj)(),V=(0,u.iH)([]),Y=(0,u.iH)(""),C=[{name:"id",align:"left",label:"ID",field:e=>e.id,sortable:!0},{name:"created_at",align:"left",label:"Дата",field:e=>new Date(e.created_at).toLocaleDateString(),sortable:!0},{name:"priority",align:"left",label:"Приоритет",field:e=>e.priority,sortable:!0},{name:"is_done",align:"left",label:"Выполнено",field:e=>e.is_done,sortable:!0},{name:"task_value",align:"left",label:"Оценка",field:e=>e.task_value?e.task_value:"Нет",sortable:!0},{name:"task_value",align:"left",label:"Комент",field:e=>e.user_comment?e.user_comment:"Нет",sortable:!0}];(0,t.wF)((async()=>{await H()}));const H=async()=>{const e=await(0,r.api)(`/api/report/by_user?user_id=${a.params.user_id}&${Y.value}`);console.log(e.data),V.value=e.data},T=async e=>{if(Y.value="","apply"===e)for(let[a,t]of Object.entries(l.value))console.log(a,t),t&&(Y.value+=`${a}=${t}&`);"clear"===e&&(Y.value="",l.value={created_at_gte:null,created_at_lte:null}),await H()};return(e,a)=>{const r=(0,t.up)("q-btn"),u=(0,t.up)("q-date"),d=(0,t.up)("q-popup-proxy"),i=(0,t.up)("q-icon"),Y=(0,t.up)("q-input"),H=(0,t.up)("q-th"),$=(0,t.up)("q-tr"),M=(0,t.up)("q-td"),P=(0,t.up)("q-badge"),U=(0,t.up)("q-table"),B=(0,t.up)("q-page"),I=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(B,{padding:""},{default:(0,t.w5)((()=>[(0,t._)("div",c,[(0,t.Wm)(n.Z),(0,t._)("p",p,"Отчет пользователя "+(0,o.zw)(V.value.user),1)]),(0,t._)("div",_,[(0,t._)("div",m,[(0,t.Wm)(Y,{class:"q-mb-xs",outlined:"",dense:"",modelValue:l.value.created_at_gte,"onUpdate:modelValue":a[1]||(a[1]=e=>l.value.created_at_gte=e),label:"Отчет с"},{append:(0,t.w5)((()=>[(0,t.Wm)(i,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{modelValue:l.value.created_at_gte,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value.created_at_gte=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",w,[(0,t.wy)((0,t.Wm)(r,{label:"Выбрать",color:"primary",flat:""},null,512),[[I]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(Y,{outlined:"",dense:"",modelValue:l.value.created_at_lte,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.created_at_lte=e),label:"Отчет до"},{append:(0,t.w5)((()=>[(0,t.Wm)(i,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{modelValue:l.value.created_at_lte,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.created_at_lte=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",b,[(0,t.wy)((0,t.Wm)(r,{label:"Выбрать",color:"primary",flat:""},null,512),[[I]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,t._)("div",v,[(0,t.wy)((0,t.Wm)(r,{class:"q-mb-sm full-width",label:"Применить фильтр",color:"positive",onClick:a[4]||(a[4]=e=>T("apply")),unelevated:"","no-caps":""},null,512),[[I]]),(0,t.wy)((0,t.Wm)(r,{class:"full-width",label:"Сбросить фильтр",color:"dark",onClick:a[5]||(a[5]=e=>T("clear")),unelevated:"","no-caps":""},null,512),[[I]])])]),V.value.form_result?((0,t.wg)(),(0,t.iD)("div",g,[(0,t._)("p",f,"Средняя оценка за период "+(0,o.zw)(V.value.form_rate),1),(0,t._)("table",y,[k,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(V.value.form_result,((e,l)=>((0,t.wg)(),(0,t.iD)("tr",{key:l},[(0,t._)("td",null,(0,o.zw)(l+1),1),(0,t._)("td",null,(0,o.zw)(e.label),1),(0,t._)("td",null,(0,o.zw)(e.plan_amount),1),(0,t._)("td",null,(0,o.zw)(e.fact_amount),1),(0,t._)("td",null,(0,o.zw)(e.percent_done),1)])))),128))])])):(0,t.kq)("",!0),x,V.value.tasks?((0,t.wg)(),(0,t.j4)(U,{key:1,flat:"",rows:V.value.tasks,columns:C,"row-key":"id","table-header-class":"table-header"},{header:(0,t.w5)((e=>[(0,t.Wm)($,{props:e,class:"bg-grey-2"},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{"auto-width":""}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(H,{key:l.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",h,(0,o.zw)(l.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,t.w5)((e=>[(0,t.Wm)($,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(M,{"auto-width":""},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{size:"sm",color:"primary",round:"",unelevated:"",dense:"",onClick:l=>e.expand=!e.expand,icon:e.expand?"visibility_off":"visibility"},null,8,["onClick","icon"])])),_:2},1024),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(M,{key:l.name,props:e},{default:(0,t.w5)((()=>["is_done"===l.name?((0,t.wg)(),(0,t.iD)("span",q,[l.value?((0,t.wg)(),(0,t.j4)(i,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,t.wg)(),(0,t.j4)(i,{key:1,name:"close",size:"20px",color:"negative"}))])):"is_repeatable"===l.name?((0,t.wg)(),(0,t.iD)("span",W,[l.value?((0,t.wg)(),(0,t.j4)(i,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,t.wg)(),(0,t.j4)(i,{key:1,name:"close",size:"20px",color:"negative"}))])):"priority"===l.name?((0,t.wg)(),(0,t.iD)("span",D,[1===l.value?((0,t.wg)(),(0,t.j4)(P,{key:0,color:"positive",label:"Низкий"})):2===l.value?((0,t.wg)(),(0,t.j4)(P,{key:1,color:"warning",label:"Средний"})):3===l.value?((0,t.wg)(),(0,t.j4)(P,{key:2,color:"negative",label:"Высокий"})):(0,t.kq)("",!0)])):((0,t.wg)(),(0,t.iD)("span",j,(0,o.zw)(l.value),1))])),_:2},1032,["props"])))),128))])),_:2},1032,["props"]),(0,t.wy)((0,t.Wm)($,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(M,{colspan:"100%"},{default:(0,t.w5)((()=>[z,(0,t._)("p",null,(0,o.zw)(e.row.task),1),Z,(0,t._)("p",null,(0,o.zw)(e.row.result),1)])),_:2},1024)])),_:2},1032,["props"]),[[s.F8,e.expand]])])),_:1},8,["rows"])):((0,t.wg)(),(0,t.iD)("p",Q,"Назначеных задач не было "))])),_:1})}}};var Y=a(9885),C=a(3119),H=a(2857),T=a(2765),$=a(2535),M=a(8879),P=a(1746),U=a(1233),B=a(1682),I=a(7220),K=a(990),F=a(2146),E=a(9984),L=a.n(E);const O=V,S=O;L()(V,"components",{QPage:Y.Z,QInput:C.Z,QIcon:H.Z,QPopupProxy:T.Z,QDate:$.Z,QBtn:M.Z,QTable:P.Z,QTr:U.Z,QTh:B.Z,QTd:I.Z,QBadge:K.Z}),L()(V,"directives",{ClosePopup:F.Z})}}]);