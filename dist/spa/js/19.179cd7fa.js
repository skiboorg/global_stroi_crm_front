"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[19],{7019:(e,l,t)=>{t.r(l),t.d(l,{default:()=>j});var a=t(9835),o=t(6970),u=t(499),d=t(1569),n=(t(8550),t(1862),t(9876)),i=t(1375);const s=(0,a._)("div",{class:"flex items-center justify-between q-mb-md"},[(0,a._)("p",{class:"no-margin text-h6 text-bold"},"Финансовые показатели")],-1),_={class:"row q-col-gutter-md q-mb-lg"},r={class:"col-12 col-md-9"},c={class:"row items-center justify-end"},m={class:"row items-center justify-end"},p={class:"col-12 col-md-3"},w={border:"1",style:{width:"100%","border-collapse":"collapse"}},v=(0,a._)("thead",null,[(0,a._)("tr",{style:{"background-color":"#f2f2f2"}},[(0,a._)("th",null,"ФИО"),(0,a._)("th",null,"Период"),(0,a._)("th",null,"ЗП в день"),(0,a._)("th",null,"ЗП за период"),(0,a._)("th",null,"Расходы в день"),(0,a._)("th",null,"Расходы за период")])],-1),f={style:{"font-weight":"bold","background-color":"#e0f7fa"}},b=(0,a._)("td",null,"Итого",-1),g={__name:"finances",setup(e){const l=(0,n.E)(),t=(0,u.iH)({user__id:null,created_at_gte:"",created_at_lte:""}),g=(0,u.iH)([]),y=(0,u.iH)([]),h=(0,u.iH)(!1),W=((0,u.iH)(null),(0,u.iH)({q:"",role__id:""}),async()=>{t.value.user__id?g.value=g.value.filter((e=>e.user.id===t.value.user__id)):await V()});(0,a.wF)((async()=>{let e=new Date;e.setDate(e.getDate()-1),t.value.created_at_gte=e.toLocaleDateString().split(".").reverse().join("-"),t.value.created_at_lte=e.toLocaleDateString().split(".").reverse().join("-"),await q(),y.value=await l.getUsers(null,!0)}));const q=async()=>{const e=await(0,d.api)(`/api/report/finance?created_at_gte=${t.value.created_at_gte}&created_at_lte=${t.value.created_at_lte}`);g.value=e.data,t.value.user__id&&(g.value=g.value.filter((e=>e.user.id===t.value.user__id)))},k=async()=>{await q()},V=async()=>{t.value={user__id:null,created_at_gte:"",created_at_lte:""},await q()};return(e,l)=>{const u=(0,a.up)("q-item-label"),d=(0,a.up)("q-item-section"),n=(0,a.up)("q-item"),q=(0,a.up)("q-select"),z=(0,a.up)("q-btn"),D=(0,a.up)("q-date"),Z=(0,a.up)("q-popup-proxy"),Q=(0,a.up)("q-icon"),U=(0,a.up)("q-input"),Y=(0,a.up)("q-page"),x=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(Y,{padding:""},{default:(0,a.w5)((()=>[(0,a.Wm)(i.Z),s,(0,a._)("div",_,[(0,a._)("div",r,[(0,a.Wm)(q,{class:"q-mb-xs",dense:"",outlined:"",modelValue:t.value.user__id,"onUpdate:modelValue":[l[0]||(l[0]=e=>t.value.user__id=e),W],loading:h.value,options:y.value.filter((e=>e.role?.use_in_report)),"option-label":"fio",label:"Выберите пользователя","map-options":"","option-value":"id","emit-value":"","use-input":"",clearable:""},{option:(0,a.w5)((e=>[(0,a.Wm)(n,(0,o.vs)((0,a.F4)(e.itemProps)),{default:(0,a.w5)((()=>[(0,a.Wm)(d,{side:""},{default:(0,a.w5)((()=>[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.opt.role?.name),1)])),_:2},1024),(0,a.Wm)(u,{caption:""},{default:(0,a.w5)((()=>[(0,a.Uk)("Роль")])),_:1})])),_:2},1024),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(u,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.opt.fio),1)])),_:2},1024),(0,a.Wm)(u,{caption:""},{default:(0,a.w5)((()=>[(0,a.Uk)("ФИО")])),_:1})])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","loading","options"]),(0,a.Wm)(U,{class:"q-mb-xs",outlined:"",dense:"",modelValue:t.value.created_at_gte,"onUpdate:modelValue":l[2]||(l[2]=e=>t.value.created_at_gte=e),label:"Отчет с"},{append:(0,a.w5)((()=>[(0,a.Wm)(Q,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(D,{modelValue:t.value.created_at_gte,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value.created_at_gte=e),mask:"YYYY-MM-DD"},{default:(0,a.w5)((()=>[(0,a._)("div",c,[(0,a.wy)((0,a.Wm)(z,{label:"Выбрать",color:"primary",flat:""},null,512),[[x]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(U,{outlined:"",dense:"",modelValue:t.value.created_at_lte,"onUpdate:modelValue":l[4]||(l[4]=e=>t.value.created_at_lte=e),label:"Отчет до"},{append:(0,a.w5)((()=>[(0,a.Wm)(Q,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(Z,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(D,{modelValue:t.value.created_at_lte,"onUpdate:modelValue":l[3]||(l[3]=e=>t.value.created_at_lte=e),mask:"YYYY-MM-DD"},{default:(0,a.w5)((()=>[(0,a._)("div",m,[(0,a.wy)((0,a.Wm)(z,{label:"Выбрать",color:"primary",flat:""},null,512),[[x]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,a._)("div",p,[(0,a.wy)((0,a.Wm)(z,{class:"q-mb-sm full-width",label:"Применить фильтр",color:"positive",onClick:k,unelevated:"","no-caps":""},null,512),[[x]]),(0,a.wy)((0,a.Wm)(z,{class:"full-width",label:"Сбросить фильтр",color:"dark",onClick:V,unelevated:"","no-caps":""},null,512),[[x]])])]),(0,a._)("table",w,[v,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(g.value.users,(e=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id},[(0,a._)("td",null,(0,o.zw)(e.user?.fio),1),(0,a._)("td",null,(0,o.zw)(e.days_in_period),1),(0,a._)("td",null,(0,o.zw)(e.daily_payment),1),(0,a._)("td",null,(0,o.zw)(e.period_income),1),(0,a._)("td",null,(0,o.zw)(e.daily_rashod),1),(0,a._)("td",null,(0,o.zw)(e.period_outcome),1)])))),128)),(0,a._)("tr",f,[b,(0,a._)("td",null,(0,o.zw)(g.value.totals?.days_in_period),1),(0,a._)("td",null,(0,o.zw)(g.value.totals?.daily_payment),1),(0,a._)("td",null,(0,o.zw)(g.value.totals?.period_income),1),(0,a._)("td",null,(0,o.zw)(g.value.totals?.daily_rashod),1),(0,a._)("td",null,(0,o.zw)(g.value.totals?.period_outcome),1)])])])])),_:1})}}};var y=t(9885),h=t(6384),W=t(490),q=t(6749),k=t(3115),V=t(3119),z=t(2857),D=t(2765),Z=t(4939),Q=t(8879),U=t(2146),Y=t(9984),x=t.n(Y);const H=g,j=H;x()(g,"components",{QPage:y.Z,QSelect:h.Z,QItem:W.Z,QItemSection:q.Z,QItemLabel:k.Z,QInput:V.Z,QIcon:z.Z,QPopupProxy:D.Z,QDate:Z.Z,QBtn:Q.Z}),x()(g,"directives",{ClosePopup:U.Z})}}]);