"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[192],{1192:(e,l,a)=>{a.r(l),a.d(l,{default:()=>ne});var t=a(9835),o=a(6970),i=a(1957),n=a(499),u=a(1569),s=(a(4139),a(6928)),d=a(2637),p=a(8227);const m=(0,t._)("br",null,null,-1),r=(0,t._)("br",null,null,-1),c=(0,t._)("br",null,null,-1),w=(0,t._)("br",null,null,-1),v={class:"flex items-center justify-between q-mb-md"},b={class:"no-margin text-h6 text-bold"},_={class:"flex items-center wrap"},k=(0,t._)("p",{class:"q-mb-none q-mr-md"},"Список задач на ",-1),g={class:"row items-center justify-end"},f={class:"text-bold"},y={key:0},q={key:1},V={key:2},W={key:3,class:"no-margin ellipsis",style:{"max-width":"300px"}},h={class:"q-gutter-md"},x=(0,t._)("p",{class:"text-bold q-mb-sm"},"Задача: ",-1),Z=(0,t._)("p",{class:"text-bold q-mb-sm"},"Результат выполнения задачи",-1),D={key:2},Q=(0,t._)("p",{class:"text-bold q-mb-sm"},"Комментарий администратора",-1),U={key:3},j=(0,t._)("p",{class:"text-bold q-mb-sm"},"Коментарий к оценке",-1),C=(0,t._)("br",null,null,-1),z=(0,t._)("p",null,null,-1),H={class:"q-mb-md"},S={__name:"user_tasks",setup(e){(0,s.t)();const l=(0,n.iH)(!1),a=(0,n.iH)(!1),S=(0,n.iH)(!0),T=["Согласен","Не согласен","Нужно обсудить"],Y=((0,n.iH)("Согласен"),["10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00"]),$=[{label:"Низкий",value:1},{label:"Средний",value:2},{label:"Высокий",value:3}],P=(0,n.iH)({priority:1,task:null,dead_line_time:"20:00",is_repeatable:!1}),F=(0,n.iH)(null),I=(0,n.iH)([]),B={sortBy:"desc",descending:!1,page:1,rowsPerPage:50},L=[{name:"id",align:"left",label:"ID",field:e=>e.id,sortable:!0},{name:"priority",align:"left",label:"Приоритет",field:e=>e.priority,sortable:!0},{name:"user",align:"left",label:"Пользователь",field:e=>e.user.fio,sortable:!0},{name:"task",align:"left",label:"Задача",field:e=>e.task,sortable:!0},{name:"is_done",align:"left",label:"Выполнено",field:e=>e.is_done,sortable:!0},{name:"is_repeatable",align:"left",label:"Ежедневная",field:e=>e.is_repeatable,sortable:!0},{name:"dead_line_date",align:"left",label:"Выполнить до",field:e=>`${new Date(e.dead_line_date).toLocaleDateString()} ${e.dead_line_time}`,sortable:!0},{name:"task_value",align:"left",label:"Оценка",field:e=>e.task_value?e.task_value:"Нет",sortable:!0}];(0,t.wF)((async()=>{let e=new Date;F.value=e.toLocaleDateString().split(".").join("-"),await M()}));const M=async()=>{let e,l=F.value.split("-").reverse().join("-");e=S.value?await(0,u.api)(`/api/task/task?own=true&dead_line_date=${l}`):await(0,u.api)(`/api/task/task?dead_line_date=${l}`),I.value=e.data.results},K=async e=>{l.value=!l.value;await u.api.delete(`/api/task/task/${e}`);await M(),l.value=!l.value},E=async()=>{l.value=!l.value;await u.api.post("/api/task/task",P.value);(0,d.d)("positive","Задача добавлена"),a.value=!1,await M(),P.value={priority:1,task:null,dead_line_time:"20:00",is_repeatable:!1},l.value=!l.value},O=async e=>{l.value=!0;let a=new FormData,t={...e};delete t.user;for(let[l,i]of Object.entries(t))"file"!==l&&a.append(l,i);t.file&&a.append("file",t.file);try{await(0,u.api)({method:"patch",url:`/api/task/task/${t.id}`,data:a,headers:{"Content-Type":"multipart/form-data"}});(0,d.d)("positive","Задача обновлена"),await M(),l.value=!1}catch(o){(0,d.d)("negative","Проверьте входные данные"),l.value=!1}l.value=!1};return(e,n)=>{const u=(0,t.up)("q-card-section"),s=(0,t.up)("q-card"),d=(0,t.up)("q-expansion-item"),A=(0,t.up)("q-space"),G=(0,t.up)("q-btn"),J=(0,t.up)("q-date"),N=(0,t.up)("q-popup-proxy"),R=(0,t.up)("q-icon"),X=(0,t.up)("q-input"),ee=(0,t.up)("q-checkbox"),le=(0,t.up)("q-th"),ae=(0,t.up)("q-tr"),te=(0,t.up)("q-td"),oe=(0,t.up)("q-badge"),ie=(0,t.up)("q-file"),ne=(0,t.up)("q-select"),ue=(0,t.up)("q-table"),se=(0,t.up)("q-page"),de=(0,t.up)("q-form"),pe=(0,t.up)("q-dialog"),me=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(se,{padding:""},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{"expand-separator":"",icon:"help",label:"Описание раздела",class:"q-mb-md"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,null,{default:(0,t.w5)((()=>[(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Uk)(" Оценку задач осуществляет сотрудник организации с правами администратора системы. Оценка субъективная, администратор должен объяснить почему он оценил выполнение вашей задачи именно так."),m,r,(0,t.Uk)(" После оценки у задачи появляется оценка по 5 (пяти) бальной шкале и комментарий к ней. Система автоматически отправляет пользователю через телеграмм бот сообщение об оценки его задачи и комментарий почему такая оценка."),c,w,(0,t.Uk)(" Система автоматически, после выставления оценки, в разделе обратная связь выставляет комментарий пользователя – Согласен. Пользователь на конкретной задаче может изменить обратную связь на - не согласен или надо обсудить, при этом администратор в личном кабинете видит ответ пользователя. ")])),_:1})])),_:1})])),_:1}),(0,t._)("div",v,[(0,t._)("p",b,"Задачи на "+(0,o.zw)(F.value),1),(0,t.Wm)(A),(0,t.Wm)(G,{icon:"add",color:"primary","no-caps":"",unelevated:"",onClick:n[0]||(n[0]=e=>a.value=!0),label:"Добавить"})]),(0,t._)("div",_,[k,(0,t.Wm)(X,{class:"q-mb-xs",outlined:"",dense:"",modelValue:F.value,"onUpdate:modelValue":n[2]||(n[2]=e=>F.value=e),label:"Выберте дату"},{append:(0,t.w5)((()=>[(0,t.Wm)(R,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(N,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(J,{modelValue:F.value,"onUpdate:modelValue":[n[1]||(n[1]=e=>F.value=e),M],mask:"DD-MM-YYYY"},{default:(0,t.w5)((()=>[(0,t._)("div",g,[(0,t.wy)((0,t.Wm)(G,{label:"Выбрать",color:"primary",flat:""},null,512),[[me]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(ee,{modelValue:S.value,"onUpdate:modelValue":[n[3]||(n[3]=e=>S.value=e),M],label:"Показывыть только мои задачи"},null,8,["modelValue"])]),(0,t.Wm)(ue,{flat:"",rows:I.value,columns:L,"row-key":"id","hide-pagination":"","table-header-class":"table-header",pagination:B},{header:(0,t.w5)((e=>[(0,t.Wm)(ae,{props:e,class:"bg-grey-2"},{default:(0,t.w5)((()=>[(0,t.Wm)(le,{"auto-width":""}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(le,{key:l.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",f,(0,o.zw)(l.label),1)])),_:2},1032,["props"])))),128)),(0,t.Wm)(le,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,t.w5)((e=>[(0,t.Wm)(ae,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(te,{"auto-width":""},{default:(0,t.w5)((()=>[(0,t.Wm)(G,{size:"sm",color:"primary",round:"",unelevated:"",dense:"",onClick:l=>e.expand=!e.expand,icon:e.expand?"visibility_off":"visibility"},null,8,["onClick","icon"])])),_:2},1024),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(te,{key:l.name,props:e},{default:(0,t.w5)((()=>["is_done"===l.name?((0,t.wg)(),(0,t.iD)("span",y,[l.value?((0,t.wg)(),(0,t.j4)(R,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,t.wg)(),(0,t.j4)(R,{key:1,name:"close",size:"20px",color:"negative"}))])):"is_repeatable"===l.name?((0,t.wg)(),(0,t.iD)("span",q,[l.value?((0,t.wg)(),(0,t.j4)(R,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,t.wg)(),(0,t.j4)(R,{key:1,name:"close",size:"20px",color:"negative"}))])):"priority"===l.name?((0,t.wg)(),(0,t.iD)("span",V,[1===l.value?((0,t.wg)(),(0,t.j4)(oe,{key:0,color:"positive",label:"Низкий"})):2===l.value?((0,t.wg)(),(0,t.j4)(oe,{key:1,color:"warning",label:"Средний"})):3===l.value?((0,t.wg)(),(0,t.j4)(oe,{key:2,color:"negative",label:"Высокий"})):(0,t.kq)("",!0)])):((0,t.wg)(),(0,t.iD)("p",W,(0,o.zw)(l.value),1))])),_:2},1032,["props"])))),128)),(0,t.Wm)(te,{"auto-width":""},{default:(0,t.w5)((()=>[(0,t._)("div",h,[(0,t.Wm)(p.Z,{onConfirm:l=>K(e.row.id)},null,8,["onConfirm"])])])),_:2},1024)])),_:2},1032,["props"]),(0,t.wy)((0,t.Wm)(ae,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(te,{colspan:"100%"},{default:(0,t.w5)((()=>[x,(0,t._)("p",null,(0,o.zw)(e.row.task),1),Z,(0,t.Wm)(X,{class:"q-mb-md",modelValue:e.row.result,"onUpdate:modelValue":l=>e.row.result=l,dense:"",type:"textarea",outlined:""},null,8,["modelValue","onUpdate:modelValue"]),e.row.is_done?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(ie,{key:0,class:"q-mb-md",modelValue:e.row.file,"onUpdate:modelValue":l=>e.row.file=l,dense:"",outlined:"",label:"Приложите файл, если требуется"},null,8,["modelValue","onUpdate:modelValue"])),e.row.is_done?(0,t.kq)("",!0):((0,t.wg)(),(0,t.j4)(G,{key:1,dense:"",color:"positive",icon:"save","no-caps":"",unelevated:"",label:"Задача выполнена",loading:l.value,onClick:l=>O(e.row)},null,8,["loading","onClick"])),e.row.admin_comment?((0,t.wg)(),(0,t.iD)("div",D,[Q,(0,t._)("p",null,(0,o.zw)(e.row.admin_comment),1)])):(0,t.kq)("",!0),e.row.task_value?((0,t.wg)(),(0,t.iD)("div",U,[j,(0,t.Wm)(ne,{outlined:"",modelValue:e.row.user_comment,"onUpdate:modelValue":l=>e.row.user_comment=l,options:T,label:"Комментарий к оценке"},null,8,["modelValue","onUpdate:modelValue"]),C,(0,t.Wm)(G,{dense:"",color:"positive",icon:"save","no-caps":"",unelevated:"",label:"Сохранить комментарий",loading:l.value,onClick:l=>O(e.row)},null,8,["loading","onClick"])])):(0,t.kq)("",!0)])),_:2},1024)])),_:2},1032,["props"]),[[i.F8,e.expand]])])),_:1},8,["rows"])])),_:1}),(0,t.Wm)(pe,{modelValue:a.value,"onUpdate:modelValue":n[8]||(n[8]=e=>a.value=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{style:{width:"700px","max-width":"100vw"}},{default:(0,t.w5)((()=>[(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Wm)(de,{onSubmit:(0,i.iM)(E,["prevent"])},{default:(0,t.w5)((()=>[(0,t.Wm)(ne,{outlined:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:P.value.priority,"onUpdate:modelValue":n[4]||(n[4]=e=>P.value.priority=e),options:$,label:"Приоритет"},null,8,["modelValue"]),(0,t.Wm)(X,{modelValue:P.value.task,"onUpdate:modelValue":n[5]||(n[5]=e=>P.value.task=e),type:"textarea",label:"Задача *",outlined:"","lazy-rules":"",rules:[e=>null!==e&&""!==e||"Это обязательное поле"]},null,8,["modelValue","rules"]),z,(0,t.Wm)(ne,{outlined:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:P.value.dead_line_time,"onUpdate:modelValue":n[6]||(n[6]=e=>P.value.dead_line_time=e),options:Y,label:`Выполнить ${(new Date).toLocaleDateString()} до`},null,8,["modelValue","label"]),(0,t._)("div",H,[(0,t.Wm)(ee,{modelValue:P.value.is_repeatable,"onUpdate:modelValue":n[7]||(n[7]=e=>P.value.is_repeatable=e),label:"Ежедневная задача"},null,8,["modelValue"])]),(0,t.Wm)(G,{icon:"save",color:"positive","no-caps":"",unelevated:"",type:"submit",loading:l.value,label:"Сохранить"},null,8,["loading"])])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var T=a(9885),Y=a(651),$=a(4458),P=a(3190),F=a(136),I=a(8879),B=a(3119),L=a(2857),M=a(2765),K=a(4939),E=a(1006),O=a(1746),A=a(1233),G=a(1682),J=a(7220),N=a(990),R=a(9420),X=a(6384),ee=a(2074),le=a(8326),ae=a(2146),te=a(9984),oe=a.n(te);const ie=S,ne=ie;oe()(S,"components",{QPage:T.Z,QExpansionItem:Y.Z,QCard:$.Z,QCardSection:P.Z,QSpace:F.Z,QBtn:I.Z,QInput:B.Z,QIcon:L.Z,QPopupProxy:M.Z,QDate:K.Z,QCheckbox:E.Z,QTable:O.Z,QTr:A.Z,QTh:G.Z,QTd:J.Z,QBadge:N.Z,QFile:R.Z,QSelect:X.Z,QDialog:ee.Z,QForm:le.Z}),oe()(S,"directives",{ClosePopup:ae.Z})}}]);