"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[192],{2637:(e,l,a)=>{a.d(l,{d:()=>n});var o=a(6827),t=a(8346);function n(e,l){o.Z.create({message:l,html:!0,color:e,position:t.Z.lt.sm?"bottom":"bottom-right"})}},4139:(e,l,a)=>{a.d(l,{Z:()=>w});var o=a(9835),t=a(499);const n={class:"row items-center justify-end"},u={__name:"DateInput",props:["label"],emits:["selected"],setup(e,{emit:l}){const a=(0,t.iH)(null),u=(0,t.iH)(null);return(l,t)=>{const i=(0,o.up)("q-btn"),s=(0,o.up)("q-date"),d=(0,o.up)("q-popup-proxy"),r=(0,o.up)("q-icon"),p=(0,o.up)("q-input"),m=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(p,{outlined:"",modelValue:a.value,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value=e),label:e.label},{append:(0,o.w5)((()=>[(0,o.Wm)(r,{name:"event",class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,o.w5)((()=>[(0,o.Wm)(s,{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=e=>u.value=e),mask:"YYYY-MM-DD"},{default:(0,o.w5)((()=>[(0,o._)("div",n,[(0,o.wy)((0,o.Wm)(i,{onClick:t[0]||(t[0]=e=>l.$emit("selected",u.value)),label:"Выбрать",color:"primary",flat:""},null,512),[[m]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","label"])}}};var i=a(3119),s=a(2857),d=a(2765),r=a(2535),p=a(8879),m=a(2146),c=a(9984),v=a.n(c);const b=u,w=b;v()(u,"components",{QInput:i.Z,QIcon:s.Z,QPopupProxy:d.Z,QDate:r.Z,QBtn:p.Z}),v()(u,"directives",{ClosePopup:m.Z})},8227:(e,l,a)=>{a.d(l,{Z:()=>b});var o=a(9835),t=a(499);const n={__name:"DeleteButton",props:["label","icon","loading","color"],emits:["confirm"],setup(e,{emit:l}){const a=(0,t.iH)(!1);return(l,t)=>{const n=(0,o.up)("q-btn"),u=(0,o.up)("q-card-section"),i=(0,o.up)("q-card-actions"),s=(0,o.up)("q-card"),d=(0,o.up)("q-dialog"),r=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)(o.HY,null,[l.auth.user.role?.permission?.can_add?((0,o.wg)(),(0,o.j4)(n,{key:0,"no-caps":"",unelevated:"",dense:"",loading:e.loading,color:e.color?e.color:"negative",label:e.label,onClick:t[0]||(t[0]=e=>a.value=!0),icon:e.icon?e.icon:"delete"},null,8,["loading","color","label","icon"])):(0,o.kq)("",!0),(0,o.Wm)(d,{modelValue:a.value,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(s,{style:{width:"300px","max-width":"100vw"}},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"text-center text-bold"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Вы уверены? ")])),_:1}),(0,o.Wm)(i,{align:"center"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(n,{color:"negative",unelevated:"","no-caps":"",label:"Да",onClick:t[1]||(t[1]=e=>l.$emit("confirm"))},null,512),[[r]]),(0,o.wy)((0,o.Wm)(n,{color:"positive",unelevated:"","no-caps":"",label:"Нет"},null,512),[[r]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var u=a(8879),i=a(2074),s=a(4458),d=a(3190),r=a(1821),p=a(2146),m=a(9984),c=a.n(m);const v=n,b=v;c()(n,"components",{QBtn:u.Z,QDialog:i.Z,QCard:s.Z,QCardSection:d.Z,QCardActions:r.Z}),c()(n,"directives",{ClosePopup:p.Z})},1192:(e,l,a)=>{a.r(l),a.d(l,{default:()=>pe});var o=a(9835),t=a(6970),n=a(1957),u=a(499),i=a(1569),s=(a(4139),a(6928)),d=a(2637),r=a(8227);const p=(0,o._)("br",null,null,-1),m=(0,o._)("br",null,null,-1),c=(0,o._)("br",null,null,-1),v=(0,o._)("br",null,null,-1),b=(0,o._)("br",null,null,-1),w=(0,o._)("br",null,null,-1),_=(0,o._)("br",null,null,-1),g=(0,o._)("br",null,null,-1),k=(0,o._)("br",null,null,-1),f=(0,o._)("br",null,null,-1),y={class:"flex items-center justify-between q-mb-md"},q={class:"no-margin text-h6 text-bold"},W={class:"flex items-center wrap"},V=(0,o._)("p",{class:"q-mb-none q-mr-md"},"Список задач на ",-1),x={class:"row items-center justify-end"},Z={class:"text-bold"},h={key:0},Q={key:1},D={key:2},C={key:3,class:"no-margin ellipsis",style:{"max-width":"300px"}},U={class:"q-gutter-md"},j=(0,o._)("p",{class:"text-bold q-mb-sm"},"Задача: ",-1),H=(0,o._)("p",{class:"text-bold q-mb-sm"},"Результат выполнения задачи",-1),Y={key:1},z=(0,o._)("p",{class:"text-bold q-mb-sm"},"Коментарий администратора",-1),P={key:2},S=(0,o._)("p",{class:"text-bold q-mb-sm"},"Коментарий к оценке",-1),$=(0,o._)("br",null,null,-1),I=(0,o._)("p",null,null,-1),B={class:"q-mb-md"},T={__name:"user_tasks",setup(e){(0,s.t)();const l=(0,u.iH)(!1),a=(0,u.iH)(!1),T=(0,u.iH)(!0),M=["Согласен","Не согласен","Нужно обсудить"],F=((0,u.iH)("Согласен"),["10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00"]),L=[{label:"Низкий",value:1},{label:"Средний",value:2},{label:"Высокий",value:3}],K=(0,u.iH)({priority:1,task:null,dead_line_time:"20:00",is_repeatable:!1}),A=(0,u.iH)(null),E=(0,u.iH)([]),G={sortBy:"desc",descending:!1,page:1,rowsPerPage:50},J=[{name:"id",align:"left",label:"ID",field:e=>e.id,sortable:!0},{name:"priority",align:"left",label:"Приоритет",field:e=>e.priority,sortable:!0},{name:"user",align:"left",label:"Пользоатель",field:e=>e.user.fio,sortable:!0},{name:"task",align:"left",label:"Задача",field:e=>e.task,sortable:!0},{name:"is_done",align:"left",label:"Выполнено",field:e=>e.is_done,sortable:!0},{name:"is_repeatable",align:"left",label:"Ежедневная",field:e=>e.is_repeatable,sortable:!0},{name:"dead_line_date",align:"left",label:"Выполнить до",field:e=>`${new Date(e.dead_line_date).toLocaleDateString()} ${e.dead_line_time}`,sortable:!0},{name:"task_value",align:"left",label:"Оценка",field:e=>e.task_value?e.task_value:"Нет",sortable:!0}];(0,o.wF)((async()=>{let e=new Date;A.value=e.toLocaleDateString().split(".").join("-"),await N()}));const N=async()=>{let e,l=A.value.split("-").reverse().join("-");e=T.value?await(0,i.api)(`/api/task/task?own=true&dead_line_date=${l}`):await(0,i.api)(`/api/task/task?dead_line_date=${l}`),E.value=e.data.results},O=async e=>{l.value=!l.value;await i.api.delete(`/api/task/task/${e}`);await N(),l.value=!l.value},R=async()=>{l.value=!l.value;await i.api.post("/api/task/task",K.value);(0,d.d)("positive","Задача добавлена"),a.value=!1,await N(),K.value={priority:1,task:null,dead_line_time:"20:00",is_repeatable:!1},l.value=!l.value},X=async e=>{l.value=!l.value,await i.api.patch(`/api/task/task/${e.id}`,{result:e.result,user_comment:e.user_comment}),(0,d.d)("positive","Задача обновлена"),await N(),l.value=!l.value};return(e,u)=>{const i=(0,o.up)("q-card-section"),s=(0,o.up)("q-card"),d=(0,o.up)("q-expansion-item"),ee=(0,o.up)("q-space"),le=(0,o.up)("q-btn"),ae=(0,o.up)("q-date"),oe=(0,o.up)("q-popup-proxy"),te=(0,o.up)("q-icon"),ne=(0,o.up)("q-input"),ue=(0,o.up)("q-checkbox"),ie=(0,o.up)("q-th"),se=(0,o.up)("q-tr"),de=(0,o.up)("q-td"),re=(0,o.up)("q-badge"),pe=(0,o.up)("q-select"),me=(0,o.up)("q-table"),ce=(0,o.up)("q-page"),ve=(0,o.up)("q-form"),be=(0,o.up)("q-dialog"),we=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(ce,{padding:""},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{"expand-separator":"",icon:"help",label:"Описание раздела",class:"q-mb-md"},{default:(0,o.w5)((()=>[(0,o.Wm)(s,null,{default:(0,o.w5)((()=>[(0,o.Wm)(i,null,{default:(0,o.w5)((()=>[(0,o.Uk)(" Оценку задач осуществляет сотрудник организации с правами администратора системы."),p,m,(0,o.Uk)(" У каждого отдела компании в соответствии с организационной структурой есть руководитель."),c,v,(0,o.Uk)(" Оценка субъективная, руководитель должен объяснить почему он оценил выполнение вашей задачи именно так."),b,w,(0,o.Uk)(" После оценки у задачи появляется оценка по 5 (пяти) бальной шкале и комментарий к ней. "),_,g,(0,o.Uk)(" Система автоматически, после выставления оценки, в раздел обратная связь выставляет комментарий пользователя – Согласен. "),k,f,(0,o.Uk)(" Пользователь на конкретной задаче может изменить обратную связь на - не согласен, надо обсудить. ")])),_:1})])),_:1})])),_:1}),(0,o._)("div",y,[(0,o._)("p",q,"Задачи на "+(0,t.zw)(A.value),1),(0,o.Wm)(ee),(0,o.Wm)(le,{icon:"add",color:"primary","no-caps":"",unelevated:"",onClick:u[0]||(u[0]=e=>a.value=!0),label:"Добавить"})]),(0,o._)("div",W,[V,(0,o.Wm)(ne,{class:"q-mb-xs",outlined:"",dense:"",modelValue:A.value,"onUpdate:modelValue":u[2]||(u[2]=e=>A.value=e),label:"Выберте дату"},{append:(0,o.w5)((()=>[(0,o.Wm)(te,{name:"event",class:"cursor-pointer"},{default:(0,o.w5)((()=>[(0,o.Wm)(oe,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,o.w5)((()=>[(0,o.Wm)(ae,{modelValue:A.value,"onUpdate:modelValue":[u[1]||(u[1]=e=>A.value=e),N],mask:"DD-MM-YYYY"},{default:(0,o.w5)((()=>[(0,o._)("div",x,[(0,o.wy)((0,o.Wm)(le,{label:"Выбрать",color:"primary",flat:""},null,512),[[we]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(ue,{modelValue:T.value,"onUpdate:modelValue":[u[3]||(u[3]=e=>T.value=e),N],label:"Показывыть только мои задачи"},null,8,["modelValue"])]),(0,o.Wm)(me,{flat:"",rows:E.value,columns:J,"row-key":"id","hide-pagination":"","table-header-class":"table-header",pagination:G},{header:(0,o.w5)((e=>[(0,o.Wm)(se,{props:e,class:"bg-grey-2"},{default:(0,o.w5)((()=>[(0,o.Wm)(ie,{"auto-width":""}),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.cols,(l=>((0,o.wg)(),(0,o.j4)(ie,{key:l.name,props:e},{default:(0,o.w5)((()=>[(0,o._)("span",Z,(0,t.zw)(l.label),1)])),_:2},1032,["props"])))),128)),(0,o.Wm)(ie,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,o.w5)((e=>[(0,o.Wm)(se,{props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(de,{"auto-width":""},{default:(0,o.w5)((()=>[(0,o.Wm)(le,{size:"sm",color:"primary",round:"",unelevated:"",dense:"",onClick:l=>e.expand=!e.expand,icon:e.expand?"visibility_off":"visibility"},null,8,["onClick","icon"])])),_:2},1024),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.cols,(l=>((0,o.wg)(),(0,o.j4)(de,{key:l.name,props:e},{default:(0,o.w5)((()=>["is_done"===l.name?((0,o.wg)(),(0,o.iD)("span",h,[l.value?((0,o.wg)(),(0,o.j4)(te,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,o.wg)(),(0,o.j4)(te,{key:1,name:"close",size:"20px",color:"negative"}))])):"is_repeatable"===l.name?((0,o.wg)(),(0,o.iD)("span",Q,[l.value?((0,o.wg)(),(0,o.j4)(te,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,o.wg)(),(0,o.j4)(te,{key:1,name:"close",size:"20px",color:"negative"}))])):"priority"===l.name?((0,o.wg)(),(0,o.iD)("span",D,[1===l.value?((0,o.wg)(),(0,o.j4)(re,{key:0,color:"positive",label:"Низкий"})):2===l.value?((0,o.wg)(),(0,o.j4)(re,{key:1,color:"warning",label:"Средний"})):3===l.value?((0,o.wg)(),(0,o.j4)(re,{key:2,color:"negative",label:"Высокий"})):(0,o.kq)("",!0)])):((0,o.wg)(),(0,o.iD)("p",C,(0,t.zw)(l.value),1))])),_:2},1032,["props"])))),128)),(0,o.Wm)(de,{"auto-width":""},{default:(0,o.w5)((()=>[(0,o._)("div",U,[(0,o.Wm)(r.Z,{onConfirm:l=>O(e.row.id)},null,8,["onConfirm"])])])),_:2},1024)])),_:2},1032,["props"]),(0,o.wy)((0,o.Wm)(se,{props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(de,{colspan:"100%"},{default:(0,o.w5)((()=>[j,(0,o._)("p",null,(0,t.zw)(e.row.task),1),H,(0,o.Wm)(ne,{class:"q-mb-md",modelValue:e.row.result,"onUpdate:modelValue":l=>e.row.result=l,dense:"",type:"textarea",outlined:""},null,8,["modelValue","onUpdate:modelValue"]),e.row.is_done?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(le,{key:0,dense:"",color:"positive",icon:"save","no-caps":"",unelevated:"",label:"Задача выполнена",loading:l.value,onClick:l=>X(e.row)},null,8,["loading","onClick"])),e.row.admin_comment?((0,o.wg)(),(0,o.iD)("div",Y,[z,(0,o._)("p",null,(0,t.zw)(e.row.admin_comment),1)])):(0,o.kq)("",!0),e.row.task_value?((0,o.wg)(),(0,o.iD)("div",P,[S,(0,o.Wm)(pe,{outlined:"",modelValue:e.row.user_comment,"onUpdate:modelValue":l=>e.row.user_comment=l,options:M,label:"Комментарий к оценке"},null,8,["modelValue","onUpdate:modelValue"]),$,(0,o.Wm)(le,{dense:"",color:"positive",icon:"save","no-caps":"",unelevated:"",label:"Сохранить коментарий",loading:l.value,onClick:l=>X(e.row)},null,8,["loading","onClick"])])):(0,o.kq)("",!0)])),_:2},1024)])),_:2},1032,["props"]),[[n.F8,e.expand]])])),_:1},8,["rows"])])),_:1}),(0,o.Wm)(be,{modelValue:a.value,"onUpdate:modelValue":u[8]||(u[8]=e=>a.value=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(s,{style:{width:"700px","max-width":"100vw"}},{default:(0,o.w5)((()=>[(0,o.Wm)(i,null,{default:(0,o.w5)((()=>[(0,o.Wm)(ve,{onSubmit:(0,n.iM)(R,["prevent"])},{default:(0,o.w5)((()=>[(0,o.Wm)(pe,{outlined:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:K.value.priority,"onUpdate:modelValue":u[4]||(u[4]=e=>K.value.priority=e),options:L,label:"Приоритет"},null,8,["modelValue"]),(0,o.Wm)(ne,{modelValue:K.value.task,"onUpdate:modelValue":u[5]||(u[5]=e=>K.value.task=e),type:"textarea",label:"Задача *",outlined:"","lazy-rules":"",rules:[e=>null!==e&&""!==e||"Это обязательное поле"]},null,8,["modelValue","rules"]),I,(0,o.Wm)(pe,{outlined:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:K.value.dead_line_time,"onUpdate:modelValue":u[6]||(u[6]=e=>K.value.dead_line_time=e),options:F,label:`Выполнить ${(new Date).toLocaleDateString()} до`},null,8,["modelValue","label"]),(0,o._)("div",B,[(0,o.Wm)(ue,{modelValue:K.value.is_repeatable,"onUpdate:modelValue":u[7]||(u[7]=e=>K.value.is_repeatable=e),label:"Ежедневная задача"},null,8,["modelValue"])]),(0,o.Wm)(le,{icon:"save",color:"positive","no-caps":"",unelevated:"",type:"submit",loading:l.value,label:"Сохранить"},null,8,["loading"])])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var M=a(9885),F=a(651),L=a(4458),K=a(3190),A=a(136),E=a(8879),G=a(3119),J=a(2857),N=a(2765),O=a(2535),R=a(1006),X=a(1746),ee=a(1233),le=a(1682),ae=a(7220),oe=a(990),te=a(6384),ne=a(2074),ue=a(8326),ie=a(2146),se=a(9984),de=a.n(se);const re=T,pe=re;de()(T,"components",{QPage:M.Z,QExpansionItem:F.Z,QCard:L.Z,QCardSection:K.Z,QSpace:A.Z,QBtn:E.Z,QInput:G.Z,QIcon:J.Z,QPopupProxy:N.Z,QDate:O.Z,QCheckbox:R.Z,QTable:X.Z,QTr:ee.Z,QTh:le.Z,QTd:ae.Z,QBadge:oe.Z,QSelect:te.Z,QDialog:ne.Z,QForm:ue.Z}),de()(T,"directives",{ClosePopup:ie.Z})}}]);