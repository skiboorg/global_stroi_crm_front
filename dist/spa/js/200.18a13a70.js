"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[200],{2637:(e,l,a)=>{a.d(l,{d:()=>o});var n=a(6827),t=a(8346);function o(e,l){n.Z.create({message:l,html:!0,color:e,position:t.Z.lt.sm?"bottom":"bottom-right"})}},8550:(e,l,a)=>{a.d(l,{Z:()=>r});var n=a(9835);const t={__name:"AddButton",props:["label","icon","loading","color"],setup(e){return(l,a)=>{const t=(0,n.up)("q-btn");return l.auth.user.role?.permission?.can_add?((0,n.wg)(),(0,n.j4)(t,{key:0,"no-caps":"",unelevated:"",loading:e.loading,color:e.color?e.color:"primary",label:e.label,icon:e.icon?e.icon:"add"},null,8,["loading","color","label","icon"])):(0,n.kq)("",!0)}}};var o=a(8879),u=a(9984),d=a.n(u);const i=t,r=i;d()(t,"components",{QBtn:o.Z})},8203:(e,l,a)=>{a.d(l,{Z:()=>c});var n=a(9835);function t(e,l){const a=(0,n.up)("q-btn");return(0,n.wg)(),(0,n.j4)(a,{"no-caps":"",outline:"",color:"primary",label:"Назад",icon:"arrow_back",class:"q-mr-md",onClick:l[0]||(l[0]=l=>e.$router.back())})}var o=a(1639),u=a(8879),d=a(9984),i=a.n(d);const r={},s=(0,o.Z)(r,[["render",t]]),c=s;i()(r,"components",{QBtn:u.Z})},4139:(e,l,a)=>{a.d(l,{Z:()=>b});var n=a(9835),t=a(499);const o={class:"row items-center justify-end"},u={__name:"DateInput",props:["label"],emits:["selected"],setup(e,{emit:l}){const a=(0,t.iH)(null),u=(0,t.iH)(null);return(l,t)=>{const d=(0,n.up)("q-btn"),i=(0,n.up)("q-date"),r=(0,n.up)("q-popup-proxy"),s=(0,n.up)("q-icon"),c=(0,n.up)("q-input"),m=(0,n.Q2)("close-popup");return(0,n.wg)(),(0,n.j4)(c,{outlined:"",modelValue:a.value,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value=e),label:e.label},{append:(0,n.w5)((()=>[(0,n.Wm)(s,{name:"event",class:"cursor-pointer"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,n.w5)((()=>[(0,n.Wm)(i,{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=e=>u.value=e),mask:"YYYY-MM-DD"},{default:(0,n.w5)((()=>[(0,n._)("div",o,[(0,n.wy)((0,n.Wm)(d,{onClick:t[0]||(t[0]=e=>l.$emit("selected",u.value)),label:"Выбрать",color:"primary",flat:""},null,512),[[m]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","label"])}}};var d=a(3119),i=a(2857),r=a(2765),s=a(2535),c=a(8879),m=a(2146),p=a(9984),v=a.n(p);const _=u,b=_;v()(u,"components",{QInput:d.Z,QIcon:i.Z,QPopupProxy:r.Z,QDate:s.Z,QBtn:c.Z}),v()(u,"directives",{ClosePopup:m.Z})},8227:(e,l,a)=>{a.d(l,{Z:()=>_});var n=a(9835),t=a(499);const o={__name:"DeleteButton",props:["label","icon","loading","color"],emits:["confirm"],setup(e,{emit:l}){const a=(0,t.iH)(!1);return(l,t)=>{const o=(0,n.up)("q-btn"),u=(0,n.up)("q-card-section"),d=(0,n.up)("q-card-actions"),i=(0,n.up)("q-card"),r=(0,n.up)("q-dialog"),s=(0,n.Q2)("close-popup");return(0,n.wg)(),(0,n.iD)(n.HY,null,[l.auth.user.role?.permission?.can_add?((0,n.wg)(),(0,n.j4)(o,{key:0,"no-caps":"",unelevated:"",dense:"",loading:e.loading,color:e.color?e.color:"negative",label:e.label,onClick:t[0]||(t[0]=e=>a.value=!0),icon:e.icon?e.icon:"delete"},null,8,["loading","color","label","icon"])):(0,n.kq)("",!0),(0,n.Wm)(r,{modelValue:a.value,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value=e)},{default:(0,n.w5)((()=>[(0,n.Wm)(i,{style:{width:"300px","max-width":"100vw"}},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{class:"text-center text-bold"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Вы уверены? ")])),_:1}),(0,n.Wm)(d,{align:"center"},{default:(0,n.w5)((()=>[(0,n.wy)((0,n.Wm)(o,{color:"negative",unelevated:"","no-caps":"",label:"Да",onClick:t[1]||(t[1]=e=>l.$emit("confirm"))},null,512),[[s]]),(0,n.wy)((0,n.Wm)(o,{color:"positive",unelevated:"","no-caps":"",label:"Нет"},null,512),[[s]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var u=a(8879),d=a(2074),i=a(4458),r=a(3190),s=a(1821),c=a(2146),m=a(9984),p=a.n(m);const v=o,_=v;p()(o,"components",{QBtn:u.Z,QDialog:d.Z,QCard:i.Z,QCardSection:r.Z,QCardActions:s.Z}),p()(o,"directives",{ClosePopup:c.Z})},1862:(e,l,a)=>{a.d(l,{Z:()=>r});var n=a(9835);const t={__name:"EditButton",props:["label","icon","color"],setup(e){return(l,a)=>{const t=(0,n.up)("q-btn");return l.auth.user.role?.permission?.can_edit?((0,n.wg)(),(0,n.j4)(t,{key:0,"no-caps":"",unelevated:"",color:e.color,label:e.label,icon:e.icon?e.icon:"edit"},null,8,["color","label","icon"])):(0,n.kq)("",!0)}}};var o=a(8879),u=a(9984),d=a.n(u);const i=t,r=i;d()(t,"components",{QBtn:o.Z})},2200:(e,l,a)=>{a.r(l),a.d(l,{default:()=>Y});var n=a(9835),t=a(6970),o=a(499),u=a(1569),d=a(8550),i=a(1862),r=a(9876),s=a(4139),c=a(2637),m=a(8227);a(8203);const p={class:"flex items-center justify-between q-mb-md"},v=(0,n._)("p",{class:"no-margin text-h6 text-bold"},"Доверенности ",-1),_={class:"row q-col-gutter-md q-mb-md"},b={class:"col-12 col-md-10"},w={class:"col-12 col-md-2"},g={class:"text-bold"},f=["innerHTML"],q={class:"q-gutter-md"},Z={__name:"doverennosti",setup(e){(0,r.E)();const l=[{name:"inner_id",align:"left",label:"Номер",field:e=>e.inner_id,sortable:!0},{name:"name",align:"left",label:"Наименование",field:e=>e.name,sortable:!0},{name:"receiver",align:"left",label:"Получатель",field:e=>e.receiver,sortable:!0},{name:"start_date",align:"left",label:"Дата начала",field:e=>new Date(e.start_date).toLocaleDateString(),sortable:!0},{name:"end_date",align:"left",label:"Дата окончания",field:e=>new Date(e.end_date).toLocaleDateString(),sortable:!0},{name:"amount",align:"left",label:"Кол-во экземпляров",field:e=>e.amount,sortable:!0}],a=(0,o.iH)(!1),Z=((0,o.iH)(!1),(0,o.iH)({}),(0,o.iH)(null),(0,o.iH)({id:null,name:null,inner_id:null,receiver:null,start_date:null,end_date:null,amount:null})),V={sortBy:"desc",descending:!1,page:1,rowsPerPage:15},W=(0,o.iH)(1),y=(0,o.iH)(!1),k=(0,o.iH)([]),Q=(0,o.iH)(5),h=((0,o.iH)(null),(0,o.iH)({q:""})),D=async()=>{console.log(W.value),await C()};(0,n.wF)((async()=>{await C()}));const C=async()=>{y.value=!y.value;const e=await(0,u.api)(`/api/catalog/doverennost?page=${W.value}&q=${h.value.q}`);k.value=e.data.results,Q.value=Math.ceil(e.data.count/15),y.value=!y.value},H=async e=>{await u.api.delete(`/api/catalog/doverennost/${e}`),await C()},x=e=>{e?(Z.value=e,Z.value.start_date=Z.value.start_date?new Date(Z.value.start_date).toLocaleDateString():null,Z.value.end_date=Z.value.end_date?new Date(Z.value.end_date).toLocaleDateString():null):Z.value={id:null,inner_id:null,name:null,receiver:null,start_date:null,end_date:null,amount:null},a.value=!0},U=e=>{const l=e.split(".");return`${l[2]}-${l[1]}-${l[0]}`},S=async()=>{if(Z.value.start_date&&(Z.value.start_date=U(Z.value.start_date)),Z.value.end_date&&(Z.value.end_date=U(Z.value.end_date)),Z.value.id){await u.api.patch(`/api/catalog/doverennost/${Z.value.id}`,Z.value);(0,c.d)("positive","Данные обновлены")}else{await u.api.post("/api/catalog/doverennost",Z.value);(0,c.d)("positive","Создан")}await C(),a.value=!1},j=e=>{Z.value.start_date=new Date(e).toLocaleDateString()},B=e=>{Z.value.end_date=new Date(e).toLocaleDateString()};return(e,o)=>{const u=(0,n.up)("q-space"),r=(0,n.up)("q-input"),c=(0,n.up)("q-btn"),U=(0,n.up)("q-th"),$=(0,n.up)("q-tr"),P=(0,n.up)("q-td"),L=(0,n.up)("q-table"),T=(0,n.up)("q-pagination"),Y=(0,n.up)("q-page"),M=(0,n.up)("q-card-section"),I=(0,n.up)("q-card-actions"),A=(0,n.up)("q-form"),z=(0,n.up)("q-card"),E=(0,n.up)("q-dialog"),F=(0,n.Q2)("close-popup");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(Y,{padding:""},{default:(0,n.w5)((()=>[(0,n._)("div",p,[v,(0,n.Wm)(u),(0,n.Wm)(d.Z,{icon:"add",label:"Добавить",onClick:o[0]||(o[0]=e=>x(null))})]),(0,n._)("div",_,[(0,n._)("div",b,[(0,n.Wm)(r,{dense:"",modelValue:h.value.q,"onUpdate:modelValue":o[1]||(o[1]=e=>h.value.q=e),label:"Поиск по названию, номеру, получателю",outlined:""},null,8,["modelValue"])]),(0,n._)("div",w,[(0,n.Wm)(c,{class:"full-width",label:"Найти","no-caps":"",color:"primary",unelevated:"",onClick:C})])]),(0,n.Wm)(L,{flat:"",rows:k.value,columns:l,"row-key":"name","hide-pagination":"",pagination:V,"onUpdate:pagination":o[2]||(o[2]=e=>V=e),loading:y.value,"table-header-class":"table-header"},{header:(0,n.w5)((e=>[(0,n.Wm)($,{props:e,class:"bg-grey-2"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.cols,(l=>((0,n.wg)(),(0,n.j4)(U,{key:l.name,props:e},{default:(0,n.w5)((()=>[(0,n._)("span",g,(0,t.zw)(l.label),1)])),_:2},1032,["props"])))),128)),(0,n.Wm)(U,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,n.w5)((e=>[(0,n.Wm)($,{props:e},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.cols,(l=>((0,n.wg)(),(0,n.j4)(P,{key:l.name,props:e},{default:(0,n.w5)((()=>[(0,n._)("span",{innerHTML:l.value},null,8,f)])),_:2},1032,["props"])))),128)),(0,n.Wm)(P,{"auto-width":""},{default:(0,n.w5)((()=>[(0,n._)("div",q,[(0,n.Wm)(i.Z,{dense:"",onClick:l=>x(e.row)},null,8,["onClick"]),(0,n.Wm)(m.Z,{onConfirm:l=>H(e.row.id)},null,8,["onConfirm"])])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","loading"]),(0,n.Wm)(T,{modelValue:W.value,"onUpdate:modelValue":[o[3]||(o[3]=e=>W.value=e),D],max:Q.value,"max-pages":6,"direction-links":"","boundary-numbers":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])),_:1}),(0,n.Wm)(E,{modelValue:a.value,"onUpdate:modelValue":o[10]||(o[10]=e=>a.value=e)},{default:(0,n.w5)((()=>[(0,n.Wm)(z,{style:{width:"700px","max-width":"100vw"}},{default:(0,n.w5)((()=>[(0,n.Wm)(A,{onSubmit:S},{default:(0,n.w5)((()=>[(0,n.Wm)(M,{class:"q-pb-none"},{default:(0,n.w5)((()=>[Z.value.inner_id?((0,n.wg)(),(0,n.j4)(r,{key:0,class:"q-mb-md",outlined:"",dense:"",label:"Внутренний номер",modelValue:Z.value.inner_id,"onUpdate:modelValue":o[4]||(o[4]=e=>Z.value.inner_id=e)},null,8,["modelValue"])):(0,n.kq)("",!0),(0,n.Wm)(r,{outlined:"",dense:"",label:"Наименование документа",modelValue:Z.value.name,"onUpdate:modelValue":o[5]||(o[5]=e=>Z.value.name=e),"lazy-rules":"",rules:[e=>null!==e&&""!==e||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,n.Wm)(r,{class:"q-mb-md",outlined:"",dense:"",label:"Получатель",modelValue:Z.value.receiver,"onUpdate:modelValue":o[6]||(o[6]=e=>Z.value.receiver=e)},null,8,["modelValue"]),(0,n.Wm)(s.Z,{dense:"",class:"q-mb-md",modelValue:Z.value.start_date,"onUpdate:modelValue":o[7]||(o[7]=e=>Z.value.start_date=e),label:"Дата начала",onSelected:j},null,8,["modelValue"]),(0,n.Wm)(s.Z,{dense:"",class:"q-mb-md",modelValue:Z.value.end_date,"onUpdate:modelValue":o[8]||(o[8]=e=>Z.value.end_date=e),label:"Дата окончания",onSelected:B},null,8,["modelValue"]),(0,n.Wm)(r,{class:"q-mb-md",outlined:"",dense:"",label:"Кол-во экземпляров",type:"number",modelValue:Z.value.amount,"onUpdate:modelValue":o[9]||(o[9]=e=>Z.value.amount=e)},null,8,["modelValue"])])),_:1}),(0,n.Wm)(I,{align:"center"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{label:"Сохранить",type:"submit","no-caps":"",color:"positive"}),(0,n.wy)((0,n.Wm)(c,{label:"Отмена","no-caps":"",color:"dark"},null,512),[[F]])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var V=a(9885),W=a(136),y=a(3119),k=a(8879),Q=a(1746),h=a(1233),D=a(1682),C=a(7220),H=a(996),x=a(2074),U=a(4458),S=a(8326),j=a(3190),B=a(1821),$=a(2146),P=a(9984),L=a.n(P);const T=Z,Y=T;L()(Z,"components",{QPage:V.Z,QSpace:W.Z,QInput:y.Z,QBtn:k.Z,QTable:Q.Z,QTr:h.Z,QTh:D.Z,QTd:C.Z,QPagination:H.Z,QDialog:x.Z,QCard:U.Z,QForm:S.Z,QCardSection:j.Z,QCardActions:B.Z}),L()(Z,"directives",{ClosePopup:$.Z})}}]);