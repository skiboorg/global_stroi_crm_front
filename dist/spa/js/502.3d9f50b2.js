"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[502],{8203:(e,l,a)=>{a.d(l,{Z:()=>c});var t=a(9835);function o(e,l){const a=(0,t.up)("q-btn");return(0,t.wg)(),(0,t.j4)(a,{"no-caps":"",outline:"",color:"primary",label:"Назад",icon:"arrow_back",class:"q-mr-md",onClick:l[0]||(l[0]=l=>e.$router.back())})}var s=a(1639),n=a(8879),r=a(9984),d=a.n(r);const u={},i=(0,s.Z)(u,[["render",o]]),c=i;d()(u,"components",{QBtn:n.Z})},3502:(e,l,a)=>{a.r(l),a.d(l,{default:()=>fe});var t=a(9835),o=a(6970),s=a(1957),n=a(8203),r=a(1569),d=a(499),u=a(8339),i=a(9876),c=a(6928);const _=(0,t._)("br",null,null,-1),p=(0,t._)("br",null,null,-1),m=(0,t._)("br",null,null,-1),w=(0,t._)("br",null,null,-1),b=(0,t._)("br",null,null,-1),g=(0,t._)("br",null,null,-1),v=(0,t._)("br",null,null,-1),f={class:"flex items-center q-mb-lg"},y={class:"no-margin text-h6 text-bold"},k={class:"row q-col-gutter-md q-mb-md"},h={class:"col-12 col-md-3"},x={class:"row items-center justify-end"},q={class:"row items-center justify-end"},D={class:"col-12 col-md-3"},z={class:"text-h6 text-bold"},W={class:"info-table full-width q-mb-lg"},Z=(0,t._)("td",{style:{width:"50%"},class:"text-bold"},"Количество авторизаций в системе, штук",-1),j={style:{width:"50%"}},Q=(0,t._)("td",{style:{width:"50%"},class:"text-bold"},"Общее время в системе, часов",-1),V={style:{width:"50%"}},Y=(0,t._)("td",{style:{width:"50%"},class:"text-bold"},"Оценка",-1),C={style:{width:"50%"}},U={class:"text-h6 text-bold"},H={key:0},P={class:"text-bold"},T={key:0},S={key:1},$={key:2},B={key:3},F=(0,t._)("p",{class:"text-bold q-mb-sm"},"Задача: ",-1),I=(0,t._)("p",{class:"text-bold q-mb-sm"},"Результат выполнения задачи",-1),L={key:1,class:"q-mb-lg"},M={class:"text-h6 text-bold"},K={class:"info-table full-width"},E=(0,t._)("tr",null,[(0,t._)("td",{class:"text-bold"},"№"),(0,t._)("td",{class:"text-bold"},"Вопрос"),(0,t._)("td",{class:"text-bold"},"План"),(0,t._)("td",{class:"text-bold"},"Факт"),(0,t._)("td",{class:"text-bold"},"В процентах")],-1),O={key:2},A=(0,t._)("p",{class:"text-h6 text-bold"},"Финансовые показатели",-1),G={class:"info-table full-width q-mb-lg"},J=(0,t._)("td",{style:{width:"50%"}},"Заработная плата сотрудника на руки",-1),N={style:{width:"50%"},class:"text-bold"},R=(0,t._)("td",{style:{width:"50%"}},"Расходы организации на сотрудника",-1),X={style:{width:"50%"},class:"text-bold"},ee={__name:"report",setup(e){(0,i.E)();const{user:l}=(0,c.t)(),a=(0,d.iH)({user__id:null,created_at_gte:null,created_at_lte:null}),ee=(0,u.yj)(),le=(0,d.iH)([]),ae=(0,d.iH)(""),te={sortBy:"desc",descending:!1,page:1,rowsPerPage:50},oe=(0,d.iH)(0),se=[{name:"id",align:"left",label:"ID",field:e=>e.id,sortable:!0},{name:"created_at",align:"left",label:"Дата создания",field:e=>new Date(e.created_at).toLocaleDateString(),sortable:!0},{name:"created_at",align:"left",label:"Крайний срок",field:e=>new Date(e.dead_line_date).toLocaleDateString(),sortable:!0},{name:"priority",align:"left",label:"Приоритет",field:e=>e.priority,sortable:!0},{name:"is_done",align:"left",label:"Выполнено",field:e=>e.is_done,sortable:!0},{name:"task_value",align:"left",label:"Оценка",field:e=>e.task_value?e.task_value:"Нет",sortable:!0},{name:"task_value",align:"left",label:"Обратная связь",field:e=>e.user_comment?e.user_comment:"Нет",sortable:!0}];(0,t.wF)((async()=>{let e=new Date;e.setDate(e.getDate()-1),a.value.created_at_gte=e.toLocaleDateString().split(".").reverse().join("-"),a.value.created_at_lte=e.toLocaleDateString().split(".").reverse().join("-"),await re("apply")}));const ne=async()=>{let e;console.log("query_string",ae.value),console.log("filters",a.value),e="own"===ee.params.user_id?l.id:ee.params.user_id;const t=await(0,r.api)(`/api/report/by_user?user_id=${e}&${ae.value}`);console.log("data",t.data.tasks),le.value=t.data;let o=0,s=0;for(let l of t.data?.tasks)l.task_value&&(o+=l.task_value,s+=1);oe.value=o>0?parseFloat(o/s).toFixed(0):0},re=async e=>{if(ae.value="","apply"===e)for(let[l,t]of Object.entries(a.value))console.log(l,t),t&&(ae.value+=`${l}=${t}&`);"clear"===e&&(ae.value="",a.value={created_at_gte:null,created_at_lte:null}),await ne()};return(e,l)=>{const r=(0,t.up)("q-card-section"),d=(0,t.up)("q-card"),u=(0,t.up)("q-expansion-item"),i=(0,t.up)("q-btn"),c=(0,t.up)("q-date"),ee=(0,t.up)("q-popup-proxy"),ae=(0,t.up)("q-icon"),ne=(0,t.up)("q-input"),de=(0,t.up)("q-th"),ue=(0,t.up)("q-tr"),ie=(0,t.up)("q-td"),ce=(0,t.up)("q-badge"),_e=(0,t.up)("q-table"),pe=(0,t.up)("q-page"),me=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(pe,{padding:""},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{"expand-separator":"",icon:"help",label:"Описание раздела",class:"q-mb-md"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Uk)(" В отчете сотрудника представлена сводная информация по количеству, качеству усилий, операционным и финансовым результатам. Автоматически система формирует данные по состоянию на вчерашний день. Сотрудник может выбрать любой произвольный период времени начиная с момента первой авторизации в системе."),_,p,(0,t.Uk)(" Финансовые показатели сотрудника состоят из двух:"),m,w,(0,t.Uk)(" 1. Заработная плата сотрудника на руки (начисленная сумма за один день работы сотрудника)"),b,(0,t.Uk)(" 2. Расходы организации на сотрудника (начисленная сумма за один день работы сотрудника плюс налоги и страховые взносы)"),g,v,(0,t.Uk)(" Финансовые показатели возможно посмотреть в разрезе минимум 1 (одного) рабочего дня. Для этого необходимо в фильтре изменить дату начала отчета на предыдущий день. Финансовые показатели рассчитываются путем деления заработной платы (расходов организации) в месяц на 22 (двадцать два) рабочих дня. Согласно производственного календаря среднее количество рабочих дней в году составляет 22 (двадцать два) дня. ")])),_:1})])),_:1})])),_:1}),(0,t._)("div",f,[(0,t.Wm)(n.Z),(0,t._)("p",y,"Отчет пользователя "+(0,o.zw)(le.value.user),1)]),(0,t._)("div",k,[(0,t._)("div",h,[(0,t.Wm)(ne,{class:"q-mb-xs",outlined:"",dense:"",modelValue:a.value.created_at_gte,"onUpdate:modelValue":l[1]||(l[1]=e=>a.value.created_at_gte=e),label:"Отчет с"},{append:(0,t.w5)((()=>[(0,t.Wm)(ae,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(ee,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{modelValue:a.value.created_at_gte,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value.created_at_gte=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",x,[(0,t.wy)((0,t.Wm)(i,{label:"Выбрать",color:"primary",flat:""},null,512),[[me]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(ne,{outlined:"",dense:"",modelValue:a.value.created_at_lte,"onUpdate:modelValue":l[3]||(l[3]=e=>a.value.created_at_lte=e),label:"Отчет до"},{append:(0,t.w5)((()=>[(0,t.Wm)(ae,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(ee,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{modelValue:a.value.created_at_lte,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.created_at_lte=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",q,[(0,t.wy)((0,t.Wm)(i,{label:"Выбрать",color:"primary",flat:""},null,512),[[me]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,t._)("div",D,[(0,t.wy)((0,t.Wm)(i,{class:"q-mb-sm full-width",label:"Применить фильтр",color:"positive",onClick:l[4]||(l[4]=e=>re("apply")),unelevated:"","no-caps":""},null,512),[[me]]),(0,t.wy)((0,t.Wm)(i,{class:"full-width",label:"Сбросить фильтр",color:"dark",onClick:l[5]||(l[5]=e=>re("clear")),unelevated:"","no-caps":""},null,512),[[me]])])]),(0,t._)("p",z,"Количество усилий "+(0,o.zw)(le.value.login_mark),1),(0,t._)("table",W,[(0,t._)("tr",null,[Z,(0,t._)("td",j,(0,o.zw)(le.value.total_logins),1)]),(0,t._)("tr",null,[Q,(0,t._)("td",V,(0,o.zw)(2*le.value.total_logins),1)]),(0,t._)("tr",null,[Y,(0,t._)("td",C,(0,o.zw)(le.value.login_mark),1)])]),(0,t._)("p",U,[(0,t.Uk)("Качество усилий "),oe.value>0?((0,t.wg)(),(0,t.iD)("span",H,(0,o.zw)(oe.value),1)):(0,t.kq)("",!0)]),le.value.tasks?((0,t.wg)(),(0,t.j4)(_e,{key:0,flat:"",rows:le.value.tasks,columns:se,"hide-pagination":"","row-key":"id",pagination:te,"table-header-class":"table-header"},{header:(0,t.w5)((e=>[(0,t.Wm)(ue,{props:e,class:"bg-grey-2"},{default:(0,t.w5)((()=>[(0,t.Wm)(de,{"auto-width":""}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(de,{key:l.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",P,(0,o.zw)(l.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,t.w5)((e=>[(0,t.Wm)(ue,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(ie,{"auto-width":""},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{size:"sm",color:"primary",round:"",unelevated:"",dense:"",onClick:l=>e.expand=!e.expand,icon:e.expand?"visibility_off":"visibility"},null,8,["onClick","icon"])])),_:2},1024),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(ie,{key:l.name,props:e},{default:(0,t.w5)((()=>["is_done"===l.name?((0,t.wg)(),(0,t.iD)("span",T,[l.value?((0,t.wg)(),(0,t.j4)(ae,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,t.wg)(),(0,t.j4)(ae,{key:1,name:"close",size:"20px",color:"negative"}))])):"is_repeatable"===l.name?((0,t.wg)(),(0,t.iD)("span",S,[l.value?((0,t.wg)(),(0,t.j4)(ae,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,t.wg)(),(0,t.j4)(ae,{key:1,name:"close",size:"20px",color:"negative"}))])):"priority"===l.name?((0,t.wg)(),(0,t.iD)("span",$,[1===l.value?((0,t.wg)(),(0,t.j4)(ce,{key:0,color:"positive",label:"Низкий"})):2===l.value?((0,t.wg)(),(0,t.j4)(ce,{key:1,color:"warning",label:"Средний"})):3===l.value?((0,t.wg)(),(0,t.j4)(ce,{key:2,color:"negative",label:"Высокий"})):(0,t.kq)("",!0)])):((0,t.wg)(),(0,t.iD)("span",B,(0,o.zw)(l.value),1))])),_:2},1032,["props"])))),128))])),_:2},1032,["props"]),(0,t.wy)((0,t.Wm)(ue,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(ie,{colspan:"100%"},{default:(0,t.w5)((()=>[F,(0,t._)("p",null,(0,o.zw)(e.row.task),1),I,(0,t._)("p",null,(0,o.zw)(e.row.result),1)])),_:2},1024)])),_:2},1032,["props"]),[[s.F8,e.expand]])])),_:1},8,["rows"])):(0,t.kq)("",!0),le.value.form_result?((0,t.wg)(),(0,t.iD)("div",L,[(0,t._)("p",M,"Операционные показатели "+(0,o.zw)(le.value.form_rate),1),(0,t._)("table",K,[E,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(le.value.form_result,((e,l)=>((0,t.wg)(),(0,t.iD)("tr",{key:l},[(0,t._)("td",null,(0,o.zw)(l+1),1),(0,t._)("td",null,(0,o.zw)(e.label),1),(0,t._)("td",null,(0,o.zw)(e.plan_amount),1),(0,t._)("td",null,(0,o.zw)(e.fact_amount),1),(0,t._)("td",null,(0,o.zw)(e.percent_done),1)])))),128))])])):((0,t.wg)(),(0,t.iD)("p",O,"Назначеных задач не было ")),A,(0,t._)("table",G,[(0,t._)("tr",null,[J,(0,t._)("td",N,(0,o.zw)(le.value.period_income),1)]),(0,t._)("tr",null,[R,(0,t._)("td",X,(0,o.zw)(le.value.period_outcome),1)])])])),_:1})}}};var le=a(9885),ae=a(651),te=a(4458),oe=a(3190),se=a(3119),ne=a(2857),re=a(2765),de=a(2535),ue=a(8879),ie=a(1746),ce=a(1233),_e=a(1682),pe=a(7220),me=a(990),we=a(2146),be=a(9984),ge=a.n(be);const ve=ee,fe=ve;ge()(ee,"components",{QPage:le.Z,QExpansionItem:ae.Z,QCard:te.Z,QCardSection:oe.Z,QInput:se.Z,QIcon:ne.Z,QPopupProxy:re.Z,QDate:de.Z,QBtn:ue.Z,QTable:ie.Z,QTr:ce.Z,QTh:_e.Z,QTd:pe.Z,QBadge:me.Z}),ge()(ee,"directives",{ClosePopup:we.Z})}}]);