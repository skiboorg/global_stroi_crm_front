"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[2],{1002:(e,l,a)=>{a.r(l),a.d(l,{default:()=>z});var t=a(9835),o=a(6970),n=a(499),i=a(1569),u=a(8550),d=a(1862),s=a(9876),r=a(4139),m=a(2637),p=a(8227),c=(a(8203),a(1375));const v={class:"flex items-center justify-between q-mb-md"},f=(0,t._)("p",{class:"no-margin text-h6 text-bold"},"Трудовые договора",-1),w={class:"row q-col-gutter-md q-mb-md"},b={class:"col-12 col-md-10"},g={class:"col-12 col-md-2"},_={class:"text-bold"},q=["innerHTML"],k={class:"q-gutter-md"},y={key:1},h=["href"],W={__name:"employment_contracts",setup(e){(0,s.E)();const l=[{name:"inner_id",align:"left",label:"Номер",field:e=>e.inner_id,sortable:!0},{name:"date",align:"left",label:"Дата заключения",field:e=>new Date(e.date).toLocaleDateString(),sortable:!0},{name:"worker_fio",align:"left",label:"Ф.И.О сотрудника",field:e=>e.worker_fio,sortable:!0},{name:"period",align:"left",label:"Срок действия",field:e=>e.period,sortable:!0},{name:"file",align:"left",label:"Файл",field:e=>e.file?`<a href="${e.file}" target="_blank">Открыть</a>`:"Нет",sortable:!0}],a=(0,n.iH)(!1),W=((0,n.iH)(!1),(0,n.iH)({}),(0,n.iH)(null),["Бессрочный","1 мес","6 мес","1 год","Другое"]),V=(0,n.iH)({id:null,date:null,worker_fio:null,period:null,file:null}),Z={sortBy:"desc",descending:!1,page:1,rowsPerPage:15},Q=(0,n.iH)(1),H=(0,n.iH)(!1),C=(0,n.iH)([]),D=(0,n.iH)(5),x=(0,n.iH)(null),T=(0,n.iH)({q:""}),S=async()=>{console.log(Q.value),await U()};(0,t.wF)((async()=>{await U()}));const U=async()=>{H.value=!H.value;const e=await(0,i.api)(`/api/catalog/employment_contract?page=${Q.value}&q=${T.value.q}`);C.value=e.data.results,D.value=Math.ceil(e.data.count/15),H.value=!H.value},j=async e=>{await i.api.delete(`/api/catalog/employment_contract/${e}`),await U()},L=e=>{e?(V.value=e,V.value.date=V.value.date?new Date(V.value.date).toLocaleDateString():null):V.value={id:null,date:null,worker_fio:null,period:null,file:null},a.value=!0},P=async()=>{let e,l=new FormData;delete V.value.file;for(let[a,t]of Object.entries(V.value))l.append(a,JSON.stringify(t));x.value&&l.append("file",x.value),e=V.value.id?await(0,i.api)({method:"put",url:`/api/catalog/employment_contract/${V.value.id}`,data:l,headers:{"Content-Type":"multipart/form-data"}}):await(0,i.api)({method:"post",url:"/api/catalog/employment_contract",data:l,headers:{"Content-Type":"multipart/form-data"}}),(0,m.d)(e.data.success?"positive":"negative",e.data.message),await U(),a.value=!1,x.value=null},$=e=>{V.value.date=new Date(e).toLocaleDateString()};return(e,n)=>{const i=(0,t.up)("q-space"),s=(0,t.up)("q-input"),m=(0,t.up)("q-btn"),F=(0,t.up)("q-th"),M=(0,t.up)("q-tr"),Y=(0,t.up)("q-td"),B=(0,t.up)("q-table"),K=(0,t.up)("q-pagination"),O=(0,t.up)("q-page"),z=(0,t.up)("q-select"),A=(0,t.up)("q-file"),E=(0,t.up)("q-card-section"),I=(0,t.up)("q-card-actions"),J=(0,t.up)("q-form"),N=(0,t.up)("q-card"),G=(0,t.up)("q-dialog"),R=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(O,{padding:""},{default:(0,t.w5)((()=>[(0,t.Wm)(c.Z),(0,t._)("div",v,[f,(0,t.Wm)(i),(0,t.Wm)(u.Z,{icon:"add",label:"Добавить",onClick:n[0]||(n[0]=e=>L(null))})]),(0,t._)("div",w,[(0,t._)("div",b,[(0,t.Wm)(s,{dense:"",modelValue:T.value.q,"onUpdate:modelValue":n[1]||(n[1]=e=>T.value.q=e),label:"Поиск по ФИО сотрудника, сроку действия",outlined:""},null,8,["modelValue"])]),(0,t._)("div",g,[(0,t.Wm)(m,{class:"full-width",label:"Найти","no-caps":"",color:"primary",unelevated:"",onClick:U})])]),(0,t.Wm)(B,{flat:"",rows:C.value,columns:l,"row-key":"name","hide-pagination":"",pagination:Z,"onUpdate:pagination":n[2]||(n[2]=e=>Z=e),loading:H.value,"table-header-class":"table-header"},{header:(0,t.w5)((e=>[(0,t.Wm)(M,{props:e,class:"bg-grey-2"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(F,{key:l.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",_,(0,o.zw)(l.label),1)])),_:2},1032,["props"])))),128)),(0,t.Wm)(F,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,t.w5)((e=>[(0,t.Wm)(M,{props:e},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(Y,{key:l.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",{innerHTML:l.value},null,8,q)])),_:2},1032,["props"])))),128)),(0,t.Wm)(Y,{"auto-width":""},{default:(0,t.w5)((()=>[(0,t._)("div",k,[(0,t.Wm)(d.Z,{dense:"",onClick:l=>L(e.row)},null,8,["onClick"]),(0,t.Wm)(p.Z,{onConfirm:l=>j(e.row.id)},null,8,["onConfirm"])])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","loading"]),(0,t.Wm)(K,{modelValue:Q.value,"onUpdate:modelValue":[n[3]||(n[3]=e=>Q.value=e),S],max:D.value,"max-pages":6,"direction-links":"","boundary-numbers":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])),_:1}),(0,t.Wm)(G,{modelValue:a.value,"onUpdate:modelValue":n[9]||(n[9]=e=>a.value=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(N,{style:{width:"700px","max-width":"100vw"}},{default:(0,t.w5)((()=>[(0,t.Wm)(J,{onSubmit:P},{default:(0,t.w5)((()=>[(0,t.Wm)(E,{class:"q-pb-none"},{default:(0,t.w5)((()=>[V.value.inner_id?((0,t.wg)(),(0,t.j4)(s,{key:0,class:"q-mb-md",outlined:"",dense:"",label:"Внутренний номер",modelValue:V.value.inner_id,"onUpdate:modelValue":n[4]||(n[4]=e=>V.value.inner_id=e)},null,8,["modelValue"])):(0,t.kq)("",!0),(0,t.Wm)(r.Z,{dense:"",class:"q-mb-md",modelValue:V.value.date,"onUpdate:modelValue":n[5]||(n[5]=e=>V.value.date=e),label:"Дата заключения",onSelected:$},null,8,["modelValue"]),(0,t.Wm)(s,{class:"q-mb-md",outlined:"",dense:"",label:"Ф.И.О сотрудника",modelValue:V.value.worker_fio,"onUpdate:modelValue":n[6]||(n[6]=e=>V.value.worker_fio=e)},null,8,["modelValue"]),(0,t.Wm)(z,{outlined:"",dense:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:V.value.period,"onUpdate:modelValue":n[7]||(n[7]=e=>V.value.period=e),options:W,label:"Срок действия"},null,8,["modelValue"]),V.value.file?((0,t.wg)(),(0,t.iD)("p",y,[(0,t._)("a",{href:V.value.file,target:"_blank"},"Загруженный ранее файл",8,h)])):(0,t.kq)("",!0),(0,t.Wm)(A,{class:"q-mb-md",outlined:"",dense:"",label:"Файл",modelValue:x.value,"onUpdate:modelValue":n[8]||(n[8]=e=>x.value=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(I,{align:"center"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{label:"Сохранить",type:"submit","no-caps":"",color:"positive"}),(0,t.wy)((0,t.Wm)(m,{label:"Отмена","no-caps":"",color:"dark"},null,512),[[R]])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var V=a(9885),Z=a(136),Q=a(3119),H=a(8879),C=a(1746),D=a(1233),x=a(1682),T=a(7220),S=a(996),U=a(2074),j=a(4458),L=a(8326),P=a(3190),$=a(6384),F=a(3837),M=a(1821),Y=a(2146),B=a(9984),K=a.n(B);const O=W,z=O;K()(W,"components",{QPage:V.Z,QSpace:Z.Z,QInput:Q.Z,QBtn:H.Z,QTable:C.Z,QTr:D.Z,QTh:x.Z,QTd:T.Z,QPagination:S.Z,QDialog:U.Z,QCard:j.Z,QForm:L.Z,QCardSection:P.Z,QSelect:$.Z,QFile:F.Z,QCardActions:M.Z}),K()(W,"directives",{ClosePopup:Y.Z})}}]);