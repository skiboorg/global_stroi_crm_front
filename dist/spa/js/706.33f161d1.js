"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[706],{706:(e,a,l)=>{l.r(a),l.d(a,{default:()=>P});var t=l(9835),o=l(6970),i=l(499),s=l(1569),n=l(8339),u=(l(8550),l(8203)),r=l(2637);const d={class:"flex items-center q-mb-lg"},p={class:"no-margin text-h6 text-bold"},m={class:"row q-col-gutter-md"},c={class:"col-6"},v={class:"col-6"},g={key:0,class:""},b=(0,t._)("p",{class:"text-h6"},"История",-1),_={class:"text-bold"},w=["href"],f={key:1},h={__name:"tool",setup(e){const a=(0,n.yj)(),l=(0,i.iH)({}),h=(0,i.iH)(!1),y=(0,i.iH)(!1),q=(0,i.iH)(null),W=(0,i.iH)(null),Z=["Новый","Б/У"],k=[{name:"id",align:"left",label:"#",field:e=>e.id,sortable:!0},{name:"created_at",align:"left",label:"Дата",field:e=>new Date(e.created_at).toLocaleString(),sortable:!0},{name:"who_give",align:"left",label:"Передал",field:e=>e.who_give.fio,sortable:!0},{name:"who_get",align:"left",label:"Принял",field:e=>e.who_get.fio,sortable:!0},{name:"image",align:"left",label:"Фото",field:e=>e.image,sortable:!0},{name:"give_serial_number",align:"left",label:"Серийный номер",field:e=>e.give_serial_number,sortable:!0}];(0,t.wF)((async()=>{await Q()}));const Q=async()=>{const e=await(0,s.api)(`/api/material_store/store_tool/${a.params.id}?full=true`);l.value=e.data},x=(0,t.Fl)((()=>{if(l.value?.history)return l.value?.history.find((e=>!e.is_returned))})),C=async()=>{y.value=!0;let e=new FormData;e.append("history_id",x.value.id),e.append("image",q.value),e.append("condition",W.value);try{await(0,s.api)({method:"post",url:"/api/material_store/create_return_act",data:e,headers:{"Content-Type":"multipart/form-data"}});(0,r.d)("positive","Возврат завершен"),await Q(),y.value=!1,h.value=!1}catch(a){(0,r.d)("negative","Проверьте входные данные"),y.value=!1}y.value=!1};return(e,a)=>{const i=(0,t.up)("q-img"),s=(0,t.up)("q-btn"),n=(0,t.up)("q-th"),r=(0,t.up)("q-tr"),Q=(0,t.up)("q-td"),V=(0,t.up)("q-table"),D=(0,t.up)("q-select"),H=(0,t.up)("q-file"),T=(0,t.up)("q-card-section"),F=(0,t.up)("q-card-actions"),j=(0,t.up)("q-form"),z=(0,t.up)("q-card"),S=(0,t.up)("q-dialog"),U=(0,t.up)("q-page"),K=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(U,{padding:""},{default:(0,t.w5)((()=>[(0,t._)("div",d,[(0,t.Wm)(u.Z),(0,t._)("p",p,(0,o.zw)(l.value.name),1)]),(0,t._)("div",m,[(0,t._)("div",c,[(0,t.Wm)(i,{fit:"contain",ratio:16/9,src:l.value.image},null,8,["src"])]),(0,t._)("div",v,[(0,t._)("p",null,[(0,t.Uk)("Состояние: "),(0,t._)("span",{class:(0,o.C_)(l.value.is_avaiable?"text-bold text-positive":"text-bold text-negative")},(0,o.zw)(l.value.is_avaiable?"На складе":`Выдан ${x.value?.who_get.fio}`),3)]),l.value.is_avaiable?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("div",g,[(0,t.Wm)(s,{label:"Оформить возврат",onClick:a[0]||(a[0]=e=>h.value=!0),"no-caps":"",unelevated:"",color:"primary"})]))])]),b,(0,t.Wm)(V,{flat:"",rows:l.value?.history,columns:k,"hide-pagination":"","table-header-class":"table-header","row-key":"id",selection:"multiple",class:"q-mb-lg"},{header:(0,t.w5)((e=>[(0,t.Wm)(r,{props:e,class:"bg-grey-2"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(a=>((0,t.wg)(),(0,t.j4)(n,{key:a.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",_,(0,o.zw)(a.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,t.w5)((e=>[(0,t.Wm)(r,{props:e},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(a=>((0,t.wg)(),(0,t.j4)(Q,{key:a.name,props:e},{default:(0,t.w5)((()=>["image"===a.name?((0,t.wg)(),(0,t.iD)("a",{key:0,href:a.value,target:"_blank"},[(0,t.Wm)(i,{ratio:16/9,fit:"contain",src:a.value},null,8,["src"])],8,w)):((0,t.wg)(),(0,t.iD)("pre",f,(0,o.zw)(a.value),1))])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),_:1},8,["rows"]),(0,t.Wm)(S,{modelValue:h.value,"onUpdate:modelValue":a[3]||(a[3]=e=>h.value=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(z,{style:{width:"700px","max-width":"100vw"}},{default:(0,t.w5)((()=>[(0,t.Wm)(j,{onSubmit:C},{default:(0,t.w5)((()=>[(0,t.Wm)(T,{class:"q-pb-none"},{default:(0,t.w5)((()=>[(0,t.Wm)(D,{outlined:"",dense:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:W.value,"onUpdate:modelValue":a[1]||(a[1]=e=>W.value=e),options:Z,label:"Состояние"},null,8,["modelValue"]),(0,t.Wm)(H,{class:"q-mb-md",outlined:"",dense:"",label:"Фото",modelValue:q.value,"onUpdate:modelValue":a[2]||(a[2]=e=>q.value=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(F,{align:"center"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{label:"Сохранить",disable:!W.value||!q.value,loading:y.value,"no-caps":"",color:"positive",type:"submit"},null,8,["disable","loading"]),(0,t.wy)((0,t.Wm)(s,{label:"Отмена",loading:y.value,"no-caps":"",color:"dark"},null,8,["loading"]),[[K]])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}}};var y=l(9885),q=l(335),W=l(8879),Z=l(1746),k=l(1233),Q=l(1682),x=l(7220),C=l(2074),V=l(4458),D=l(8326),H=l(3190),T=l(6384),F=l(9420),j=l(1821),z=l(2146),S=l(9984),U=l.n(S);const K=h,P=K;U()(h,"components",{QPage:y.Z,QImg:q.Z,QBtn:W.Z,QTable:Z.Z,QTr:k.Z,QTh:Q.Z,QTd:x.Z,QDialog:C.Z,QCard:V.Z,QForm:D.Z,QCardSection:H.Z,QSelect:T.Z,QFile:F.Z,QCardActions:j.Z}),U()(h,"directives",{ClosePopup:z.Z})}}]);