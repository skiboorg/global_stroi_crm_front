"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[35],{3035:(l,e,a)=>{a.r(e),a.d(e,{default:()=>pl});var u=a(9835),o=a(6970),n=a(499),d=a(1569),t=a(8550),m=a(1862),s=a(9876),i=a(4139),r=a(2637),v=a(8227),p=a(1375);const c={class:"flex items-center justify-between q-mb-md"},_=(0,u._)("p",{class:"no-margin text-h6 text-bold"},"Подрядчики ",-1),w={class:"row q-col-gutter-md q-mb-md"},f={class:"col-12 col-md-10"},g={class:"col-12 col-md-2"},W={class:"text-bold"},b={class:"q-gutter-md"},k={key:1,class:"row q-col-gutter-md"},V={class:"col-12 col-md-4"},U={class:"col-12 col-md-4"},h={class:"col-12 col-md-4"},q={class:"row q-col-gutter-md"},y={class:"col-12 col-md-4"},Z={class:"col-12 col-md-4"},D={class:"col-12 col-md-4"},Q={class:"row q-col-gutter-md q-mb-md"},z={class:"col-12 col-md-4"},C={class:"col-12 col-md-4"},x={class:"col-12 col-md-4"},H={class:"row q-col-gutter-md q-mb-md"},S={class:"col-12 col-md-3"},T={class:"col-12 col-md-3"},L={class:"col-12 col-md-3"},j={class:"col-12 col-md-3"},O={key:2},P=["href"],F=["href"],$=["href"],B={__name:"subworkers",setup(l){(0,s.E)();const e=[{name:"name",align:"left",label:"ФИО",field:l=>l.fio,sortable:!0},{name:"inn",align:"left",label:"ИНН",field:l=>l.inn,sortable:!0},{name:"phone",align:"left",label:"Телефон",field:l=>l.phone,sortable:!0},{name:"email",align:"left",label:"E-Mail",field:l=>l.email?l.email:l.user?.email,sortable:!0},{name:"login",align:"left",label:"Логин",field:l=>l.user?l.user.username:"Нет пользователя",sortable:!0}],a=(0,n.iH)(!1),B=(0,n.iH)(!1),I=(0,n.iH)({}),Y=(0,n.iH)(!1),E=["Договор подряда","Нет"],K=["Самозанятый","ИП","OOO"],M=(0,n.iH)({login:null,password:null,telega_username:null}),A=(0,n.iH)({id:null,fio:null,user:null,org_type:null,inn:null,phone:null,email:null,place:null,people_num:null,ud_h:null,ud_e:null,dogovor_date:null,dogovor_type:null,dogovor_summ:null,dogovor_done:null,comment:null,link:null}),J={sortBy:"desc",descending:!1,page:1,rowsPerPage:15},N=(0,n.iH)(1),G=(0,n.iH)(!1),R=(0,n.iH)([]),X=(0,n.iH)(5),ll=(0,n.iH)(null),el=(0,n.iH)({q:""}),al=async()=>{console.log(N.value),await ul()};(0,u.wF)((async()=>{await ul()}));const ul=async()=>{G.value=!G.value;const l=await(0,d.api)(`/api/catalog/subworker?page=${N.value}&q=${el.value.q}`);R.value=l.data.results,X.value=Math.ceil(l.data.count/15),G.value=!G.value},ol=async l=>{await d.api.delete(`/api/catalog/subworker/${l}`),await ul()},nl=async()=>{await ul()},dl=l=>{l?(A.value=l,A.value.dogovor_date=A.value.dogovor_date?new Date(A.value.dogovor_date).toLocaleDateString():null,A.value.dogovor_done=A.value.dogovor_done?new Date(A.value.dogovor_done).toLocaleDateString():null):A.value={id:null,fio:null,user:null,org_type:null,inn:null,phone:null,email:null,place:null,people_num:null,ud_h:null,ud_e:null,dogovor_date:null,dogovor_type:null,dogovor_summ:null,dogovor_done:null,comment:null,link:null},a.value=!0},tl=async()=>{let l,e=new FormData;for(let[a,u]of Object.entries(A.value))e.append(a,JSON.stringify(u));Y.value&&(e.append("login",M.value.login),e.append("password",M.value.password),e.append("telega_username",M.value.telega_username?M.value.telega_username.replace("@",""):null)),ll.value&&e.append("file",ll.value),l=A.value.id?await(0,d.api)({method:"put",url:`/api/catalog/subworker/${A.value.id}`,data:e,headers:{"Content-Type":"multipart/form-data"}}):await(0,d.api)({method:"post",url:"/api/catalog/subworker",data:e,headers:{"Content-Type":"multipart/form-data"}}),(0,r.d)(l.data.success?"positive":"negative",l.data.message),await ul(),M.value={login:null,password:null},Y.value=!1,a.value=!1},ml=l=>{A.value.dogovor_date=new Date(l).toLocaleDateString()},sl=l=>{A.value.dogovor_done=new Date(l).toLocaleDateString()};return(l,n)=>{const d=(0,u.up)("q-space"),s=(0,u.up)("q-input"),r=(0,u.up)("q-btn"),il=(0,u.up)("q-th"),rl=(0,u.up)("q-tr"),vl=(0,u.up)("q-td"),pl=(0,u.up)("q-table"),cl=(0,u.up)("q-pagination"),_l=(0,u.up)("q-page"),wl=(0,u.up)("q-checkbox"),fl=(0,u.up)("q-select"),gl=(0,u.up)("q-file"),Wl=(0,u.up)("q-card-section"),bl=(0,u.up)("q-card-actions"),kl=(0,u.up)("q-form"),Vl=(0,u.up)("q-card"),Ul=(0,u.up)("q-dialog"),hl=(0,u.up)("q-item-section"),ql=(0,u.up)("q-item"),yl=(0,u.up)("q-list"),Zl=(0,u.Q2)("close-popup");return(0,u.wg)(),(0,u.iD)(u.HY,null,[(0,u.Wm)(_l,{padding:""},{default:(0,u.w5)((()=>[(0,u.Wm)(p.Z),(0,u._)("div",c,[_,(0,u.Wm)(d),(0,u.Wm)(t.Z,{icon:"add",label:"Добавить",onClick:n[0]||(n[0]=l=>dl(null))})]),(0,u._)("div",w,[(0,u._)("div",f,[(0,u.Wm)(s,{dense:"",modelValue:el.value.q,"onUpdate:modelValue":n[1]||(n[1]=l=>el.value.q=l),label:"Поиск по инн, фио, телефону",outlined:""},null,8,["modelValue"])]),(0,u._)("div",g,[(0,u.Wm)(r,{class:"full-width",label:"Найти","no-caps":"",color:"primary",unelevated:"",onClick:ul})])]),(0,u.Wm)(pl,{flat:"",rows:R.value,columns:e,"row-key":"name","hide-pagination":"",pagination:J,"onUpdate:pagination":n[2]||(n[2]=l=>J=l),loading:G.value,"table-header-class":"table-header"},{header:(0,u.w5)((l=>[(0,u.Wm)(rl,{props:l,class:"bg-grey-2"},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(l.cols,(e=>((0,u.wg)(),(0,u.j4)(il,{key:e.name,props:l},{default:(0,u.w5)((()=>[(0,u._)("span",W,(0,o.zw)(e.label),1)])),_:2},1032,["props"])))),128)),(0,u.Wm)(il,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,u.w5)((l=>[(0,u.Wm)(rl,{props:l},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(l.cols,(e=>((0,u.wg)(),(0,u.j4)(vl,{key:e.name,onClick:e=>(I.value=l.row,B.value=!0),props:l},{default:(0,u.w5)((()=>[(0,u._)("span",null,(0,o.zw)(e.value),1)])),_:2},1032,["onClick","props"])))),128)),(0,u.Wm)(vl,{"auto-width":""},{default:(0,u.w5)((()=>[(0,u._)("div",b,[(0,u.Wm)(m.Z,{dense:"",onClick:e=>dl(l.row)},null,8,["onClick"]),(0,u.Wm)(v.Z,{onConfirm:e=>ol(l.row.id)},null,8,["onConfirm"])])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","loading"]),(0,u.Wm)(cl,{modelValue:N.value,"onUpdate:modelValue":[n[3]||(n[3]=l=>N.value=l),al],max:X.value,"max-pages":6,"direction-links":"","boundary-numbers":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])),_:1}),(0,u.Wm)(Ul,{modelValue:a.value,"onUpdate:modelValue":n[24]||(n[24]=l=>a.value=l),onBeforeHide:nl},{default:(0,u.w5)((()=>[(0,u.Wm)(Vl,{style:{width:"700px","max-width":"100vw"}},{default:(0,u.w5)((()=>[(0,u.Wm)(kl,{onSubmit:tl},{default:(0,u.w5)((()=>[(0,u.Wm)(Wl,{class:"q-pb-none"},{default:(0,u.w5)((()=>[A.value.user?(0,u.kq)("",!0):((0,u.wg)(),(0,u.j4)(wl,{key:0,modelValue:Y.value,"onUpdate:modelValue":n[4]||(n[4]=l=>Y.value=l),label:"Создать пользователя?"},null,8,["modelValue"])),Y.value?((0,u.wg)(),(0,u.iD)("div",k,[(0,u._)("div",V,[(0,u.Wm)(s,{outlined:"",dense:"",label:"Логин",modelValue:M.value.login,"onUpdate:modelValue":n[5]||(n[5]=l=>M.value.login=l),"lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"])]),(0,u._)("div",U,[(0,u.Wm)(s,{outlined:"",dense:"",label:"Пароль",modelValue:M.value.password,"onUpdate:modelValue":n[6]||(n[6]=l=>M.value.password=l),"lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"])]),(0,u._)("div",h,[(0,u.Wm)(s,{outlined:"",dense:"",label:"Telegram username",modelValue:M.value.telega_username,"onUpdate:modelValue":n[7]||(n[7]=l=>M.value.telega_username=l)},null,8,["modelValue"])])])):(0,u.kq)("",!0),(0,u.Wm)(fl,{outlined:"",dense:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:A.value.org_type,"onUpdate:modelValue":n[8]||(n[8]=l=>A.value.org_type=l),options:K,label:"Орг. форма"},null,8,["modelValue"]),(0,u.Wm)(s,{outlined:"",dense:"",label:"ФИО",modelValue:A.value.fio,"onUpdate:modelValue":n[9]||(n[9]=l=>A.value.fio=l),"lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,u._)("div",q,[(0,u._)("div",y,[(0,u.Wm)(s,{outlined:"",dense:"",label:"ИНН",modelValue:A.value.inn,"onUpdate:modelValue":n[10]||(n[10]=l=>A.value.inn=l),"lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"])]),(0,u._)("div",Z,[(0,u.Wm)(s,{outlined:"",dense:"",label:"Телефон",mask:"+7 (###) ###-##-##","fill-mask":"",modelValue:A.value.phone,"onUpdate:modelValue":n[11]||(n[11]=l=>A.value.phone=l)},null,8,["modelValue"])]),(0,u._)("div",D,[(0,u.Wm)(s,{outlined:"",dense:"",label:"Почта",modelValue:A.value.email,"onUpdate:modelValue":n[12]||(n[12]=l=>A.value.email=l)},null,8,["modelValue"])])]),(0,u.Wm)(s,{class:"q-mb-md",outlined:"",dense:"",label:"Место нахождения",modelValue:A.value.place,"onUpdate:modelValue":n[13]||(n[13]=l=>A.value.place=l)},null,8,["modelValue"]),(0,u._)("div",Q,[(0,u._)("div",z,[(0,u.Wm)(s,{outlined:"",dense:"",label:"Количество человек",modelValue:A.value.people_num,"onUpdate:modelValue":n[14]||(n[14]=l=>A.value.people_num=l)},null,8,["modelValue"])]),(0,u._)("div",C,[(0,u.Wm)(s,{outlined:"",dense:"",label:"УД Высота",modelValue:A.value.ud_h,"onUpdate:modelValue":n[15]||(n[15]=l=>A.value.ud_h=l)},null,8,["modelValue"])]),(0,u._)("div",x,[(0,u.Wm)(s,{outlined:"",dense:"",label:"УД Электрика",modelValue:A.value.ud_e,"onUpdate:modelValue":n[16]||(n[16]=l=>A.value.ud_e=l)},null,8,["modelValue"])])]),(0,u._)("div",H,[(0,u._)("div",S,[(0,u.Wm)(fl,{outlined:"",dense:"","map-options":"","emit-value":"",behavior:"menu",modelValue:A.value.dogovor_type,"onUpdate:modelValue":n[17]||(n[17]=l=>A.value.dogovor_type=l),options:E,label:"Тип договора"},null,8,["modelValue"])]),(0,u._)("div",T,[(0,u.Wm)(s,{outlined:"",dense:"",label:"Сумма договора",modelValue:A.value.dogovor_summ,"onUpdate:modelValue":n[18]||(n[18]=l=>A.value.dogovor_summ=l)},null,8,["modelValue"])]),(0,u._)("div",L,[(0,u.Wm)(i.Z,{dense:"",modelValue:A.value.dogovor_date,"onUpdate:modelValue":n[19]||(n[19]=l=>A.value.dogovor_date=l),label:"Дата заключения договора",onSelected:ml},null,8,["modelValue"])]),(0,u._)("div",j,[(0,u.Wm)(i.Z,{dense:"",modelValue:A.value.dogovor_done,"onUpdate:modelValue":n[20]||(n[20]=l=>A.value.dogovor_done=l),label:"Дата выполнения работ",onSelected:sl},null,8,["modelValue"])])]),(0,u.Wm)(s,{class:"q-mb-md",type:"textarea",outlined:"",dense:"",label:"Примечание",modelValue:A.value.comment,"onUpdate:modelValue":n[21]||(n[21]=l=>A.value.comment=l)},null,8,["modelValue"]),(0,u.Wm)(s,{class:"q-mb-md",outlined:"",dense:"",label:"Ссылка",modelValue:A.value.link,"onUpdate:modelValue":n[22]||(n[22]=l=>A.value.link=l)},null,8,["modelValue"]),A.value.file?((0,u.wg)(),(0,u.iD)("p",O,[(0,u._)("a",{href:A.value.file,target:"_blank"},"Загруженный ранее файл",8,P)])):(0,u.kq)("",!0),(0,u.Wm)(gl,{class:"q-mb-md",outlined:"",dense:"",label:"Файл",modelValue:ll.value,"onUpdate:modelValue":n[23]||(n[23]=l=>ll.value=l)},null,8,["modelValue"])])),_:1}),(0,u.Wm)(bl,{align:"center"},{default:(0,u.w5)((()=>[(0,u.Wm)(r,{label:"Сохранить",type:"submit","no-caps":"",color:"positive"}),(0,u.wy)((0,u.Wm)(r,{label:"Отмена","no-caps":"",color:"dark"},null,512),[[Zl]])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,u.Wm)(Ul,{modelValue:B.value,"onUpdate:modelValue":n[25]||(n[25]=l=>B.value=l)},{default:(0,u.w5)((()=>[(0,u.Wm)(Vl,{style:{width:"700px","max-width":"100vw"}},{default:(0,u.w5)((()=>[(0,u.Wm)(Wl,null,{default:(0,u.w5)((()=>[(0,u.Wm)(yl,{separator:""},{default:(0,u.w5)((()=>[(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("ФИО")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(I.value.fio),1)])),_:1})])),_:1}),(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Организационная форма")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(I.value.org_type),1)])),_:1})])),_:1}),(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("ИНН")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(I.value.inn),1)])),_:1})])),_:1}),(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Телефон")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(I.value.phone),1)])),_:1})])),_:1}),(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Почта")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(I.value.email),1)])),_:1})])),_:1}),(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Место нахождения")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(I.value.place),1)])),_:1})])),_:1}),(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Количество человек")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(I.value.people_num),1)])),_:1})])),_:1}),(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("УД Высота")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(I.value.ud_h),1)])),_:1})])),_:1}),(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("УД Электрика")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(I.value.ud_e),1)])),_:1})])),_:1}),(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Тип договора")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(I.value.dogovor_type),1)])),_:1})])),_:1}),(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Сумма договора")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(I.value.dogovor_summ),1)])),_:1})])),_:1}),(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Дата заключения")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(new Date(I.value.dogovor_date).toLocaleDateString()),1)])),_:1})])),_:1}),(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Дата выполнения работ")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(new Date(I.value.dogovor_done).toLocaleDateString()),1)])),_:1})])),_:1}),(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Примечание ")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(I.value.comment),1)])),_:1})])),_:1}),(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Ссылка")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[I.value.link?((0,u.wg)(),(0,u.iD)("a",{key:0,href:I.value.link,target:"_blank"},"Открыть",8,F)):(0,u.kq)("",!0)])),_:1})])),_:1}),(0,u.Wm)(ql,null,{default:(0,u.w5)((()=>[(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Файл")])),_:1}),(0,u.Wm)(hl,null,{default:(0,u.w5)((()=>[I.value.file?((0,u.wg)(),(0,u.iD)("a",{key:0,href:I.value.file,target:"_blank"},"Открыть",8,$)):(0,u.kq)("",!0)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var I=a(9885),Y=a(136),E=a(3119),K=a(8879),M=a(1746),A=a(1233),J=a(1682),N=a(7220),G=a(996),R=a(2074),X=a(4458),ll=a(8326),el=a(3190),al=a(1006),ul=a(6384),ol=a(3837),nl=a(1821),dl=a(3246),tl=a(490),ml=a(6749),sl=a(2146),il=a(9984),rl=a.n(il);const vl=B,pl=vl;rl()(B,"components",{QPage:I.Z,QSpace:Y.Z,QInput:E.Z,QBtn:K.Z,QTable:M.Z,QTr:A.Z,QTh:J.Z,QTd:N.Z,QPagination:G.Z,QDialog:R.Z,QCard:X.Z,QForm:ll.Z,QCardSection:el.Z,QCheckbox:al.Z,QSelect:ul.Z,QFile:ol.Z,QCardActions:nl.Z,QList:dl.Z,QItem:tl.Z,QItemSection:ml.Z}),rl()(B,"directives",{ClosePopup:sl.Z})}}]);