"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[958],{8550:(e,l,a)=>{a.d(l,{Z:()=>r});var o=a(9835);const t={__name:"AddButton",props:["label","icon","loading","color"],setup(e){return(l,a)=>{const t=(0,o.up)("q-btn");return l.auth.user.role?.permission?.can_add?((0,o.wg)(),(0,o.j4)(t,{key:0,"no-caps":"",unelevated:"",loading:e.loading,color:e.color?e.color:"primary",label:e.label,icon:e.icon?e.icon:"add"},null,8,["loading","color","label","icon"])):(0,o.kq)("",!0)}}};var n=a(8879),u=a(9984),i=a.n(u);const s=t,r=s;i()(t,"components",{QBtn:n.Z})},8203:(e,l,a)=>{a.d(l,{Z:()=>c});var o=a(9835);function t(e,l){const a=(0,o.up)("q-btn");return(0,o.wg)(),(0,o.j4)(a,{"no-caps":"",outline:"",color:"primary",label:"Назад",icon:"arrow_back",class:"q-mr-md",onClick:l[0]||(l[0]=l=>e.$router.back())})}var n=a(1639),u=a(8879),i=a(9984),s=a.n(i);const r={},d=(0,n.Z)(r,[["render",t]]),c=d;s()(r,"components",{QBtn:u.Z})},8227:(e,l,a)=>{a.d(l,{Z:()=>w});var o=a(9835),t=a(499);const n={__name:"DeleteButton",props:["label","icon","loading","color"],emits:["confirm"],setup(e,{emit:l}){const a=(0,t.iH)(!1);return(l,t)=>{const n=(0,o.up)("q-btn"),u=(0,o.up)("q-card-section"),i=(0,o.up)("q-card-actions"),s=(0,o.up)("q-card"),r=(0,o.up)("q-dialog"),d=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)(o.HY,null,[l.auth.user.role?.permission?.can_add?((0,o.wg)(),(0,o.j4)(n,{key:0,"no-caps":"",unelevated:"",dense:"",loading:e.loading,color:e.color?e.color:"negative",label:e.label,onClick:t[0]||(t[0]=e=>a.value=!0),icon:e.icon?e.icon:"delete"},null,8,["loading","color","label","icon"])):(0,o.kq)("",!0),(0,o.Wm)(r,{modelValue:a.value,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(s,{style:{width:"300px","max-width":"100vw"}},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"text-center text-bold"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Вы уверены? ")])),_:1}),(0,o.Wm)(i,{align:"center"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(n,{color:"negative",unelevated:"","no-caps":"",label:"Да",onClick:t[1]||(t[1]=e=>l.$emit("confirm"))},null,512),[[d]]),(0,o.wy)((0,o.Wm)(n,{color:"positive",unelevated:"","no-caps":"",label:"Нет"},null,512),[[d]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var u=a(8879),i=a(2074),s=a(4458),r=a(3190),d=a(1821),c=a(2146),p=a(9984),m=a.n(p);const b=n,w=b;m()(n,"components",{QBtn:u.Z,QDialog:i.Z,QCard:s.Z,QCardSection:r.Z,QCardActions:d.Z}),m()(n,"directives",{ClosePopup:c.Z})},1862:(e,l,a)=>{a.d(l,{Z:()=>r});var o=a(9835);const t={__name:"EditButton",props:["label","icon","color"],setup(e){return(l,a)=>{const t=(0,o.up)("q-btn");return l.auth.user.role?.permission?.can_edit?((0,o.wg)(),(0,o.j4)(t,{key:0,"no-caps":"",unelevated:"",color:e.color,label:e.label,icon:e.icon?e.icon:"edit"},null,8,["color","label","icon"])):(0,o.kq)("",!0)}}};var n=a(8879),u=a(9984),i=a.n(u);const s=t,r=s;i()(t,"components",{QBtn:n.Z})},4958:(e,l,a)=>{a.r(l),a.d(l,{default:()=>I});a(2879);var o=a(9835),t=a(6970),n=a(1957),u=a(499),i=a(1569),s=a(8550),r=a(1862),d=a(9876),c=a(6928),p=a(8227);a(8203);const m={class:"flex items-center justify-between q-mb-md"},b=(0,o._)("p",{class:"no-margin text-h6 text-bold"},"Объекты ",-1),w={class:"text-bold"},_={class:"q-gutter-md"},v={class:"row q-col-gutter-md"},g={class:"col-12 col-md-6"},f={class:"col-12 col-md-6"},k={__name:"objects",setup(e){(0,d.E)();const l=(0,c.t)(),a=[{name:"name",align:"left",label:"Название",field:e=>e.name,sortable:!0},{name:"address",align:"left",label:"Адрес",field:e=>e.address,sortable:!0},{name:"subworker_name",align:"left",label:"Субподрядчик",field:e=>e.subworker_name,sortable:!0},{name:"total",align:"left",label:"Сумма договора",field:e=>y(e.total),sortable:!0},{name:"avans",align:"left",label:"Сумма аванса",field:e=>y(e.avans),sortable:!0},{name:"procent_done",align:"left",label:"Выполнено работ в %",field:e=>e.procent_done,sortable:!0},{name:"to_pay",align:"left",label:"Сумма к оплате",field:e=>y(e.to_pay),sortable:!0},{name:"pay_ostatok",align:"left",label:"Остаток оплаты",field:e=>y(e.pay_ostatok),sortable:!0},{name:"created_at",align:"left",label:"Создан",field:e=>new Date(e.created_at).toLocaleDateString(),sortable:!0}],k=(0,u.iH)(!1),W=(0,u.iH)(!1),q=(0,u.iH)([]),y=((0,u.iH)(null),e=>e.toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2})),Z=(0,u.iH)({id:null,name:null,address:null,subworker:null,total:null,avans:0,procent_done:0,to_pay:0,pay_ostatok:0}),Q={sortBy:"desc",descending:!1,page:1,rowsPerPage:25},h=(0,u.iH)([]);(0,u.iH)({q:"",role__id:""});(0,o.wF)((async()=>{await C()}));const C=async()=>{let e;e=l.user.role.is_subworker?await(0,i.api)(`/api/catalog/object?subworker_id=${l.user.sub_worker_id}`):await(0,i.api)("/api/catalog/object"),h.value=e.data.results},V=async e=>{await i.api.delete(`/api/catalog/object/${e}`),await C()},U=e=>{e?(q.value=[],Z.value=e):Z.value={id:null,name:null,address:null,subworker:null,total:null,avans:0,procent_done:0,to_pay:0,pay_ostatok:0},k.value=!0},j=async()=>{Z.value.id?await i.api.put(`/api/catalog/object/${Z.value.id}`,Z.value):await i.api.post("/api/catalog/object",Z.value),k.value=!1,await C()},x=(e,l)=>{l((async()=>{if(e){W.value=!W.value;e.toLowerCase();const l=await(0,i.api)(`/api/catalog/subworker?q=${e}&page_size=10000`);q.value=l.data.results,W.value=!W.value}}))};return(e,l)=>{const u=(0,o.up)("q-space"),i=(0,o.up)("q-th"),d=(0,o.up)("q-tr"),c=(0,o.up)("q-td"),y=(0,o.up)("q-table"),C=(0,o.up)("q-page"),H=(0,o.up)("q-input"),D=(0,o.up)("q-item-label"),z=(0,o.up)("q-item-section"),B=(0,o.up)("q-item"),S=(0,o.up)("q-select"),$=(0,o.up)("q-card-section"),F=(0,o.up)("q-btn"),P=(0,o.up)("q-card-actions"),T=(0,o.up)("q-form"),A=(0,o.up)("q-card"),I=(0,o.up)("q-dialog"),L=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(C,{padding:""},{default:(0,o.w5)((()=>[(0,o._)("div",m,[b,(0,o.Wm)(u),(0,o.Wm)(s.Z,{icon:"add",label:"Добавить",onClick:l[0]||(l[0]=e=>U(null))})]),(0,o.Wm)(y,{flat:"",rows:h.value,columns:a,loading:W.value,"row-key":"name","hide-pagination":"","table-header-class":"table-header",pagination:Q},{header:(0,o.w5)((e=>[(0,o.Wm)(d,{props:e,class:"bg-grey-2"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.cols,(l=>((0,o.wg)(),(0,o.j4)(i,{key:l.name,props:e},{default:(0,o.w5)((()=>[(0,o._)("span",w,(0,t.zw)(l.label),1)])),_:2},1032,["props"])))),128)),(0,o.Wm)(i,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,o.w5)((l=>[(0,o.Wm)(d,{props:l},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.cols,(a=>((0,o.wg)(),(0,o.j4)(c,{key:a.name,class:"cursor-pointer",onClick:a=>e.$router.push(`/catalog/objects/${l.row.id}`),props:l},{default:(0,o.w5)((()=>[(0,o._)("span",null,(0,t.zw)(a.value),1)])),_:2},1032,["onClick","props"])))),128)),(0,o.Wm)(c,{"auto-width":""},{default:(0,o.w5)((()=>[(0,o._)("div",_,[(0,o.Wm)(r.Z,{dense:"",onClick:e=>U(l.row)},null,8,["onClick"]),(0,o.Wm)(p.Z,{onConfirm:e=>V(l.row.id)},null,8,["onConfirm"])])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","loading"])])),_:1}),(0,o.Wm)(I,{modelValue:k.value,"onUpdate:modelValue":l[6]||(l[6]=e=>k.value=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(A,{style:{width:"700px","max-width":"100vw"}},{default:(0,o.w5)((()=>[(0,o.Wm)(T,{onSubmit:(0,n.iM)(j,["prevent"])},{default:(0,o.w5)((()=>[(0,o.Wm)($,{class:"q-pb-none"},{default:(0,o.w5)((()=>[(0,o.Wm)(H,{outlined:"",label:"Название",modelValue:Z.value.name,"onUpdate:modelValue":l[1]||(l[1]=e=>Z.value.name=e),"lazy-rules":"",rules:[e=>null!==e&&""!==e||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,o.Wm)(H,{outlined:"",type:"textarea",label:"Адрес",modelValue:Z.value.address,"onUpdate:modelValue":l[2]||(l[2]=e=>Z.value.address=e),"lazy-rules":"",rules:[e=>null!==e&&""!==e||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,o.Wm)(S,{outlined:"",modelValue:Z.value.subworker,"onUpdate:modelValue":l[3]||(l[3]=e=>Z.value.subworker=e),loading:W.value,options:q.value,"option-label":"fio",label:"Выберите субподрядчика (поиск по фио, инн, телефону)","map-options":"","option-value":"id","emit-value":"",class:"q-mb-md","use-input":"",onFilter:x,clearable:""},{"selected-item":(0,o.w5)((e=>[(0,o.Uk)((0,t.zw)(e.opt.fio?e.opt.fio:Z.value.subworker_name),1)])),option:(0,o.w5)((e=>[(0,o.Wm)(B,(0,t.vs)((0,o.F4)(e.itemProps)),{default:(0,o.w5)((()=>[(0,o.Wm)(z,null,{default:(0,o.w5)((()=>[(0,o.Wm)(D,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(e.opt.fio),1)])),_:2},1024),(0,o.Wm)(D,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)("ФИО")])),_:1})])),_:2},1024),(0,o.Wm)(z,null,{default:(0,o.w5)((()=>[(0,o.Wm)(D,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(e.opt.inn),1)])),_:2},1024),(0,o.Wm)(D,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)("ИНН")])),_:1})])),_:2},1024),(0,o.Uk)(),(0,o.Wm)(z,null,{default:(0,o.w5)((()=>[(0,o.Wm)(D,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(e.opt.phone),1)])),_:2},1024),(0,o.Wm)(D,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)("Телефон")])),_:1})])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","loading","options"]),(0,o._)("div",v,[(0,o._)("div",g,[(0,o.Wm)(H,{outlined:"",label:"Сумма договора",modelValue:Z.value.total,"onUpdate:modelValue":l[4]||(l[4]=e=>Z.value.total=e),"lazy-rules":"",rules:[e=>null!==e&&""!==e||"Это обязательное поле"]},null,8,["modelValue","rules"])]),(0,o._)("div",f,[(0,o.Wm)(H,{outlined:"",label:"Aванс",modelValue:Z.value.avans,"onUpdate:modelValue":l[5]||(l[5]=e=>Z.value.avans=e)},null,8,["modelValue"])])])])),_:1}),(0,o.Wm)(P,{align:"center"},{default:(0,o.w5)((()=>[(0,o.Wm)(F,{label:"Сохранить",type:"submit","no-caps":"",color:"positive"}),(0,o.wy)((0,o.Wm)(F,{label:"Отмена","no-caps":"",color:"dark"},null,512),[[L]])])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["modelValue"])],64)}}};var W=a(9885),q=a(136),y=a(1746),Z=a(1233),Q=a(1682),h=a(7220),C=a(2074),V=a(4458),U=a(8326),j=a(3190),x=a(3119),H=a(6384),D=a(490),z=a(6749),B=a(3115),S=a(1821),$=a(8879),F=a(2146),P=a(9984),T=a.n(P);const A=k,I=A;T()(k,"components",{QPage:W.Z,QSpace:q.Z,QTable:y.Z,QTr:Z.Z,QTh:Q.Z,QTd:h.Z,QDialog:C.Z,QCard:V.Z,QForm:U.Z,QCardSection:j.Z,QInput:x.Z,QSelect:H.Z,QItem:D.Z,QItemSection:z.Z,QItemLabel:B.Z,QCardActions:S.Z,QBtn:$.Z}),T()(k,"directives",{ClosePopup:F.Z})}}]);