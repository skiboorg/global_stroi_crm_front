"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[250],{1250:(l,e,a)=>{a.r(e),a.d(e,{default:()=>O});var u=a(9835),o=a(6970),n=a(499),d=a(1569),t=a(8550),m=a(1862),i=a(9876),s=a(4139),r=a(2637),v=(a(8203),a(1375));const p={class:"flex items-center justify-between q-mb-md"},c=(0,u._)("p",{class:"no-margin text-h6 text-bold"},"Клиенты ",-1),w={class:"row q-col-gutter-md q-mb-md"},_={class:"col-12 col-md-10"},f={class:"col-12 col-md-2"},g={class:"text-bold"},W={class:"q-gutter-md"},b={key:0},k=["href"],V=["href"],q=["href"],U={__name:"clients",setup(l){(0,i.E)();const e=[{name:"name",align:"left",label:"Название организации",field:l=>l.name,sortable:!0},{name:"fio",align:"left",label:"Контактное лицо",field:l=>l.fio,sortable:!0},{name:"inn",align:"left",label:"ИНН",field:l=>l.inn,sortable:!0},{name:"dogovor_summ",align:"left",label:"E-Mail",field:l=>l.email,sortable:!0},{name:"phone",align:"left",label:"Телефон",field:l=>l.phone,sortable:!0}],a=(0,n.iH)(!1),U=(0,n.iH)(!1),h=(0,n.iH)({}),y=((0,n.iH)(null),(0,n.iH)({id:null,name:null,inn:null,job_title:null,fio:null,phone:null,email:null,dogovor_name:null,dogovor_date:null,dogovor_done:null,dogovor_summ:null,comment:null,link:null})),Z={sortBy:"desc",descending:!1,page:1,rowsPerPage:15},D=(0,n.iH)(1),Q=(0,n.iH)(!1),C=(0,n.iH)([]),H=(0,n.iH)(5),x=(0,n.iH)(null),z=(0,n.iH)({q:""}),S=async()=>{console.log(D.value),await j()};(0,u.wF)((async()=>{await j()}));const j=async()=>{Q.value=!Q.value;const l=await(0,d.api)(`/api/catalog/client?page=${D.value}&q=${z.value.q}`);C.value=l.data.results,H.value=Math.ceil(l.data.count/15),Q.value=!Q.value},T=async l=>{await d.api.delete(`/api/catalog/client/${l}`),await j()},L=l=>{l?(y.value=l,y.value.dogovor_date=y.value.dogovor_date?new Date(y.value.dogovor_date).toLocaleDateString():null,y.value.dogovor_done=y.value.dogovor_done?new Date(y.value.dogovor_done).toLocaleDateString():null):y.value={id:null,name:null,inn:null,job_title:null,fio:null,phone:null,email:null,dogovor_name:null,dogovor_date:null,dogovor_done:null,dogovor_summ:null,comment:null,link:null},a.value=!0},P=async()=>{let l=new FormData;delete y.value.file;for(let[e,a]of Object.entries(y.value))l.append(e,JSON.stringify(a));if(x.value&&l.append("file",x.value),y.value.id){const e=await(0,d.api)({method:"put",url:`/api/catalog/client/${y.value.id}`,data:l,headers:{"Content-Type":"multipart/form-data"}});console.log(e.data),await j(),(0,r.d)("positive","Клиент обновлен")}else{await(0,d.api)({method:"post",url:"/api/catalog/client",data:l,headers:{"Content-Type":"multipart/form-data"}});(0,r.d)("positive","Клиент создан"),await j()}a.value=!1},$=l=>{y.value.dogovor_date=new Date(l).toLocaleDateString()},F=l=>{y.value.dogovor_done=new Date(l).toLocaleDateString()};return(l,n)=>{const d=(0,u.up)("q-space"),i=(0,u.up)("q-input"),r=(0,u.up)("q-btn"),I=(0,u.up)("q-th"),Y=(0,u.up)("q-tr"),B=(0,u.up)("q-td"),E=(0,u.up)("q-table"),K=(0,u.up)("q-pagination"),M=(0,u.up)("q-page"),O=(0,u.up)("q-file"),A=(0,u.up)("q-card-section"),J=(0,u.up)("q-card-actions"),N=(0,u.up)("q-form"),G=(0,u.up)("q-card"),R=(0,u.up)("q-dialog"),X=(0,u.up)("q-item-section"),ll=(0,u.up)("q-item"),el=(0,u.up)("q-list"),al=(0,u.Q2)("close-popup");return(0,u.wg)(),(0,u.iD)(u.HY,null,[(0,u.Wm)(M,{padding:""},{default:(0,u.w5)((()=>[(0,u.Wm)(v.Z),(0,u._)("div",p,[c,(0,u.Wm)(d),(0,u.Wm)(t.Z,{icon:"add",label:"Добавить",onClick:n[0]||(n[0]=l=>L(null))})]),(0,u._)("div",w,[(0,u._)("div",_,[(0,u.Wm)(i,{dense:"",modelValue:z.value.q,"onUpdate:modelValue":n[1]||(n[1]=l=>z.value.q=l),label:"Поиск по инн, фио, телефону",outlined:""},null,8,["modelValue"])]),(0,u._)("div",f,[(0,u.Wm)(r,{class:"full-width",label:"Найти","no-caps":"",color:"primary",unelevated:"",onClick:j})])]),(0,u.Wm)(E,{flat:"",rows:C.value,columns:e,"row-key":"name","hide-pagination":"",pagination:Z,"onUpdate:pagination":n[2]||(n[2]=l=>Z=l),loading:Q.value,"table-header-class":"table-header"},{header:(0,u.w5)((l=>[(0,u.Wm)(Y,{props:l,class:"bg-grey-2"},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(l.cols,(e=>((0,u.wg)(),(0,u.j4)(I,{key:e.name,props:l},{default:(0,u.w5)((()=>[(0,u._)("span",g,(0,o.zw)(e.label),1)])),_:2},1032,["props"])))),128)),(0,u.Wm)(I,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,u.w5)((l=>[(0,u.Wm)(Y,{props:l},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(l.cols,(e=>((0,u.wg)(),(0,u.j4)(B,{key:e.name,onClick:e=>(h.value=l.row,U.value=!0),props:l},{default:(0,u.w5)((()=>[(0,u._)("span",null,(0,o.zw)(e.value),1)])),_:2},1032,["onClick","props"])))),128)),(0,u.Wm)(B,{"auto-width":""},{default:(0,u.w5)((()=>[(0,u._)("div",W,[(0,u.Wm)(m.Z,{dense:"",onClick:e=>L(l.row)},null,8,["onClick"]),(0,u.Wm)(t.Z,{dense:"",color:"negative",icon:"delete",onClick:e=>T(l.row.id)},null,8,["onClick"])])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","loading"]),(0,u.Wm)(K,{modelValue:D.value,"onUpdate:modelValue":[n[3]||(n[3]=l=>D.value=l),S],max:H.value,"max-pages":6,"direction-links":"","boundary-numbers":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])),_:1}),(0,u.Wm)(R,{modelValue:a.value,"onUpdate:modelValue":n[17]||(n[17]=l=>a.value=l),onHide:n[18]||(n[18]=e=>l.$router.go())},{default:(0,u.w5)((()=>[(0,u.Wm)(G,{style:{width:"700px","max-width":"100vw"}},{default:(0,u.w5)((()=>[(0,u.Wm)(N,{onSubmit:P},{default:(0,u.w5)((()=>[(0,u.Wm)(A,{class:"q-pb-none"},{default:(0,u.w5)((()=>[(0,u.Wm)(i,{outlined:"",dense:"",label:"Наименование",modelValue:y.value.name,"onUpdate:modelValue":n[4]||(n[4]=l=>y.value.name=l),"lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,u.Wm)(i,{outlined:"",dense:"",label:"ИНН",modelValue:y.value.inn,"onUpdate:modelValue":n[5]||(n[5]=l=>y.value.inn=l),"lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,u.Wm)(i,{class:"q-mb-md",outlined:"",dense:"",label:"Должность",modelValue:y.value.job_title,"onUpdate:modelValue":n[6]||(n[6]=l=>y.value.job_title=l)},null,8,["modelValue"]),(0,u.Wm)(i,{class:"q-mb-md",outlined:"",dense:"",label:"ФИО",modelValue:y.value.fio,"onUpdate:modelValue":n[7]||(n[7]=l=>y.value.fio=l)},null,8,["modelValue"]),(0,u.Wm)(i,{class:"q-mb-md",outlined:"",dense:"",label:"Телефон",mask:"+7 (###) ###-##-##","fill-mask":"",modelValue:y.value.phone,"onUpdate:modelValue":n[8]||(n[8]=l=>y.value.phone=l)},null,8,["modelValue"]),(0,u.Wm)(i,{class:"q-mb-md",outlined:"",dense:"",label:"Почта",modelValue:y.value.email,"onUpdate:modelValue":n[9]||(n[9]=l=>y.value.email=l)},null,8,["modelValue"]),(0,u.Wm)(i,{class:"q-mb-md",outlined:"",dense:"",label:"Наименование договора",modelValue:y.value.dogovor_name,"onUpdate:modelValue":n[10]||(n[10]=l=>y.value.dogovor_name=l)},null,8,["modelValue"]),(0,u.Wm)(s.Z,{dense:"",class:"q-mb-md",modelValue:y.value.dogovor_date,"onUpdate:modelValue":n[11]||(n[11]=l=>y.value.dogovor_date=l),label:"Дата заключения договора",onSelected:$},null,8,["modelValue"]),(0,u.Wm)(s.Z,{dense:"",class:"q-mb-md",modelValue:y.value.dogovor_done,"onUpdate:modelValue":n[12]||(n[12]=l=>y.value.dogovor_done=l),label:"Дата выполнения работ",onSelected:F},null,8,["modelValue"]),(0,u.Wm)(i,{class:"q-mb-md",outlined:"",dense:"",label:"Сумма договора",modelValue:y.value.dogovor_summ,"onUpdate:modelValue":n[13]||(n[13]=l=>y.value.dogovor_summ=l)},null,8,["modelValue"]),(0,u.Wm)(i,{class:"q-mb-md",type:"textarea",outlined:"",dense:"",label:"Примечание",modelValue:y.value.comment,"onUpdate:modelValue":n[14]||(n[14]=l=>y.value.comment=l)},null,8,["modelValue"]),(0,u.Wm)(i,{class:"q-mb-md",outlined:"",dense:"",label:"Ссылка",modelValue:y.value.link,"onUpdate:modelValue":n[15]||(n[15]=l=>y.value.link=l)},null,8,["modelValue"]),y.value.file?((0,u.wg)(),(0,u.iD)("p",b,[(0,u._)("a",{href:y.value.file,target:"_blank"},"Загруженный ранее файл",8,k)])):(0,u.kq)("",!0),(0,u.Wm)(O,{class:"q-mb-md",outlined:"",dense:"",label:"Файл",modelValue:x.value,"onUpdate:modelValue":n[16]||(n[16]=l=>x.value=l)},null,8,["modelValue"])])),_:1}),(0,u.Wm)(J,{align:"center"},{default:(0,u.w5)((()=>[(0,u.Wm)(r,{label:"Сохранить",type:"submit","no-caps":"",color:"positive"}),(0,u.wy)((0,u.Wm)(r,{label:"Отмена","no-caps":"",color:"dark"},null,512),[[al]])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,u.Wm)(R,{modelValue:U.value,"onUpdate:modelValue":n[19]||(n[19]=l=>U.value=l)},{default:(0,u.w5)((()=>[(0,u.Wm)(G,{style:{width:"700px","max-width":"100vw"}},{default:(0,u.w5)((()=>[(0,u.Wm)(A,null,{default:(0,u.w5)((()=>[(0,u.Wm)(el,{separator:""},{default:(0,u.w5)((()=>[(0,u.Wm)(ll,null,{default:(0,u.w5)((()=>[(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Наименование")])),_:1}),(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(h.value.name),1)])),_:1})])),_:1}),(0,u.Wm)(ll,null,{default:(0,u.w5)((()=>[(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)("ИНН")])),_:1}),(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(h.value.inn),1)])),_:1})])),_:1}),(0,u.Wm)(ll,null,{default:(0,u.w5)((()=>[(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)("ФИО")])),_:1}),(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(h.value.fio),1)])),_:1})])),_:1}),(0,u.Wm)(ll,null,{default:(0,u.w5)((()=>[(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Телефон")])),_:1}),(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(h.value.phone),1)])),_:1})])),_:1}),(0,u.Wm)(ll,null,{default:(0,u.w5)((()=>[(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Почта")])),_:1}),(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(h.value.email),1)])),_:1})])),_:1}),(0,u.Wm)(ll,null,{default:(0,u.w5)((()=>[(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Наименование договора")])),_:1}),(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(h.value.dogovor_name),1)])),_:1})])),_:1}),(0,u.Wm)(ll,null,{default:(0,u.w5)((()=>[(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Дата заключения")])),_:1}),(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(new Date(h.value.dogovor_date).toLocaleDateString()),1)])),_:1})])),_:1}),(0,u.Wm)(ll,null,{default:(0,u.w5)((()=>[(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Дата выполнения работ")])),_:1}),(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(new Date(h.value.dogovor_done).toLocaleDateString()),1)])),_:1})])),_:1}),(0,u.Wm)(ll,null,{default:(0,u.w5)((()=>[(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Сумма договора")])),_:1}),(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(h.value.dogovor_summ),1)])),_:1})])),_:1}),(0,u.Wm)(ll,null,{default:(0,u.w5)((()=>[(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Примечание ")])),_:1}),(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(h.value.comment),1)])),_:1})])),_:1}),(0,u.Wm)(ll,null,{default:(0,u.w5)((()=>[(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Ссылка")])),_:1}),(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[h.value.link?((0,u.wg)(),(0,u.iD)("a",{key:0,href:h.value.link,target:"_blank"},"Открыть",8,V)):(0,u.kq)("",!0)])),_:1})])),_:1}),(0,u.Wm)(ll,null,{default:(0,u.w5)((()=>[(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Файл")])),_:1}),(0,u.Wm)(X,null,{default:(0,u.w5)((()=>[h.value.file?((0,u.wg)(),(0,u.iD)("a",{key:0,href:h.value.file,target:"_blank"},"Открыть",8,q)):(0,u.kq)("",!0)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var h=a(9885),y=a(136),Z=a(3119),D=a(8879),Q=a(1746),C=a(1233),H=a(1682),x=a(7220),z=a(996),S=a(2074),j=a(4458),T=a(8326),L=a(3190),P=a(3837),$=a(1821),F=a(3246),I=a(490),Y=a(6749),B=a(2146),E=a(9984),K=a.n(E);const M=U,O=M;K()(U,"components",{QPage:h.Z,QSpace:y.Z,QInput:Z.Z,QBtn:D.Z,QTable:Q.Z,QTr:C.Z,QTh:H.Z,QTd:x.Z,QPagination:z.Z,QDialog:S.Z,QCard:j.Z,QForm:T.Z,QCardSection:L.Z,QFile:P.Z,QCardActions:$.Z,QList:F.Z,QItem:I.Z,QItemSection:Y.Z}),K()(U,"directives",{ClosePopup:B.Z})}}]);