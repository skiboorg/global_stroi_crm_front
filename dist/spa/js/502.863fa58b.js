"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[502],{3502:(e,l,t)=>{t.r(l),t.d(l,{default:()=>me});var a=t(9835),s=t(6970),o=t(1957),d=t(8203),i=t(1569),n=t(499),r=t(8339),u=t(9876),_=t(6928),c=t(1375);const p={class:"flex items-center q-mb-lg"},w={class:"no-margin text-h6 text-bold"},m={class:"row q-col-gutter-md q-mb-md"},b={class:"col-12 col-md-3"},v={class:"row items-center justify-end"},g={class:"row items-center justify-end"},y={class:"col-12 col-md-3"},f={class:"text-h6 text-bold"},k={class:"info-table full-width q-mb-lg"},h=(0,a._)("td",{style:{width:"50%"},class:"text-bold"},"Количество авторизаций в системе, штук",-1),x={style:{width:"50%"}},D=(0,a._)("td",{style:{width:"50%"},class:"text-bold"},"Общее время в системе, часов",-1),z={style:{width:"50%"}},q=(0,a._)("td",{style:{width:"50%"},class:"text-bold"},"Оценка",-1),W={style:{width:"50%"}},j={class:"text-h6 text-bold"},Z={key:0},Q={class:"text-bold"},V={key:0},Y={key:1},H={key:2},C={key:3},P=(0,a._)("p",{class:"text-bold q-mb-sm"},"Задача: ",-1),T=(0,a._)("p",{class:"text-bold q-mb-sm"},"Результат выполнения задачи",-1),U={key:1,class:"q-mb-lg"},F={class:"text-h6 text-bold"},L={class:"info-table full-width"},M=(0,a._)("tr",null,[(0,a._)("td",{class:"text-bold"},"№"),(0,a._)("td",{class:"text-bold"},"Вопрос"),(0,a._)("td",{class:"text-bold"},"План"),(0,a._)("td",{class:"text-bold"},"Факт"),(0,a._)("td",{class:"text-bold"},"В процентах")],-1),S={key:2},$=(0,a._)("p",{class:"text-h6 text-bold"},"Финансовые показатели",-1),B={class:"info-table full-width q-mb-lg"},I=(0,a._)("tr",null,[(0,a._)("td",{style:{width:"50%"},class:"text-bold"}),(0,a._)("td",{style:{width:"10%"},class:"text-bold"},"Период"),(0,a._)("td",{style:{width:"20%"},class:"text-bold"},"Сумма"),(0,a._)("td",{style:{width:"20%"},class:"text-bold"},"Итого")],-1),K=(0,a._)("td",{style:{width:"50%"}},"Заработная плата сотрудника на руки",-1),E={style:{width:"10%"},class:"text-bold"},O={style:{width:"20%"},class:"text-bold"},A={style:{width:"20%"},class:"text-bold"},G=(0,a._)("td",{style:{width:"50%"}},"Расходы организации на сотрудника",-1),J={style:{width:"10%"},class:"text-bold"},N={style:{width:"20%"},class:"text-bold"},R={style:{width:"20%"},class:"text-bold"},X={__name:"report",setup(e){(0,u.E)();const{user:l}=(0,_.t)(),t=(0,n.iH)({user__id:null,created_at_gte:null,created_at_lte:null}),X=(0,r.yj)(),ee=(0,n.iH)(0),le=(0,n.iH)([]),te=(0,n.iH)(""),ae={sortBy:"desc",descending:!1,page:1,rowsPerPage:50},se=(0,n.iH)(0),oe=[{name:"id",align:"left",label:"ID",field:e=>e.id,sortable:!0},{name:"created_at",align:"left",label:"Дата создания",field:e=>new Date(e.created_at).toLocaleDateString(),sortable:!0},{name:"created_at",align:"left",label:"Крайний срок",field:e=>new Date(e.dead_line_date).toLocaleDateString(),sortable:!0},{name:"priority",align:"left",label:"Приоритет",field:e=>e.priority,sortable:!0},{name:"is_done",align:"left",label:"Выполнено",field:e=>e.is_done,sortable:!0},{name:"task_value",align:"left",label:"Оценка",field:e=>e.task_value?e.task_value:"Нет",sortable:!0},{name:"task_value",align:"left",label:"Обратная связь",field:e=>e.user_comment?e.user_comment:"Нет",sortable:!0}];(0,a.wF)((async()=>{let e=new Date;e.setDate(e.getDate()-1),t.value.created_at_gte=e.toLocaleDateString().split(".").reverse().join("-"),t.value.created_at_lte=e.toLocaleDateString().split(".").reverse().join("-"),await ie("apply")}));const de=async()=>{let e;console.log("query_string",te.value),console.log("filters",t.value),e="own"===X.params.user_id?l.id:X.params.user_id;const a=await(0,i.api)(`/api/report/by_user?user_id=${e}&${te.value}`);console.log("data",a.data.tasks),le.value=a.data;let s=0,o=0;for(let l of a.data?.tasks)l.task_value&&(s+=l.task_value,o+=1);se.value=s>0?parseFloat(s/o).toFixed(0):0},ie=async e=>{if(te.value="","apply"===e){const e=new Date(t.value.created_at_gte),l=new Date(t.value.created_at_lte),a=l-e;ee.value=a/864e5;for(let[s,o]of Object.entries(t.value))console.log(s,o),o&&(te.value+=`${s}=${o}&`)}"clear"===e&&(te.value="",t.value={created_at_gte:null,created_at_lte:null}),await de()};return(e,l)=>{const i=(0,a.up)("q-btn"),n=(0,a.up)("q-date"),r=(0,a.up)("q-popup-proxy"),u=(0,a.up)("q-icon"),_=(0,a.up)("q-input"),X=(0,a.up)("q-th"),te=(0,a.up)("q-tr"),de=(0,a.up)("q-td"),ne=(0,a.up)("q-badge"),re=(0,a.up)("q-table"),ue=(0,a.up)("q-page"),_e=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(ue,{padding:""},{default:(0,a.w5)((()=>[(0,a.Wm)(c.Z),(0,a._)("div",p,[(0,a.Wm)(d.Z),(0,a._)("p",w,"Отчет пользователя "+(0,s.zw)(le.value.user),1)]),(0,a._)("div",m,[(0,a._)("div",b,[(0,a.Wm)(_,{class:"q-mb-xs",outlined:"",dense:"",modelValue:t.value.created_at_gte,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value.created_at_gte=e),label:"Отчет с"},{append:(0,a.w5)((()=>[(0,a.Wm)(u,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{modelValue:t.value.created_at_gte,"onUpdate:modelValue":l[0]||(l[0]=e=>t.value.created_at_gte=e),mask:"YYYY-MM-DD"},{default:(0,a.w5)((()=>[(0,a._)("div",v,[(0,a.wy)((0,a.Wm)(i,{label:"Выбрать",color:"primary",flat:""},null,512),[[_e]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(_,{outlined:"",dense:"",modelValue:t.value.created_at_lte,"onUpdate:modelValue":l[3]||(l[3]=e=>t.value.created_at_lte=e),label:"Отчет до"},{append:(0,a.w5)((()=>[(0,a.Wm)(u,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{modelValue:t.value.created_at_lte,"onUpdate:modelValue":l[2]||(l[2]=e=>t.value.created_at_lte=e),mask:"YYYY-MM-DD"},{default:(0,a.w5)((()=>[(0,a._)("div",g,[(0,a.wy)((0,a.Wm)(i,{label:"Выбрать",color:"primary",flat:""},null,512),[[_e]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,a._)("div",y,[(0,a.wy)((0,a.Wm)(i,{class:"q-mb-sm full-width",label:"Применить фильтр",color:"positive",onClick:l[4]||(l[4]=e=>ie("apply")),unelevated:"","no-caps":""},null,512),[[_e]]),(0,a.wy)((0,a.Wm)(i,{class:"full-width",label:"Сбросить фильтр",color:"dark",onClick:l[5]||(l[5]=e=>ie("clear")),unelevated:"","no-caps":""},null,512),[[_e]])])]),(0,a._)("p",f,"Количество усилий "+(0,s.zw)(le.value.login_mark),1),(0,a._)("table",k,[(0,a._)("tr",null,[h,(0,a._)("td",x,(0,s.zw)(le.value.total_logins),1)]),(0,a._)("tr",null,[D,(0,a._)("td",z,(0,s.zw)(2*le.value.total_logins),1)]),(0,a._)("tr",null,[q,(0,a._)("td",W,(0,s.zw)(le.value.login_mark),1)])]),(0,a._)("p",j,[(0,a.Uk)("Качество усилий "),se.value>0?((0,a.wg)(),(0,a.iD)("span",Z,(0,s.zw)(se.value),1)):(0,a.kq)("",!0)]),le.value.tasks?((0,a.wg)(),(0,a.j4)(re,{key:0,flat:"",rows:le.value.tasks,columns:oe,"hide-pagination":"","row-key":"id",pagination:ae,"table-header-class":"table-header"},{header:(0,a.w5)((e=>[(0,a.Wm)(te,{props:e,class:"bg-grey-2"},{default:(0,a.w5)((()=>[(0,a.Wm)(X,{"auto-width":""}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.cols,(l=>((0,a.wg)(),(0,a.j4)(X,{key:l.name,props:e},{default:(0,a.w5)((()=>[(0,a._)("span",Q,(0,s.zw)(l.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,a.w5)((e=>[(0,a.Wm)(te,{props:e},{default:(0,a.w5)((()=>[(0,a.Wm)(de,{"auto-width":""},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{size:"sm",color:"primary",round:"",unelevated:"",dense:"",onClick:l=>e.expand=!e.expand,icon:e.expand?"visibility_off":"visibility"},null,8,["onClick","icon"])])),_:2},1024),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.cols,(l=>((0,a.wg)(),(0,a.j4)(de,{key:l.name,props:e},{default:(0,a.w5)((()=>["is_done"===l.name?((0,a.wg)(),(0,a.iD)("span",V,[l.value?((0,a.wg)(),(0,a.j4)(u,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,a.wg)(),(0,a.j4)(u,{key:1,name:"close",size:"20px",color:"negative"}))])):"is_repeatable"===l.name?((0,a.wg)(),(0,a.iD)("span",Y,[l.value?((0,a.wg)(),(0,a.j4)(u,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,a.wg)(),(0,a.j4)(u,{key:1,name:"close",size:"20px",color:"negative"}))])):"priority"===l.name?((0,a.wg)(),(0,a.iD)("span",H,[1===l.value?((0,a.wg)(),(0,a.j4)(ne,{key:0,color:"positive",label:"Низкий"})):2===l.value?((0,a.wg)(),(0,a.j4)(ne,{key:1,color:"warning",label:"Средний"})):3===l.value?((0,a.wg)(),(0,a.j4)(ne,{key:2,color:"negative",label:"Высокий"})):(0,a.kq)("",!0)])):((0,a.wg)(),(0,a.iD)("span",C,(0,s.zw)(l.value),1))])),_:2},1032,["props"])))),128))])),_:2},1032,["props"]),(0,a.wy)((0,a.Wm)(te,{props:e},{default:(0,a.w5)((()=>[(0,a.Wm)(de,{colspan:"100%"},{default:(0,a.w5)((()=>[P,(0,a._)("p",null,(0,s.zw)(e.row.task),1),T,(0,a._)("p",null,(0,s.zw)(e.row.result),1)])),_:2},1024)])),_:2},1032,["props"]),[[o.F8,e.expand]])])),_:1},8,["rows"])):(0,a.kq)("",!0),le.value.form_result?((0,a.wg)(),(0,a.iD)("div",U,[(0,a._)("p",F,"Операционные показатели "+(0,s.zw)(le.value.form_rate),1),(0,a._)("table",L,[M,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(le.value.form_result,((e,l)=>((0,a.wg)(),(0,a.iD)("tr",{key:l},[(0,a._)("td",null,(0,s.zw)(l+1),1),(0,a._)("td",null,(0,s.zw)(e.label),1),(0,a._)("td",null,(0,s.zw)(e.plan_amount),1),(0,a._)("td",null,(0,s.zw)(e.fact_amount),1),(0,a._)("td",null,(0,s.zw)(e.percent_done),1)])))),128))])])):((0,a.wg)(),(0,a.iD)("p",S,"Назначеных задач не было ")),$,(0,a._)("table",B,[I,(0,a._)("tr",null,[K,(0,a._)("td",E,(0,s.zw)(ee.value),1),(0,a._)("td",O,(0,s.zw)(le.value.daily_payment),1),(0,a._)("td",A,(0,s.zw)(le.value.period_income),1)]),(0,a._)("tr",null,[G,(0,a._)("td",J,(0,s.zw)(ee.value),1),(0,a._)("td",N,(0,s.zw)(le.value.daily_rashod),1),(0,a._)("td",R,(0,s.zw)(le.value.period_outcome),1)])])])),_:1})}}};var ee=t(9885),le=t(3119),te=t(2857),ae=t(2765),se=t(4939),oe=t(8879),de=t(1746),ie=t(1233),ne=t(1682),re=t(7220),ue=t(990),_e=t(2146),ce=t(9984),pe=t.n(ce);const we=X,me=we;pe()(X,"components",{QPage:ee.Z,QInput:le.Z,QIcon:te.Z,QPopupProxy:ae.Z,QDate:se.Z,QBtn:oe.Z,QTable:de.Z,QTr:ie.Z,QTh:ne.Z,QTd:re.Z,QBadge:ue.Z}),pe()(X,"directives",{ClosePopup:_e.Z})}}]);