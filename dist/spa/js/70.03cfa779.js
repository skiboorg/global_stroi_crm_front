"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[70],{2070:(e,l,a)=>{a.r(l),a.d(l,{default:()=>le});a(2879);var o=a(9835),t=a(6970),i=a(499),u=a(1569),n=a(8550),s=a(9876),d=a(2637),m=(a(1801),a(7179));const r={class:"row q-col-gutter-md q-mb-md"},p={class:"col-9"},c={class:"col-3"},v={key:0,class:"row q-col-gutter-md"},b={class:"col-9"},w={class:"col-3"},_={key:0,class:"text-negative"},g={key:1,class:"text-negative"},f={class:"text-bold"},q={key:0},W={key:1},V={key:3},k={class:"q-gutter-md"},y={class:"row q-col-gutter-md"},Z={class:"col-6"},Q={class:"col-6"},h={__name:"tools",setup(e){const l=(0,s.E)(),a=(0,i.iH)([]),h=(0,i.iH)([]),U=(0,i.iH)("items"),C=(0,i.iH)(null),H=(0,i.iH)(!1),D=(0,i.iH)(!1),T=(0,i.iH)(null),x=(0,i.iH)(null),F=(0,i.iH)([]),z=(0,i.iH)(null),I={sortBy:"desc",descending:!1,page:1,rowsPerPage:50},P=(0,i.iH)({store:null,name:null,serial_number:null,price:null,condition:null}),j=["Новый","Б/У"],S=[{name:"select",align:"left",label:"",sortable:!1},{name:"id",align:"left",label:"#",field:e=>e.id,sortable:!0},{name:"image",align:"left",label:"Изображение",field:e=>e.image,sortable:!0},{name:"store",align:"left",label:"Склад",field:e=>e.store?.address,sortable:!0},{name:"name",align:"left",label:"Наименование",field:e=>e.name,sortable:!0},{name:"serial_numbers",align:"left",label:"Серийный номер",field:e=>e.serial_number,sortable:!0},{name:"condition",align:"left",label:"Состояние",field:e=>e.condition,sortable:!0},{name:"price",align:"left",label:"Цена",field:e=>e.price,sortable:!0},{name:"is_avaiable",align:"left",label:"На складе",field:e=>e.is_avaiable?"Да":"Выдан",sortable:!0}];(0,o.wF)((async()=>{await $();const e=await(0,u.api)("/api/material_store/store");h.value=e.data,F.value=await l.getUsers(null,!0)}));const $=async()=>{const e=await(0,u.api)("/api/material_store/store_tool");a.value=e.data},Y=(0,o.Fl)((()=>{if(a.value)return a.value.some((e=>e.is_selected))})),B=async()=>{H.value=!0;let e=new FormData;for(let[a,o]of Object.entries(P.value))e.append(a,o);T.value&&e.append("file",T.value),x.value&&e.append("doc",x.value);try{await(0,u.api)({method:"post",url:"/api/material_store/store_tool",data:e,headers:{"Content-Type":"multipart/form-data"}});(0,d.d)("positive","Инструмент добавлен на склад"),await $(),H.value=!1,D.value=!1}catch(l){(0,d.d)("negative","Проверьте входные данные"),H.value=!1}},K=async(e,l)=>{await u.api.delete(`/api/material_store/${e}/${l}`),await $()},A=(e,l)=>{l((async()=>{if(e){H.value=!0;const l=await(0,u.api)(`/api/user/user?q=${e}&page_size=10000`);F.value=l.data,H.value=!1}}))},E=async()=>{H.value=!0;const e=a.value.filter((e=>e.is_selected));await u.api.post("/api/material_store/create_give_act",{store:C.value,who_get:z.value,selected_tools:e});await $(),H.value=!1};return(e,l)=>{const i=(0,o.up)("q-tab"),u=(0,o.up)("q-tabs"),s=(0,o.up)("q-separator"),d=(0,o.up)("q-select"),$=(0,o.up)("q-item-label"),L=(0,o.up)("q-item-section"),O=(0,o.up)("q-item"),G=(0,o.up)("q-btn"),J=(0,o.up)("q-th"),M=(0,o.up)("q-tr"),N=(0,o.up)("q-checkbox"),R=(0,o.up)("q-img"),X=(0,o.up)("q-td"),ee=(0,o.up)("q-table"),le=(0,o.up)("q-tab-panel"),ae=(0,o.up)("q-tab-panels"),oe=(0,o.up)("q-input"),te=(0,o.up)("q-file"),ie=(0,o.up)("q-card-section"),ue=(0,o.up)("q-card-actions"),ne=(0,o.up)("q-form"),se=(0,o.up)("q-card"),de=(0,o.up)("q-dialog"),me=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(u,{modelValue:U.value,"onUpdate:modelValue":l[0]||(l[0]=e=>U.value=e),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:(0,o.w5)((()=>[(0,o.Wm)(i,{name:"items",label:"Инструменты"}),(0,o.Wm)(i,{name:"docs",label:"Акты"})])),_:1},8,["modelValue"]),(0,o.Wm)(s),(0,o.Wm)(ae,{modelValue:U.value,"onUpdate:modelValue":l[4]||(l[4]=e=>U.value=e),animated:""},{default:(0,o.w5)((()=>[(0,o.Wm)(le,{name:"items"},{default:(0,o.w5)((()=>[(0,o._)("div",r,[(0,o._)("div",p,[(0,o.Wm)(d,{options:h.value,modelValue:C.value,"onUpdate:modelValue":l[1]||(l[1]=e=>C.value=e),clearable:"",outlined:"",dense:"","emit-value":"","option-label":"address","option-value":"id","map-options":"",label:"Выберите склад"},null,8,["options","modelValue"])]),(0,o._)("div",c,[(0,o.Wm)(n.Z,{label:"Добавить",onClick:l[2]||(l[2]=e=>D.value=!0),class:"q-mr-md"})])]),Y.value?((0,o.wg)(),(0,o.iD)("div",v,[(0,o._)("div",b,[(0,o.Wm)(d,{class:"q-mb-xs",dense:"",outlined:"",modelValue:z.value,"onUpdate:modelValue":l[3]||(l[3]=e=>z.value=e),loading:H.value,options:F.value,"option-label":"fio",label:"Выберите пользователя","map-options":"","option-value":"id","emit-value":"","use-input":"",onFilter:A,clearable:""},{option:(0,o.w5)((e=>[(0,o.Wm)(O,(0,t.vs)((0,o.F4)(e.itemProps)),{default:(0,o.w5)((()=>[(0,o.Wm)(L,{side:""},{default:(0,o.w5)((()=>[(0,o.Wm)($,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(e.opt.role?.name),1)])),_:2},1024),(0,o.Wm)($,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)("Роль")])),_:1})])),_:2},1024),(0,o.Wm)(L,null,{default:(0,o.w5)((()=>[(0,o.Wm)($,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(e.opt.fio),1)])),_:2},1024),(0,o.Wm)($,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)("ФИО")])),_:1})])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","loading","options"])]),(0,o._)("div",w,[(0,o.Wm)(G,{"no-caps":"",unelevated:"",color:"positive",disable:!z.value,loading:H.value,onClick:E,label:"Передать выбранное"},null,8,["disable","loading"]),C.value?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("p",_,"Выберите склад")),z.value?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("p",g,"Выберите пользователя"))])])):(0,o.kq)("",!0),(0,o.Wm)(ee,{flat:"",rows:C.value?a.value.filter((e=>e.store.id===C.value)):a.value,columns:S,pagination:I,"table-header-class":"table-header","row-key":"id",selection:"multiple",class:"q-mb-lg"},{header:(0,o.w5)((e=>[(0,o.Wm)(M,{props:e,class:"bg-grey-2"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.cols,(l=>((0,o.wg)(),(0,o.j4)(J,{key:l.name,props:e},{default:(0,o.w5)((()=>[(0,o._)("span",f,(0,t.zw)(l.label),1)])),_:2},1032,["props"])))),128)),(0,o.Wm)(J,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,o.w5)((l=>[(0,o.Wm)(M,{props:l},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.cols,(e=>((0,o.wg)(),(0,o.j4)(X,{key:e.name,props:l},{default:(0,o.w5)((()=>["id"===e.name?((0,o.wg)(),(0,o.iD)("pre",q,(0,t.zw)(l.rowIndex+1),1)):"select"===e.name?((0,o.wg)(),(0,o.iD)("span",W,[(0,o.Wm)(N,{disable:!l.row.is_avaiable,modelValue:l.row.is_selected,"onUpdate:modelValue":e=>l.row.is_selected=e},null,8,["disable","modelValue","onUpdate:modelValue"])])):"image"===e.name?((0,o.wg)(),(0,o.j4)(R,{key:2,ratio:16/9,fit:"contain",src:e.value},null,8,["src"])):((0,o.wg)(),(0,o.iD)("pre",V,(0,t.zw)(e.value),1))])),_:2},1032,["props"])))),128)),(0,o.Wm)(X,{"auto-width":""},{default:(0,o.w5)((()=>[(0,o._)("div",k,[(0,o.Wm)(G,{icon:"visibility",flat:"",dense:"",onClick:a=>e.$router.push(`/store/tool/${l.row.id}`)},null,8,["onClick"]),(0,o.Wm)(n.Z,{dense:"",color:"negative",icon:"delete",onClick:e=>K("store_tool",l.row.id)},null,8,["onClick"])])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows"])])),_:1}),(0,o.Wm)(le,{name:"docs"},{default:(0,o.w5)((()=>[(0,o.Wm)(m.Z)])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(de,{modelValue:D.value,"onUpdate:modelValue":l[12]||(l[12]=e=>D.value=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(se,{style:{width:"700px","max-width":"100vw"}},{default:(0,o.w5)((()=>[(0,o.Wm)(ne,{onSubmit:B},{default:(0,o.w5)((()=>[(0,o.Wm)(ie,{class:"q-pb-none"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{class:"q-mb-md",options:h.value,modelValue:P.value.store,"onUpdate:modelValue":l[5]||(l[5]=e=>P.value.store=e),clearable:"",outlined:"",dense:"","emit-value":"","option-label":"address","option-value":"id","map-options":"",label:"Выберите склад"},null,8,["options","modelValue"]),(0,o.Wm)(oe,{dense:"",outlined:"",label:"Название",class:"q-mb-md",modelValue:P.value.name,"onUpdate:modelValue":l[6]||(l[6]=e=>P.value.name=e)},null,8,["modelValue"]),(0,o._)("div",y,[(0,o._)("div",Z,[(0,o.Wm)(oe,{type:"number",dense:"",outlined:"",label:"Стоимость",class:"q-mb-md",modelValue:P.value.price,"onUpdate:modelValue":l[7]||(l[7]=e=>P.value.price=e)},null,8,["modelValue"])]),(0,o._)("div",Q,[(0,o.Wm)(d,{outlined:"",dense:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:P.value.condition,"onUpdate:modelValue":l[8]||(l[8]=e=>P.value.condition=e),options:j,label:"Состояние"},null,8,["modelValue"])])]),(0,o.Wm)(oe,{class:"q-mb-md",dense:"",outlined:"",label:"Серийный номер",modelValue:P.value.serial_number,"onUpdate:modelValue":l[9]||(l[9]=e=>P.value.serial_number=e)},null,8,["modelValue"]),(0,o.Wm)(te,{class:"q-mb-md",outlined:"",dense:"",label:"Фото",modelValue:T.value,"onUpdate:modelValue":l[10]||(l[10]=e=>T.value=e)},null,8,["modelValue"]),(0,o.Wm)(te,{outlined:"",dense:"",label:"Товарный чек, счет на покупку",modelValue:x.value,"onUpdate:modelValue":l[11]||(l[11]=e=>x.value=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(ue,{align:"center"},{default:(0,o.w5)((()=>[(0,o.Wm)(G,{label:"Сохранить",loading:H.value,"no-caps":"",color:"positive",type:"submit"},null,8,["loading"]),(0,o.wy)((0,o.Wm)(G,{label:"Отмена",loading:H.value,"no-caps":"",color:"dark"},null,8,["loading"]),[[me]])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var U=a(7817),C=a(900),H=a(926),D=a(9800),T=a(4106),x=a(6384),F=a(490),z=a(6749),I=a(3115),P=a(8879),j=a(1746),S=a(1233),$=a(1682),Y=a(7220),B=a(1006),K=a(335),A=a(2074),E=a(4458),L=a(8326),O=a(3190),G=a(3119),J=a(9420),M=a(1821),N=a(2146),R=a(9984),X=a.n(R);const ee=h,le=ee;X()(h,"components",{QTabs:U.Z,QTab:C.Z,QSeparator:H.Z,QTabPanels:D.Z,QTabPanel:T.Z,QSelect:x.Z,QItem:F.Z,QItemSection:z.Z,QItemLabel:I.Z,QBtn:P.Z,QTable:j.Z,QTr:S.Z,QTh:$.Z,QTd:Y.Z,QCheckbox:B.Z,QImg:K.Z,QDialog:A.Z,QCard:E.Z,QForm:L.Z,QCardSection:O.Z,QInput:G.Z,QFile:J.Z,QCardActions:M.Z}),X()(h,"directives",{ClosePopup:N.Z})}}]);