"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[927],{4762:(e,l,a)=>{a.r(l),a.d(l,{default:()=>de});var t=a(9835),o=a(6970),i=a(1957),n=a(499),u=a(1569),d=a(9876),s=a(8550),m=a(2637),p=a(8227),r=a(1375);const c=(0,t._)("div",{class:"flex items-center justify-between q-mb-md"},[(0,t._)("p",{class:"no-margin text-h6 text-bold"},"Задачи")],-1),_={class:"row q-col-gutter-md q-mb-lg"},v={class:"col-12 col-md-9"},w={class:"row items-center justify-end"},b={class:"col-12 col-md-3"},f={class:"text-bold"},g={key:0},k={key:1},y={key:2},W={key:3,class:"no-margin ellipsis",style:{"max-width":"300px"}},q={class:"q-gutter-md"},h=(0,t._)("p",{class:"text-bold q-mb-sm"},"Задача:",-1),x={key:0},V=(0,t._)("p",{class:"text-bold q-mb-sm"},"Результат выполнения задачи",-1),Z={style:{height:"80px","overflow-y":"auto",width:"80%"}},Q={style:{"white-space":"break-spaces"}},U=(0,t._)("p",{class:"text-bold q-mb-sm"},"Оценка выполнения задачи",-1),D={class:"q-gutter-md q-mt-md"},C=(0,t._)("p",null,null,-1),j={class:"q-mb-md"},z={__name:"admin_tasks",setup(e){const l=(0,d.E)(),a=((0,n.iH)(null),(0,n.iH)([])),z=(0,n.iH)([]),H=(0,n.iH)(!1),P=["10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00"],S=[{label:"Низкий",value:1},{label:"Средний",value:2},{label:"Высокий",value:3}],T=(0,n.iH)({priority:1,task:null,dead_line_time:"20:00",is_repeatable:!1}),$=(0,n.iH)({user__id:null,is_done:!1,dead_line_date__exact:null}),Y=(0,n.iH)(""),F=(0,n.iH)(5),I=(0,n.iH)(1),M=(0,n.iH)(!1),B={sortBy:"desc",descending:!1,page:1,rowsPerPage:25},L=[{name:"id",align:"left",label:"ID",field:e=>e.id,sortable:!0},{name:"priority",align:"left",label:"Приоритет",field:e=>e.priority,sortable:!0},{name:"user",align:"left",label:"Пользователь",field:e=>e.user?.fio,sortable:!0},{name:"task",align:"left",label:"Задача",field:e=>e.task,sortable:!0},{name:"is_done",align:"left",label:"Выполнено",field:e=>e.is_done,sortable:!0},{name:"is_repeatable",align:"left",label:"Ежедневная",field:e=>e.is_repeatable,sortable:!0},{name:"dead_line",align:"left",label:"Дата",field:e=>new Date(e.dead_line_date).toLocaleDateString(),sortable:!0},{name:"dead_line_time",align:"left",label:"Время",field:e=>e.dead_line_time,sortable:!0},{name:"task_value",align:"left",label:"Оценка",field:e=>e.task_value?e.task_value:"Нет",sortable:!0},{name:"user_comment",align:"left",label:"Обратная связь",field:e=>e.user_comment?e.user_comment:"Нет",sortable:!0}];(0,t.wF)((async()=>{await K();const e=await l.getUsers(null,!0);a.value=e}));const K=async()=>{M.value=!M.value;const e=await(0,u.api)(`/api/task/task?admin=true&page=${I.value}&${Y.value}`);z.value=e.data.results,F.value=Math.ceil(e.data.count/15),M.value=!M.value},E=async e=>{M.value=!0;let l=new FormData;l.append("task_value",e.task_value),l.append("admin_comment",e.admin_comment);try{await(0,u.api)({method:"patch",url:`/api/task/task/${e.id}`,data:l,headers:{"Content-Type":"multipart/form-data"}});(0,m.d)("positive","Задача обновлена"),await K(),M.value=!1}catch(a){(0,m.d)("negative","Проверьте входные данные"),M.value=!1}M.value=!1},O=(e,l)=>{l((async()=>{if(e){M.value=!M.value;const l=await(0,u.api)(`/api/user/user?q=${e}&page_size=10000`);a.value=l.data,M.value=!M.value}}))},R=async()=>{console.log(I.value),await K()},A=async e=>{if(Y.value="",$.value.is_done||(Y.value=""),"apply"===e)for(let[l,a]of Object.entries($.value))console.log(l,a),a&&(Y.value+=`${l}=${a}&`);"clear"===e&&(Y.value="",$.value={user__id:null,is_done:!1,dead_line_date__exact:null}),await K()},G=async()=>{M.value=!M.value,T.value.user_id=$.value.user__id;await u.api.post("/api/task/task",T.value);(0,m.d)("positive","Задача добавлена"),T.value={priority:1,task:null,dead_line_time:"20:00",is_repeatable:!1},H.value=!1,await K(),M.value=!M.value},J=async e=>{M.value=!M.value;await u.api.delete(`/api/task/task/${e}`);await K(),M.value=!M.value};return(e,l)=>{const n=(0,t.up)("q-item-label"),u=(0,t.up)("q-item-section"),d=(0,t.up)("q-item"),m=(0,t.up)("q-select"),Y=(0,t.up)("q-btn"),K=(0,t.up)("q-date"),N=(0,t.up)("q-popup-proxy"),X=(0,t.up)("q-icon"),ee=(0,t.up)("q-input"),le=(0,t.up)("q-checkbox"),ae=(0,t.up)("q-th"),te=(0,t.up)("q-tr"),oe=(0,t.up)("q-td"),ie=(0,t.up)("q-badge"),ne=(0,t.up)("q-tooltip"),ue=(0,t.up)("q-rating"),de=(0,t.up)("q-table"),se=(0,t.up)("q-pagination"),me=(0,t.up)("q-page"),pe=(0,t.up)("q-form"),re=(0,t.up)("q-card-section"),ce=(0,t.up)("q-card"),_e=(0,t.up)("q-dialog"),ve=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(me,{padding:""},{default:(0,t.w5)((()=>[(0,t.Wm)(r.Z),c,(0,t._)("div",_,[(0,t._)("div",v,[(0,t.Wm)(m,{class:"q-mb-xs",dense:"",outlined:"",modelValue:$.value.user__id,"onUpdate:modelValue":l[0]||(l[0]=e=>$.value.user__id=e),loading:M.value,options:a.value,"option-label":"fio",label:"Выберите пользователя","map-options":"","option-value":"id","emit-value":"","use-input":"",onFilter:O,clearable:""},{option:(0,t.w5)((e=>[(0,t.Wm)(d,(0,o.vs)((0,t.F4)(e.itemProps)),{default:(0,t.w5)((()=>[(0,t.Wm)(u,{side:""},{default:(0,t.w5)((()=>[(0,t.Wm)(n,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.opt.role?.name),1)])),_:2},1024),(0,t.Wm)(n,{caption:""},{default:(0,t.w5)((()=>[(0,t.Uk)("Роль")])),_:1})])),_:2},1024),(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[(0,t.Wm)(n,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(e.opt.fio),1)])),_:2},1024),(0,t.Wm)(n,{caption:""},{default:(0,t.w5)((()=>[(0,t.Uk)("ФИО")])),_:1})])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","loading","options"]),(0,t.Wm)(ee,{outlined:"",dense:"",modelValue:$.value.dead_line_date__exact,"onUpdate:modelValue":l[2]||(l[2]=e=>$.value.dead_line_date__exact=e),label:"Выполнить до",clearable:""},{append:(0,t.w5)((()=>[(0,t.Wm)(X,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(N,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(K,{modelValue:$.value.dead_line_date__exact,"onUpdate:modelValue":l[1]||(l[1]=e=>$.value.dead_line_date__exact=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",w,[(0,t.wy)((0,t.Wm)(Y,{label:"Выбрать",color:"primary",flat:""},null,512),[[ve]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(le,{label:"Выполнено",modelValue:$.value.is_done,"onUpdate:modelValue":l[3]||(l[3]=e=>$.value.is_done=e)},null,8,["modelValue"])]),(0,t._)("div",b,[(0,t.wy)((0,t.Wm)(Y,{class:"q-mb-sm full-width",label:"Применить фильтр",color:"positive",onClick:l[4]||(l[4]=e=>A("apply")),unelevated:"","no-caps":""},null,512),[[ve]]),(0,t.wy)((0,t.Wm)(Y,{class:"full-width",label:"Сбросить фильтр",color:"dark",onClick:l[5]||(l[5]=e=>A("clear")),unelevated:"","no-caps":""},null,512),[[ve]]),$.value.user__id?(0,t.wy)(((0,t.wg)(),(0,t.j4)(s.Z,{key:0,class:"full-width q-mt-sm",label:"Создать задачу",color:"warning",onClick:l[6]||(l[6]=e=>H.value=!0),unelevated:"","no-caps":""},null,512)),[[ve]]):(0,t.kq)("",!0)])]),(0,t.Wm)(de,{flat:"",rows:z.value,columns:L,"row-key":"id","hide-pagination":"","table-header-class":"table-header",pagination:B},{header:(0,t.w5)((e=>[(0,t.Wm)(te,{props:e,class:"bg-grey-2"},{default:(0,t.w5)((()=>[(0,t.Wm)(ae,{"auto-width":""}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(ae,{key:l.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",f,(0,o.zw)(l.label),1)])),_:2},1032,["props"])))),128)),(0,t.Wm)(ae,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,t.w5)((e=>[(0,t.Wm)(te,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(oe,{"auto-width":""},{default:(0,t.w5)((()=>[(0,t.Wm)(Y,{size:"sm",color:"primary",round:"",unelevated:"",dense:"",onClick:l=>e.expand=!e.expand,icon:e.expand?"visibility_off":"visibility"},null,8,["onClick","icon"])])),_:2},1024),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(oe,{key:l.name,props:e},{default:(0,t.w5)((()=>["is_done"===l.name?((0,t.wg)(),(0,t.iD)("span",g,[l.value?((0,t.wg)(),(0,t.j4)(X,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,t.wg)(),(0,t.j4)(X,{key:1,name:"close",size:"20px",color:"negative"}))])):"is_repeatable"===l.name?((0,t.wg)(),(0,t.iD)("span",k,[l.value?((0,t.wg)(),(0,t.j4)(X,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,t.wg)(),(0,t.j4)(X,{key:1,name:"close",size:"20px",color:"negative"}))])):"priority"===l.name?((0,t.wg)(),(0,t.iD)("span",y,[1===l.value?((0,t.wg)(),(0,t.j4)(ie,{key:0,color:"positive",label:"Низкий"})):2===l.value?((0,t.wg)(),(0,t.j4)(ie,{key:1,color:"warning",label:"Средний"})):3===l.value?((0,t.wg)(),(0,t.j4)(ie,{key:2,color:"negative",label:"Высокий"})):(0,t.kq)("",!0)])):((0,t.wg)(),(0,t.iD)("p",W,(0,o.zw)(l.value),1))])),_:2},1032,["props"])))),128)),(0,t.Wm)(oe,{"auto-width":""},{default:(0,t.w5)((()=>[(0,t._)("div",q,[(0,t.Wm)(p.Z,{onConfirm:l=>J(e.row.id)},null,8,["onConfirm"])])])),_:2},1024)])),_:2},1032,["props"]),(0,t.wy)((0,t.Wm)(te,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(oe,{colspan:"100%"},{default:(0,t.w5)((()=>[h,(0,t._)("p",null,(0,o.zw)(e.row.task),1),e.row.is_done?((0,t.wg)(),(0,t.iD)("div",x,[V,(0,t._)("div",Z,[(0,t._)("p",Q,(0,o.zw)(e.row.result),1)]),U,(0,t.Wm)(ue,{modelValue:e.row.task_value,"onUpdate:modelValue":l=>e.row.task_value=l,size:"2em",class:"q-mb-md",max:5,color:"primary"},{"tip-1":(0,t.w5)((()=>[(0,t.Wm)(ne,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Очень плохо")])),_:1})])),"tip-2":(0,t.w5)((()=>[(0,t.Wm)(ne,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Плохо")])),_:1})])),"tip-3":(0,t.w5)((()=>[(0,t.Wm)(ne,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Пойдет")])),_:1})])),"tip-4":(0,t.w5)((()=>[(0,t.Wm)(ne,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Хорошо")])),_:1})])),"tip-5":(0,t.w5)((()=>[(0,t.Wm)(ne,null,{default:(0,t.w5)((()=>[(0,t.Uk)("Отлично")])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,t.Wm)(ee,{outlined:"",dense:"",modelValue:e.row.admin_comment,"onUpdate:modelValue":l=>e.row.admin_comment=l,type:"textarea",label:"Обратная связь"},null,8,["modelValue","onUpdate:modelValue"]),(0,t._)("div",D,[(0,t.Wm)(Y,{dense:"",color:"positive",icon:"save",loading:M.value,"no-caps":"",unelevated:"",label:"Сохранить",onClick:l=>E(e.row)},null,8,["loading","onClick"]),e.row.file?((0,t.wg)(),(0,t.j4)(Y,{key:0,href:e.row.file,loading:M.value,icon:"download",dense:"",outline:"",color:"primary",target:"_blank","no-caps":"",unelevated:"",label:"Скачать файл"},null,8,["href","loading"])):(0,t.kq)("",!0)])])):(0,t.kq)("",!0)])),_:2},1024)])),_:2},1032,["props"]),[[i.F8,e.expand]])])),_:1},8,["rows"]),(0,t.Wm)(se,{modelValue:I.value,"onUpdate:modelValue":[l[7]||(l[7]=e=>I.value=e),R],max:F.value,"max-pages":6,"direction-links":"","boundary-numbers":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])),_:1}),(0,t.Wm)(_e,{modelValue:H.value,"onUpdate:modelValue":l[12]||(l[12]=e=>H.value=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(ce,{style:{width:"700px","max-width":"100vw"}},{default:(0,t.w5)((()=>[(0,t.Wm)(re,null,{default:(0,t.w5)((()=>[(0,t.Wm)(pe,{onSubmit:(0,i.iM)(G,["prevent"])},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{outlined:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:T.value.priority,"onUpdate:modelValue":l[8]||(l[8]=e=>T.value.priority=e),options:S,label:"Приоритет"},null,8,["modelValue"]),(0,t.Wm)(ee,{modelValue:T.value.task,"onUpdate:modelValue":l[9]||(l[9]=e=>T.value.task=e),type:"textarea",label:"Задача *",outlined:"","lazy-rules":"",rules:[e=>null!==e&&""!==e||"Это обязательное поле"]},null,8,["modelValue","rules"]),C,(0,t.Wm)(m,{outlined:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:T.value.dead_line_time,"onUpdate:modelValue":l[10]||(l[10]=e=>T.value.dead_line_time=e),options:P,label:`Выполнить ${(new Date).toLocaleDateString()} до`},null,8,["modelValue","label"]),(0,t._)("div",j,[(0,t.Wm)(le,{modelValue:T.value.is_repeatable,"onUpdate:modelValue":l[11]||(l[11]=e=>T.value.is_repeatable=e),label:"Ежедневная задача"},null,8,["modelValue"])]),(0,t.Wm)(Y,{icon:"save",color:"positive","no-caps":"",unelevated:"",type:"submit",loading:M.value,label:"Сохранить"},null,8,["loading"])])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var H=a(9885),P=a(136),S=a(8879),T=a(6384),$=a(490),Y=a(6749),F=a(3115),I=a(3119),M=a(2857),B=a(2765),L=a(4939),K=a(1006),E=a(1746),O=a(1233),R=a(1682),A=a(7220),G=a(990),J=a(1570),N=a(6858),X=a(996),ee=a(2074),le=a(4458),ae=a(3190),te=a(8326),oe=a(2146),ie=a(9984),ne=a.n(ie);const ue=z,de=ue;ne()(z,"components",{QPage:H.Z,QSpace:P.Z,QBtn:S.Z,QSelect:T.Z,QItem:$.Z,QItemSection:Y.Z,QItemLabel:F.Z,QInput:I.Z,QIcon:M.Z,QPopupProxy:B.Z,QDate:L.Z,QCheckbox:K.Z,QTable:E.Z,QTr:O.Z,QTh:R.Z,QTd:A.Z,QBadge:G.Z,QRating:J.Z,QTooltip:N.Z,QPagination:X.Z,QDialog:ee.Z,QCard:le.Z,QCardSection:ae.Z,QForm:te.Z}),ne()(z,"directives",{ClosePopup:oe.Z})}}]);