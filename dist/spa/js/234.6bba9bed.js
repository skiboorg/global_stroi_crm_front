"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[234],{1234:(l,e,a)=>{a.r(e),a.d(e,{default:()=>x});a(2879);var o=a(9835),t=a(6970),u=a(499),n=a(1569),s=a(8550),i=a(2637),m=a(8227),d=a(9876),c=a(8203),p=a(8339);const r={class:"flex items-center justify-between q-mb-md"},v=(0,o._)("p",{class:"no-margin text-h6 text-bold"},"Структура формы усилий",-1),_={key:0},f={key:0,class:"row q-col-gutter-md q-mb-md items-center"},w=(0,o._)("div",{class:"col-1"},"ID",-1),b=(0,o._)("div",{class:"col-3"}," Вопрос",-1),g=(0,o._)("div",{class:"col-1"},"План",-1),q=(0,o._)("div",{class:"col-1"},null,-1),k=[w,b,g,q],W={class:"col-1"},V={class:"col-3"},h={class:"col-1"},Z={class:"col-1"},y={__name:"form",setup(l){const e=(0,d.E)(),a=(0,p.yj)(),w=(0,p.tv)(),b=(0,u.iH)([]),g=(0,u.iH)([]),q=(0,u.iH)(null),y=(0,u.iH)([]),U=(0,u.iH)(!1);(0,o.wF)((async()=>{await C(),y.value=await e.getUsers(null,!0)}));const C=async()=>{const l=await(0,n.api)(`/api/form/stress_form/${a.params.id}`);q.value=l.data.name,b.value=l.data.default_data,g.value=l.data.for_users},Q=()=>{b.value.push({label:null,plan_amount:null,fact_amount:0,percent_done:0})},H=async()=>{await n.api.delete(`/api/form/stress_form/${a.params.id}`),w.push("/form/forms")},D=l=>{b.value.splice(l,1)},I=async()=>{U.value=!U.value;const l=await n.api.patch(`/api/form/stress_form/${a.params.id}`,{default_data:b.value,name:q.value,for_users:g.value});(0,i.d)("positive","Форма обновлена"),console.log(l.data),U.value=!U.value},j=(0,o.Fl)((()=>{let l=!1;return b.value.forEach((e=>{!e.label&&(l=!0),!e.plan_amount&&(l=!0)})),l})),z=(l,e)=>{e((async()=>{if(l){U.value=!U.value;const e=await(0,n.api)(`/api/user/user?q=${l}&page_size=10000`);y.value=e.data,U.value=!U.value}}))};return(l,e)=>{const a=(0,o.up)("q-space"),u=(0,o.up)("q-input"),n=(0,o.up)("q-item-label"),i=(0,o.up)("q-item-section"),d=(0,o.up)("q-item"),p=(0,o.up)("q-select"),w=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(w,{padding:""},{default:(0,o.w5)((()=>[(0,o._)("div",r,[(0,o.Wm)(c.Z),v,(0,o.Wm)(a),(0,o.Wm)(m.Z,{onConfirm:H,label:"Удалить форму"})]),(0,o.Wm)(u,{class:"q-mb-md",modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=l=>q.value=l),outlined:"",label:"Название формы"},null,8,["modelValue"]),q.value?((0,o.wg)(),(0,o.iD)("div",_,[(0,o.Wm)(p,{class:"q-mb-md",outlined:"",modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=l=>g.value=l),loading:U.value,options:y.value,"option-label":"fio",label:"Выберите пользователей","map-options":"","option-value":"id",multiple:"","use-chips":"","emit-value":"",onFilter:z,"use-input":"",clearable:""},{option:(0,o.w5)((l=>[(0,o.Wm)(d,(0,t.vs)((0,o.F4)(l.itemProps)),{default:(0,o.w5)((()=>[(0,o.Wm)(i,{side:""},{default:(0,o.w5)((()=>[(0,o.Wm)(n,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(l.opt.role?.name),1)])),_:2},1024),(0,o.Wm)(n,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)("Роль")])),_:1})])),_:2},1024),(0,o.Wm)(i,null,{default:(0,o.w5)((()=>[(0,o.Wm)(n,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,t.zw)(l.opt.fio),1)])),_:2},1024),(0,o.Wm)(n,{caption:""},{default:(0,o.w5)((()=>[(0,o.Uk)("ФИО")])),_:1})])),_:2},1024)])),_:2},1040)])),_:1},8,["modelValue","loading","options"]),b.value.length>0?((0,o.wg)(),(0,o.iD)("div",f,k)):(0,o.kq)("",!0),(0,o.Wm)(s.Z,{class:"q-mb-lg",label:"Добавить ряд",onClick:Q}),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(b.value,((l,e)=>((0,o.wg)(),(0,o.iD)("div",{class:"row q-col-gutter-md q-mb-md items-center",key:e},[(0,o._)("div",W,(0,t.zw)(e+1),1),(0,o._)("div",V,[(0,o.Wm)(u,{outlined:"",dense:"",modelValue:l.label,"onUpdate:modelValue":e=>l.label=e},null,8,["modelValue","onUpdate:modelValue"])]),(0,o._)("div",h,[(0,o.Wm)(u,{outlined:"",dense:"",modelValue:l.plan_amount,"onUpdate:modelValue":e=>l.plan_amount=e},null,8,["modelValue","onUpdate:modelValue"])]),(0,o._)("div",Z,[(0,o.Wm)(m.Z,{onConfirm:l=>D(e)},null,8,["onConfirm"])])])))),128)),b.value.length>0?((0,o.wg)(),(0,o.j4)(s.Z,{key:1,loading:U.value,label:"Сохранить форму",icon:"save",disable:j.value,onClick:I,color:"positive"},null,8,["loading","disable"])):(0,o.kq)("",!0)])):(0,o.kq)("",!0)])),_:1})}}};var U=a(9885),C=a(136),Q=a(3119),H=a(6384),D=a(490),I=a(6749),j=a(3115),z=a(9984),F=a.n(z);const $=y,x=$;F()(y,"components",{QPage:U.Z,QSpace:C.Z,QInput:Q.Z,QSelect:H.Z,QItem:D.Z,QItemSection:I.Z,QItemLabel:j.Z})}}]);