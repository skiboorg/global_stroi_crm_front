"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[502],{3502:(e,l,t)=>{t.r(l),t.d(l,{default:()=>je});var a=t(9835),s=t(6970),o=t(1957),d=t(8203),n=t(1569),i=t(499),r=t(8339),u=t(9876),_=t(6928),c=t(1375);const w={class:"flex items-center q-mb-lg"},p={class:"no-margin text-h6 text-bold"},m={class:"row q-col-gutter-md q-mb-md"},b={class:"col-12 col-md-3"},g={class:"row items-center justify-end"},v={class:"row items-center justify-end"},y={class:"col-12 col-md-3"},f={class:"text-h6 text-bold"},h={class:"info-table full-width q-mb-lg"},x=(0,a._)("td",{style:{width:"50%"},class:"text-bold"},"Количество авторизаций в системе, штук",-1),k={style:{width:"50%"}},z=(0,a._)("td",{style:{width:"50%"},class:"text-bold"},"Общее время в системе, часов",-1),D={style:{width:"50%"}},q=(0,a._)("td",{style:{width:"50%"},class:"text-bold"},"Оценка",-1),W={style:{width:"50%"}},j={class:"text-h6 text-bold"},Z={key:0},F={class:"text-bold"},Q={key:0},V={key:1},T={key:2},Y={key:3},$=(0,a._)("p",{class:"text-bold q-mb-sm"},"Задача: ",-1),H=(0,a._)("p",{class:"text-bold q-mb-sm"},"Результат выполнения задачи",-1),C={class:"info-table full-width q-mb-lg"},M=(0,a._)("td",{style:{width:"50%"}},"Всего задач",-1),P={style:{width:"25%"},class:"text-bold"},U=(0,a._)("td",{style:{width:"25%"},class:"text-bold"},"100%",-1),L=(0,a._)("td",{style:{width:"50%"}},"Выполнено",-1),S={style:{width:"25%"},class:"text-bold"},B={style:{width:"25%"},class:"text-bold"},I=(0,a._)("td",{style:{width:"50%"}},"Не выполнено",-1),K={style:{width:"25%"},class:"text-bold"},E={style:{width:"25%"},class:"text-bold"},O=(0,a._)("td",{style:{width:"50%"}},"Среднее время выполнения задач",-1),A={style:{width:"25%"},class:"text-bold"},G=(0,a._)("td",{style:{width:"25%"},class:"text-bold"},"-",-1),J={key:1,class:"q-mb-lg"},N={class:"text-h6 text-bold"},R={class:"info-table full-width"},X=(0,a._)("tr",null,[(0,a._)("td",{class:"text-bold"},"№"),(0,a._)("td",{class:"text-bold"},"Вопрос"),(0,a._)("td",{class:"text-bold"},"План"),(0,a._)("td",{class:"text-bold"},"Факт"),(0,a._)("td",{class:"text-bold"},"В процентах")],-1),ee={key:2},le=(0,a._)("p",{class:"text-h6 text-bold"},"Финансовые показатели",-1),te={class:"info-table full-width q-mb-lg"},ae=(0,a._)("tr",null,[(0,a._)("td",{style:{width:"50%"},class:"text-bold"}),(0,a._)("td",{style:{width:"10%"},class:"text-bold"},"Период"),(0,a._)("td",{style:{width:"20%"},class:"text-bold"},"Сумма"),(0,a._)("td",{style:{width:"20%"},class:"text-bold"},"Итого")],-1),se=(0,a._)("td",{style:{width:"50%"}},"Заработная плата сотрудника на руки",-1),oe={style:{width:"10%"},class:"text-bold"},de={style:{width:"20%"},class:"text-bold"},ne={style:{width:"20%"},class:"text-bold"},ie=(0,a._)("td",{style:{width:"50%"}},"Расходы организации на сотрудника",-1),re={style:{width:"10%"},class:"text-bold"},ue={style:{width:"20%"},class:"text-bold"},_e={style:{width:"20%"},class:"text-bold"},ce={__name:"report",setup(e){(0,u.E)();const{user:l}=(0,_.t)(),t=(0,i.iH)({user__id:null,created_at_gte:null,created_at_lte:null}),ce=(0,r.yj)(),we=(0,i.iH)(0),pe=(0,i.iH)([]),me=(0,i.iH)(""),be=(0,i.iH)({}),ge={sortBy:"desc",descending:!1,page:1,rowsPerPage:50},ve=(0,i.iH)(0),ye=[{name:"id",align:"left",label:"ID",field:e=>e.id,sortable:!0},{name:"created_at",align:"left",label:"Дата создания",field:e=>new Date(e.created_at).toLocaleDateString(),sortable:!0},{name:"created_at",align:"left",label:"Крайний срок",field:e=>new Date(e.dead_line_date).toLocaleDateString(),sortable:!0},{name:"priority",align:"left",label:"Приоритет",field:e=>e.priority,sortable:!0},{name:"is_done",align:"left",label:"Выполнено",field:e=>e.is_done,sortable:!0},{name:"task_value",align:"left",label:"Оценка",field:e=>e.task_value?e.task_value:"Нет",sortable:!0},{name:"task_value",align:"left",label:"Обратная связь",field:e=>e.user_comment?e.user_comment:"Нет",sortable:!0},{name:"time_difference",align:"left",label:"Время выполнения",field:e=>{if(!e.created||!e.done_date)return"Нет данных";const l=new Date(e.created),t=new Date(e.done_date),a=t-l,s=Math.floor(a/6e4),o=Math.floor(s/60),d=s%60;return`${o}ч ${d}мин`},sortable:!0}];(0,a.wF)((async()=>{let e=new Date;e.setDate(e.getDate()-1),t.value.created_at_gte=e.toLocaleDateString().split(".").reverse().join("-"),t.value.created_at_lte=e.toLocaleDateString().split(".").reverse().join("-"),await he("apply")}));const fe=async()=>{let e;console.log("query_string",me.value),console.log("filters",t.value),e="own"===ce.params.user_id?l.id:ce.params.user_id;const a=await(0,n.api)(`/api/report/by_user?user_id=${e}&${me.value}`);console.log("data",a.data.tasks),pe.value=a.data;let s=0,o=0;for(let l of a.data?.tasks)l.task_value&&(s+=l.task_value,o+=1);ve.value=s>0?parseFloat(s/o).toFixed(0):0;let d=pe.value.tasks;const i=d.length,r=d.filter((e=>e.is_done)).length,u=i-r,_=d.filter((e=>!e.is_repeatable&&e.is_done));console.log(`repeatableTasks задач: ${_}`);const c=_.length>0?_.reduce(((e,l)=>{const t=new Date(l.created).getTime(),a=new Date(l.done_date).getTime();return e+(a-t)/6e4}),0)/_.length:0;console.log(`Всего задач: ${i}`),console.log(`Выполнено: ${r}`),console.log(`Невыполнено: ${u}`),console.log(`Среднее вяемых задач: ${parseFloat(c/60).toFixed(2)}`),be.value={total:i,done:r,pending:u,averageTime:parseFloat(c/60).toFixed(2)}},he=async e=>{if(me.value="","apply"===e){const e=new Date(t.value.created_at_gte),l=new Date(t.value.created_at_lte),a=l-e;we.value=a/864e5;for(let[s,o]of Object.entries(t.value))console.log(s,o),o&&(me.value+=`${s}=${o}&`)}"clear"===e&&(me.value="",t.value={created_at_gte:null,created_at_lte:null}),await fe()};return(e,l)=>{const n=(0,a.up)("q-btn"),i=(0,a.up)("q-date"),r=(0,a.up)("q-popup-proxy"),u=(0,a.up)("q-icon"),_=(0,a.up)("q-input"),ce=(0,a.up)("q-th"),me=(0,a.up)("q-tr"),fe=(0,a.up)("q-td"),xe=(0,a.up)("q-badge"),ke=(0,a.up)("q-table"),ze=(0,a.up)("q-page"),De=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(ze,{padding:""},{default:(0,a.w5)((()=>[(0,a.Wm)(c.Z),(0,a._)("div",w,[(0,a.Wm)(d.Z),(0,a._)("p",p,"Отчет пользователя "+(0,s.zw)(pe.value.user),1)]),(0,a._)("div",m,[(0,a._)("div",b,[(0,a.Wm)(_,{class:"q-mb-xs",outlined:"",dense:"",modelValue:t.value.created_at_gte,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value.created_at_gte=e),label:"Отчет с"},{append:(0,a.w5)((()=>[(0,a.Wm)(u,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{modelValue:t.value.created_at_gte,"onUpdate:modelValue":l[0]||(l[0]=e=>t.value.created_at_gte=e),mask:"YYYY-MM-DD"},{default:(0,a.w5)((()=>[(0,a._)("div",g,[(0,a.wy)((0,a.Wm)(n,{label:"Выбрать",color:"primary",flat:""},null,512),[[De]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.Wm)(_,{outlined:"",dense:"",modelValue:t.value.created_at_lte,"onUpdate:modelValue":l[3]||(l[3]=e=>t.value.created_at_lte=e),label:"Отчет до"},{append:(0,a.w5)((()=>[(0,a.Wm)(u,{name:"event",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(i,{modelValue:t.value.created_at_lte,"onUpdate:modelValue":l[2]||(l[2]=e=>t.value.created_at_lte=e),mask:"YYYY-MM-DD"},{default:(0,a.w5)((()=>[(0,a._)("div",v,[(0,a.wy)((0,a.Wm)(n,{label:"Выбрать",color:"primary",flat:""},null,512),[[De]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,a._)("div",y,[(0,a.wy)((0,a.Wm)(n,{class:"q-mb-sm full-width",label:"Применить фильтр",color:"positive",onClick:l[4]||(l[4]=e=>he("apply")),unelevated:"","no-caps":""},null,512),[[De]]),(0,a.wy)((0,a.Wm)(n,{class:"full-width",label:"Сбросить фильтр",color:"dark",onClick:l[5]||(l[5]=e=>he("clear")),unelevated:"","no-caps":""},null,512),[[De]])])]),(0,a._)("p",f,"Количество усилий "+(0,s.zw)(pe.value.login_mark),1),(0,a._)("table",h,[(0,a._)("tr",null,[x,(0,a._)("td",k,(0,s.zw)(pe.value.total_logins),1)]),(0,a._)("tr",null,[z,(0,a._)("td",D,(0,s.zw)(2*pe.value.total_logins),1)]),(0,a._)("tr",null,[q,(0,a._)("td",W,(0,s.zw)(pe.value.login_mark),1)])]),(0,a._)("p",j,[(0,a.Uk)("Качество усилий "),ve.value>0?((0,a.wg)(),(0,a.iD)("span",Z,(0,s.zw)(ve.value),1)):(0,a.kq)("",!0)]),pe.value.tasks?((0,a.wg)(),(0,a.j4)(ke,{key:0,flat:"",rows:pe.value.tasks,columns:ye,"hide-pagination":"","row-key":"id",pagination:ge,"table-header-class":"table-header"},{header:(0,a.w5)((e=>[(0,a.Wm)(me,{props:e,class:"bg-grey-2"},{default:(0,a.w5)((()=>[(0,a.Wm)(ce,{"auto-width":""}),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.cols,(l=>((0,a.wg)(),(0,a.j4)(ce,{key:l.name,props:e},{default:(0,a.w5)((()=>[(0,a._)("span",F,(0,s.zw)(l.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,a.w5)((e=>[(0,a.Wm)(me,{props:e},{default:(0,a.w5)((()=>[(0,a.Wm)(fe,{"auto-width":""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{size:"sm",color:"primary",round:"",unelevated:"",dense:"",onClick:l=>e.expand=!e.expand,icon:e.expand?"visibility_off":"visibility"},null,8,["onClick","icon"])])),_:2},1024),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.cols,(l=>((0,a.wg)(),(0,a.j4)(fe,{key:l.name,props:e},{default:(0,a.w5)((()=>["is_done"===l.name?((0,a.wg)(),(0,a.iD)("span",Q,[l.value?((0,a.wg)(),(0,a.j4)(u,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,a.wg)(),(0,a.j4)(u,{key:1,name:"close",size:"20px",color:"negative"}))])):"is_repeatable"===l.name?((0,a.wg)(),(0,a.iD)("span",V,[l.value?((0,a.wg)(),(0,a.j4)(u,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,a.wg)(),(0,a.j4)(u,{key:1,name:"close",size:"20px",color:"negative"}))])):"priority"===l.name?((0,a.wg)(),(0,a.iD)("span",T,[1===l.value?((0,a.wg)(),(0,a.j4)(xe,{key:0,color:"positive",label:"Низкий"})):2===l.value?((0,a.wg)(),(0,a.j4)(xe,{key:1,color:"warning",label:"Средний"})):3===l.value?((0,a.wg)(),(0,a.j4)(xe,{key:2,color:"negative",label:"Высокий"})):(0,a.kq)("",!0)])):((0,a.wg)(),(0,a.iD)("span",Y,(0,s.zw)(l.value),1))])),_:2},1032,["props"])))),128))])),_:2},1032,["props"]),(0,a.wy)((0,a.Wm)(me,{props:e},{default:(0,a.w5)((()=>[(0,a.Wm)(fe,{colspan:"100%"},{default:(0,a.w5)((()=>[$,(0,a._)("p",null,(0,s.zw)(e.row.task),1),H,(0,a._)("p",null,(0,s.zw)(e.row.result),1)])),_:2},1024)])),_:2},1032,["props"]),[[o.F8,e.expand]])])),_:1},8,["rows"])):(0,a.kq)("",!0),(0,a._)("table",C,[(0,a._)("tr",null,[M,(0,a._)("td",P,(0,s.zw)(be.value.total),1),U]),(0,a._)("tr",null,[L,(0,a._)("td",S,(0,s.zw)(be.value.done),1),(0,a._)("td",B,(0,s.zw)((100*parseFloat(be.value.done/be.value.total)).toFixed(2))+"%",1)]),(0,a._)("tr",null,[I,(0,a._)("td",K,(0,s.zw)(be.value.pending),1),(0,a._)("td",E,(0,s.zw)((100*parseFloat(be.value.pending/be.value.total)).toFixed(2))+"%",1)]),(0,a._)("tr",null,[O,(0,a._)("td",A,(0,s.zw)(be.value.averageTime)+" ч",1),G])]),pe.value.form_result?((0,a.wg)(),(0,a.iD)("div",J,[(0,a._)("p",N,"Операционные показатели "+(0,s.zw)(pe.value.form_rate),1),(0,a._)("table",R,[X,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(pe.value.form_result,((e,l)=>((0,a.wg)(),(0,a.iD)("tr",{key:l},[(0,a._)("td",null,(0,s.zw)(l+1),1),(0,a._)("td",null,(0,s.zw)(e.label),1),(0,a._)("td",null,(0,s.zw)(e.plan_amount),1),(0,a._)("td",null,(0,s.zw)(e.fact_amount),1),(0,a._)("td",null,(0,s.zw)(e.percent_done),1)])))),128))])])):((0,a.wg)(),(0,a.iD)("p",ee,"Назначеных задач не было ")),le,(0,a._)("table",te,[ae,(0,a._)("tr",null,[se,(0,a._)("td",oe,(0,s.zw)(we.value),1),(0,a._)("td",de,(0,s.zw)(pe.value.daily_payment),1),(0,a._)("td",ne,(0,s.zw)(pe.value.period_income),1)]),(0,a._)("tr",null,[ie,(0,a._)("td",re,(0,s.zw)(we.value),1),(0,a._)("td",ue,(0,s.zw)(pe.value.daily_rashod),1),(0,a._)("td",_e,(0,s.zw)(pe.value.period_outcome),1)])]),(0,a.Uk)(" "+(0,s.zw)(be.value),1)])),_:1})}}};var we=t(9885),pe=t(3119),me=t(2857),be=t(2765),ge=t(4939),ve=t(8879),ye=t(1746),fe=t(1233),he=t(1682),xe=t(7220),ke=t(990),ze=t(2146),De=t(9984),qe=t.n(De);const We=ce,je=We;qe()(ce,"components",{QPage:we.Z,QInput:pe.Z,QIcon:me.Z,QPopupProxy:be.Z,QDate:ge.Z,QBtn:ve.Z,QTable:ye.Z,QTr:fe.Z,QTh:he.Z,QTd:xe.Z,QBadge:ke.Z}),qe()(ce,"directives",{ClosePopup:ze.Z})}}]);