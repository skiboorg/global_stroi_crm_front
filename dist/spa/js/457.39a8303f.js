"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[457],{9457:(l,e,a)=>{a.r(e),a.d(e,{default:()=>ll});var u=a(9835),o=a(6970),n=a(499),t=a(1569),d=a(8550),m=a(1862),i=a(9876),s=a(4139),r=a(2637),p=a(8227);const v={class:"flex items-center justify-between q-mb-md"},w=(0,u._)("p",{class:"no-margin text-h6 text-bold"},"Поставщики ",-1),f={class:"row q-col-gutter-md q-mb-md"},_={class:"col-12 col-md-10"},c={class:"col-12 col-md-2"},g={class:"text-bold"},W={key:0},b=["href"],k={key:1},h={key:1},V={class:"q-gutter-md"},q={key:2},U=["href"],y=["href"],Z=["href"],Q={__name:"suppliers",setup(l){(0,i.E)();const e=[{name:"name",align:"left",label:"Наименование поставщика",field:l=>l.name,sortable:!0},{name:"inn",align:"left",label:"ИНН",field:l=>l.inn,sortable:!0},{name:"phone",align:"left",label:"Телефон",field:l=>l.phone,sortable:!0},{name:"email",align:"left",label:"E-Mail",field:l=>l.email,sortable:!0},{name:"file",align:"left",label:"Договор",field:l=>l.file,sortable:!0}],a=(0,n.iH)(!1),Q=(0,n.iH)(!1),x=(0,n.iH)({}),D=((0,n.iH)(null),["Разовый","Нет"]),C=(0,n.iH)({id:null,name:null,inn:null,fio:null,phone:null,email:null,have_dogovor:!1,dogovor_date:null,dogovor_type:null,store_address:null,goods_features:null,link:null}),z={sortBy:"desc",descending:!1,page:1,rowsPerPage:15},H=(0,n.iH)(1),S=(0,n.iH)(!1),T=(0,n.iH)([]),j=(0,n.iH)(5),P=(0,n.iH)(null),F=(0,n.iH)({q:""}),I=async()=>{console.log(H.value),await L()};(0,u.wF)((async()=>{await L()}));const L=async()=>{S.value=!S.value;const l=await(0,t.api)(`/api/catalog/supplier?page=${H.value}&q=${F.value.q}`);T.value=l.data.results,j.value=Math.ceil(l.data.count/15),S.value=!S.value},$=async l=>{await t.api.delete(`/api/catalog/supplier/${l}`),await L()},E=l=>{l?(C.value=l,C.value.dogovor_date=C.value.dogovor_date?new Date(C.value.dogovor_date).toLocaleDateString():null):C.value={id:null,name:null,inn:null,fio:null,phone:null,email:null,have_dogovor:!1,dogovor_date:null,dogovor_type:null,store_address:null,goods_features:null,link:null},a.value=!0},Y=async()=>{let l=new FormData;delete C.value.file;for(let[e,a]of Object.entries(C.value))l.append(e,JSON.stringify(a));if(P.value&&l.append("file",P.value),C.value.id){const e=await(0,t.api)({method:"put",url:`/api/catalog/supplier/${C.value.id}`,data:l,headers:{"Content-Type":"multipart/form-data"}});console.log(e.data),await L(),(0,r.d)("positive","Поставщик успешно обновлен")}else{await(0,t.api)({method:"post",url:"/api/catalog/supplier",data:l,headers:{"Content-Type":"multipart/form-data"}});(0,r.d)("positive","Поставщик успешно создан"),await L()}a.value=!1},B=l=>{C.value.dogovor_date=new Date(l).toLocaleDateString()};return(l,n)=>{const t=(0,u.up)("q-card-section"),i=(0,u.up)("q-card"),r=(0,u.up)("q-expansion-item"),K=(0,u.up)("q-space"),M=(0,u.up)("q-input"),O=(0,u.up)("q-btn"),A=(0,u.up)("q-th"),J=(0,u.up)("q-tr"),N=(0,u.up)("q-td"),G=(0,u.up)("q-table"),R=(0,u.up)("q-pagination"),X=(0,u.up)("q-page"),ll=(0,u.up)("q-checkbox"),el=(0,u.up)("q-select"),al=(0,u.up)("q-file"),ul=(0,u.up)("q-card-actions"),ol=(0,u.up)("q-form"),nl=(0,u.up)("q-dialog"),tl=(0,u.up)("q-item-section"),dl=(0,u.up)("q-item"),ml=(0,u.up)("q-list"),il=(0,u.Q2)("close-popup");return(0,u.wg)(),(0,u.iD)(u.HY,null,[(0,u.Wm)(X,{padding:""},{default:(0,u.w5)((()=>[(0,u.Wm)(r,{"expand-separator":"",icon:"help",label:"Описание раздела",class:"q-mb-md"},{default:(0,u.w5)((()=>[(0,u.Wm)(i,null,{default:(0,u.w5)((()=>[(0,u.Wm)(t,null,{default:(0,u.w5)((()=>[(0,u.Uk)(" В данный раздел вносятся данные всех Поставщиков товаров и услуг для нужд организации, с обязательным добавлением электронного образа договора (счета на оплату) ")])),_:1})])),_:1})])),_:1}),(0,u._)("div",v,[w,(0,u.Wm)(K),(0,u.Wm)(d.Z,{icon:"add",label:"Добавить",onClick:n[0]||(n[0]=l=>E(null))})]),(0,u._)("div",f,[(0,u._)("div",_,[(0,u.Wm)(M,{dense:"",modelValue:F.value.q,"onUpdate:modelValue":n[1]||(n[1]=l=>F.value.q=l),label:"Поиск по наименованию, инн, фио, телефону",outlined:""},null,8,["modelValue"])]),(0,u._)("div",c,[(0,u.Wm)(O,{class:"full-width",label:"Найти","no-caps":"",color:"primary",unelevated:"",onClick:L})])]),(0,u.Wm)(G,{flat:"",rows:T.value,columns:e,"row-key":"name","hide-pagination":"",pagination:z,"onUpdate:pagination":n[2]||(n[2]=l=>z=l),loading:S.value,"table-header-class":"table-header"},{header:(0,u.w5)((l=>[(0,u.Wm)(J,{props:l,class:"bg-grey-2"},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(l.cols,(e=>((0,u.wg)(),(0,u.j4)(A,{key:e.name,props:l},{default:(0,u.w5)((()=>[(0,u._)("span",g,(0,o.zw)(e.label),1)])),_:2},1032,["props"])))),128)),(0,u.Wm)(A,{"auto-width":""})])),_:2},1032,["props"])])),body:(0,u.w5)((l=>[(0,u.Wm)(J,{props:l},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(l.cols,(e=>((0,u.wg)(),(0,u.j4)(N,{key:e.name,onClick:e=>(x.value=l.row,Q.value=!0),props:l},{default:(0,u.w5)((()=>["file"===e.name?((0,u.wg)(),(0,u.iD)("span",W,[e.value?((0,u.wg)(),(0,u.iD)("a",{key:0,href:e.value,target:"_blank"},"Открыть",8,b)):((0,u.wg)(),(0,u.iD)("span",k,"Нет"))])):((0,u.wg)(),(0,u.iD)("span",h,(0,o.zw)(e.value),1))])),_:2},1032,["onClick","props"])))),128)),(0,u.Wm)(N,{"auto-width":""},{default:(0,u.w5)((()=>[(0,u._)("div",V,[(0,u.Wm)(m.Z,{dense:"",onClick:e=>E(l.row)},null,8,["onClick"]),(0,u.Wm)(p.Z,{onConfirm:e=>$(l.row.id)},null,8,["onConfirm"])])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","loading"]),(0,u.Wm)(R,{modelValue:H.value,"onUpdate:modelValue":[n[3]||(n[3]=l=>H.value=l),I],max:j.value,"max-pages":6,"direction-links":"","boundary-numbers":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])),_:1}),(0,u.Wm)(nl,{modelValue:a.value,"onUpdate:modelValue":n[16]||(n[16]=l=>a.value=l)},{default:(0,u.w5)((()=>[(0,u.Wm)(i,{style:{width:"700px","max-width":"100vw"}},{default:(0,u.w5)((()=>[(0,u.Wm)(ol,{onSubmit:Y},{default:(0,u.w5)((()=>[(0,u.Wm)(t,{class:"q-pb-none"},{default:(0,u.w5)((()=>[(0,u.Wm)(M,{outlined:"",dense:"",label:"Наименование",modelValue:C.value.name,"onUpdate:modelValue":n[4]||(n[4]=l=>C.value.name=l),"lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,u.Wm)(M,{outlined:"",dense:"",label:"ИНН",modelValue:C.value.inn,"onUpdate:modelValue":n[5]||(n[5]=l=>C.value.inn=l),"lazy-rules":"",rules:[l=>null!==l&&""!==l||"Это обязательное поле"]},null,8,["modelValue","rules"]),(0,u.Wm)(M,{class:"q-mb-md",outlined:"",dense:"",label:"ФИО",modelValue:C.value.fio,"onUpdate:modelValue":n[6]||(n[6]=l=>C.value.fio=l)},null,8,["modelValue"]),(0,u.Wm)(M,{class:"q-mb-md",outlined:"",dense:"",label:"Телефон",mask:"+7 (###) ###-##-##","fill-mask":"",modelValue:C.value.phone,"onUpdate:modelValue":n[7]||(n[7]=l=>C.value.phone=l)},null,8,["modelValue"]),(0,u.Wm)(M,{class:"q-mb-md",outlined:"",dense:"",label:"Почта",modelValue:C.value.email,"onUpdate:modelValue":n[8]||(n[8]=l=>C.value.email=l)},null,8,["modelValue"]),(0,u.Wm)(M,{class:"q-mb-md",outlined:"",dense:"",label:"Ссылка",modelValue:C.value.link,"onUpdate:modelValue":n[9]||(n[9]=l=>C.value.link=l)},null,8,["modelValue"]),(0,u.Wm)(ll,{class:"q-mb-md",label:"Есть договор",modelValue:C.value.have_dogovor,"onUpdate:modelValue":n[10]||(n[10]=l=>C.value.have_dogovor=l)},null,8,["modelValue"]),C.value.have_dogovor?((0,u.wg)(),(0,u.j4)(s.Z,{key:0,dense:"",class:"q-mb-md",modelValue:C.value.dogovor_date,"onUpdate:modelValue":n[11]||(n[11]=l=>C.value.dogovor_date=l),label:"Дата заключения",onSelected:B},null,8,["modelValue"])):(0,u.kq)("",!0),C.value.have_dogovor?((0,u.wg)(),(0,u.j4)(el,{key:1,outlined:"",dense:"","map-options":"","emit-value":"",behavior:"menu",class:"q-mb-md",modelValue:C.value.dogovor_type,"onUpdate:modelValue":n[12]||(n[12]=l=>C.value.dogovor_type=l),options:D,label:"Тип договора"},null,8,["modelValue"])):(0,u.kq)("",!0),(0,u.Wm)(M,{class:"q-mb-md",type:"textarea",outlined:"",dense:"",label:"Адрес склада для самовывоза",modelValue:C.value.store_address,"onUpdate:modelValue":n[13]||(n[13]=l=>C.value.store_address=l)},null,8,["modelValue"]),(0,u.Wm)(M,{class:"q-mb-md",type:"textarea",outlined:"",dense:"",label:"Особенности получения грузов",modelValue:C.value.goods_features,"onUpdate:modelValue":n[14]||(n[14]=l=>C.value.goods_features=l)},null,8,["modelValue"]),C.value.file?((0,u.wg)(),(0,u.iD)("p",q,[(0,u._)("a",{href:C.value.file,target:"_blank"},"Загруженный ранее файл",8,U)])):(0,u.kq)("",!0),(0,u.Wm)(al,{class:"q-mb-md",outlined:"",dense:"",label:"Файл",modelValue:P.value,"onUpdate:modelValue":n[15]||(n[15]=l=>P.value=l)},null,8,["modelValue"])])),_:1}),(0,u.Wm)(ul,{align:"center"},{default:(0,u.w5)((()=>[(0,u.Wm)(O,{label:"Сохранить",type:"submit","no-caps":"",color:"positive"}),(0,u.wy)((0,u.Wm)(O,{label:"Отмена","no-caps":"",color:"dark"},null,512),[[il]])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,u.Wm)(nl,{modelValue:Q.value,"onUpdate:modelValue":n[17]||(n[17]=l=>Q.value=l)},{default:(0,u.w5)((()=>[(0,u.Wm)(i,{style:{width:"700px","max-width":"100vw"}},{default:(0,u.w5)((()=>[(0,u.Wm)(t,null,{default:(0,u.w5)((()=>[(0,u.Wm)(ml,{separator:""},{default:(0,u.w5)((()=>[(0,u.Wm)(dl,null,{default:(0,u.w5)((()=>[(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Наименование")])),_:1}),(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(x.value.name),1)])),_:1})])),_:1}),(0,u.Wm)(dl,null,{default:(0,u.w5)((()=>[(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("ИНН")])),_:1}),(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(x.value.inn),1)])),_:1})])),_:1}),(0,u.Wm)(dl,null,{default:(0,u.w5)((()=>[(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("ФИО")])),_:1}),(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(x.value.fio),1)])),_:1})])),_:1}),(0,u.Wm)(dl,null,{default:(0,u.w5)((()=>[(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Телефон")])),_:1}),(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(x.value.phone),1)])),_:1})])),_:1}),(0,u.Wm)(dl,null,{default:(0,u.w5)((()=>[(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Почта")])),_:1}),(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(x.value.email),1)])),_:1})])),_:1}),(0,u.Wm)(dl,null,{default:(0,u.w5)((()=>[(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Наличие договора")])),_:1}),(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(x.value.have_dogovor),1)])),_:1})])),_:1}),(0,u.Wm)(dl,null,{default:(0,u.w5)((()=>[(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Дата заключения")])),_:1}),(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(new Date(x.value.dogovor_date).toLocaleDateString()),1)])),_:1})])),_:1}),(0,u.Wm)(dl,null,{default:(0,u.w5)((()=>[(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Тип договора")])),_:1}),(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(x.value.dogovor_type),1)])),_:1})])),_:1}),(0,u.Wm)(dl,null,{default:(0,u.w5)((()=>[(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Адрес склада для самовывоза")])),_:1}),(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(x.value.store_address),1)])),_:1})])),_:1}),(0,u.Wm)(dl,null,{default:(0,u.w5)((()=>[(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Особенности получения грузов")])),_:1}),(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)((0,o.zw)(x.value.goods_features),1)])),_:1})])),_:1}),(0,u.Wm)(dl,null,{default:(0,u.w5)((()=>[(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Ссылка")])),_:1}),(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[x.value.link?((0,u.wg)(),(0,u.iD)("a",{key:0,href:x.value.link,target:"_blank"},"Открыть",8,y)):(0,u.kq)("",!0)])),_:1})])),_:1}),(0,u.Wm)(dl,null,{default:(0,u.w5)((()=>[(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[(0,u.Uk)("Файл")])),_:1}),(0,u.Wm)(tl,null,{default:(0,u.w5)((()=>[x.value.file?((0,u.wg)(),(0,u.iD)("a",{key:0,href:x.value.file,target:"_blank"},"Открыть",8,Z)):(0,u.kq)("",!0)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}}};var x=a(9885),D=a(651),C=a(4458),z=a(3190),H=a(136),S=a(3119),T=a(8879),j=a(1746),P=a(1233),F=a(1682),I=a(7220),L=a(996),$=a(2074),E=a(8326),Y=a(1006),B=a(6384),K=a(9420),M=a(1821),O=a(3246),A=a(490),J=a(6749),N=a(2146),G=a(9984),R=a.n(G);const X=Q,ll=X;R()(Q,"components",{QPage:x.Z,QExpansionItem:D.Z,QCard:C.Z,QCardSection:z.Z,QSpace:H.Z,QInput:S.Z,QBtn:T.Z,QTable:j.Z,QTr:P.Z,QTh:F.Z,QTd:I.Z,QPagination:L.Z,QDialog:$.Z,QForm:E.Z,QCheckbox:Y.Z,QSelect:B.Z,QFile:K.Z,QCardActions:M.Z,QList:O.Z,QItem:A.Z,QItemSection:J.Z}),R()(Q,"directives",{ClosePopup:N.Z})}}]);