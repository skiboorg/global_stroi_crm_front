"use strict";(globalThis["webpackChunkglobal_stroi_crm_front"]=globalThis["webpackChunkglobal_stroi_crm_front"]||[]).push([[502],{8203:(e,l,a)=>{a.d(l,{Z:()=>c});var t=a(9835);function o(e,l){const a=(0,t.up)("q-btn");return(0,t.wg)(),(0,t.j4)(a,{"no-caps":"",outline:"",color:"primary",label:"Назад",icon:"arrow_back",class:"q-mr-md",onClick:l[0]||(l[0]=l=>e.$router.back())})}var s=a(1639),n=a(8879),d=a(9984),r=a.n(d);const i={},u=(0,s.Z)(i,[["render",o]]),c=u;r()(i,"components",{QBtn:n.Z})},3502:(e,l,a)=>{a.r(l),a.d(l,{default:()=>re});var t=a(9835),o=a(6970),s=a(1957),n=a(8203),d=a(1569),r=a(499),i=a(8339),u=a(9876);const c={class:"flex items-center q-mb-lg"},_={class:"no-margin text-h6 text-bold"},p={class:"row q-col-gutter-md q-mb-md"},w={class:"col-12 col-md-3"},m={class:"row items-center justify-end"},b={class:"row items-center justify-end"},v={class:"col-12 col-md-3"},g={class:"text-h6 text-bold"},y={class:"info-table full-width q-mb-lg"},f=(0,t._)("td",{style:{width:"50%"},class:"text-bold"},"Количество авторизаций в системе, штук",-1),k={style:{width:"50%"}},h=(0,t._)("td",{style:{width:"50%"},class:"text-bold"},"Общее время в системе, часов",-1),x={style:{width:"50%"}},q=(0,t._)("td",{style:{width:"50%"},class:"text-bold"},"Оценка",-1),D={style:{width:"50%"}},z={class:"text-h6 text-bold"},W={key:0},j={class:"text-bold"},Z={key:0},Q={key:1},V={key:2},Y={key:3},C=(0,t._)("p",{class:"text-bold q-mb-sm"},"Задача: ",-1),H=(0,t._)("p",{class:"text-bold q-mb-sm"},"Результат выполнения задачи",-1),P={key:1,class:"q-mb-lg"},T={class:"text-h6 text-bold"},U={class:"info-table full-width"},$=(0,t._)("tr",null,[(0,t._)("td",{class:"text-bold"},"№"),(0,t._)("td",{class:"text-bold"},"Вопрос"),(0,t._)("td",{class:"text-bold"},"План"),(0,t._)("td",{class:"text-bold"},"Факт"),(0,t._)("td",{class:"text-bold"},"в%")],-1),B={key:2},F=(0,t._)("p",{class:"text-h6 text-bold"},"Финансовые показатели",-1),M={class:"info-table full-width q-mb-lg"},I=(0,t._)("td",{style:{width:"50%"}},"Заработная плата сотрудника на руки",-1),K={style:{width:"50%"},class:"text-bold"},L=(0,t._)("td",{style:{width:"50%"}},"Расходы организации на сотрудника",-1),S={style:{width:"50%"},class:"text-bold"},E={__name:"report",setup(e){(0,u.E)();const l=(0,r.iH)({user__id:null,created_at_gte:null,created_at_lte:null}),a=(0,i.yj)(),E=(0,r.iH)([]),O=(0,r.iH)(""),A={sortBy:"desc",descending:!1,page:1,rowsPerPage:50},G=(0,r.iH)(0),J=[{name:"id",align:"left",label:"ID",field:e=>e.id,sortable:!0},{name:"created_at",align:"left",label:"Дата",field:e=>new Date(e.created_at).toLocaleDateString(),sortable:!0},{name:"priority",align:"left",label:"Приоритет",field:e=>e.priority,sortable:!0},{name:"is_done",align:"left",label:"Выполнено",field:e=>e.is_done,sortable:!0},{name:"task_value",align:"left",label:"Оценка",field:e=>e.task_value?e.task_value:"Нет",sortable:!0},{name:"task_value",align:"left",label:"Комент",field:e=>e.user_comment?e.user_comment:"Нет",sortable:!0}];(0,t.wF)((async()=>{let e=new Date;e.setDate(e.getDate()-1),l.value.created_at_gte=e.toLocaleDateString().split(".").reverse().join("-"),l.value.created_at_lte=e.toLocaleDateString().split(".").reverse().join("-"),await R("apply")}));const N=async()=>{console.log("query_string",O.value),console.log("filters",l.value);const e=await(0,d.api)(`/api/report/by_user?user_id=${a.params.user_id}&${O.value}`);console.log("data",e.data.tasks),E.value=e.data;let t=0,o=0;for(let l of e.data?.tasks)l.task_value&&(t+=l.task_value,o+=1);G.value=t>0?parseFloat(t/o).toFixed(0):0},R=async e=>{if(O.value="","apply"===e)for(let[a,t]of Object.entries(l.value))console.log(a,t),t&&(O.value+=`${a}=${t}&`);"clear"===e&&(O.value="",l.value={created_at_gte:null,created_at_lte:null}),await N()};return(e,a)=>{const d=(0,t.up)("q-btn"),r=(0,t.up)("q-date"),i=(0,t.up)("q-popup-proxy"),u=(0,t.up)("q-icon"),O=(0,t.up)("q-input"),N=(0,t.up)("q-th"),X=(0,t.up)("q-tr"),ee=(0,t.up)("q-td"),le=(0,t.up)("q-badge"),ae=(0,t.up)("q-table"),te=(0,t.up)("q-page"),oe=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(te,{padding:""},{default:(0,t.w5)((()=>[(0,t._)("div",c,[(0,t.Wm)(n.Z),(0,t._)("p",_,"Отчет пользователя "+(0,o.zw)(E.value.user),1)]),(0,t._)("div",p,[(0,t._)("div",w,[(0,t.Wm)(O,{class:"q-mb-xs",outlined:"",dense:"",modelValue:l.value.created_at_gte,"onUpdate:modelValue":a[1]||(a[1]=e=>l.value.created_at_gte=e),label:"Отчет с"},{append:(0,t.w5)((()=>[(0,t.Wm)(u,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:l.value.created_at_gte,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value.created_at_gte=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",m,[(0,t.wy)((0,t.Wm)(d,{label:"Выбрать",color:"primary",flat:""},null,512),[[oe]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(O,{outlined:"",dense:"",modelValue:l.value.created_at_lte,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.created_at_lte=e),label:"Отчет до"},{append:(0,t.w5)((()=>[(0,t.Wm)(u,{name:"event",class:"cursor-pointer"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:l.value.created_at_lte,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.created_at_lte=e),mask:"YYYY-MM-DD"},{default:(0,t.w5)((()=>[(0,t._)("div",b,[(0,t.wy)((0,t.Wm)(d,{label:"Выбрать",color:"primary",flat:""},null,512),[[oe]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,t._)("div",v,[(0,t.wy)((0,t.Wm)(d,{class:"q-mb-sm full-width",label:"Применить фильтр",color:"positive",onClick:a[4]||(a[4]=e=>R("apply")),unelevated:"","no-caps":""},null,512),[[oe]]),(0,t.wy)((0,t.Wm)(d,{class:"full-width",label:"Сбросить фильтр",color:"dark",onClick:a[5]||(a[5]=e=>R("clear")),unelevated:"","no-caps":""},null,512),[[oe]])])]),(0,t._)("p",g,"Количество усилий "+(0,o.zw)(E.value.login_mark),1),(0,t._)("table",y,[(0,t._)("tr",null,[f,(0,t._)("td",k,(0,o.zw)(E.value.total_logins),1)]),(0,t._)("tr",null,[h,(0,t._)("td",x,(0,o.zw)(2*E.value.total_logins),1)]),(0,t._)("tr",null,[q,(0,t._)("td",D,(0,o.zw)(E.value.login_mark),1)])]),(0,t._)("p",z,[(0,t.Uk)("Качество усилий "),G.value>0?((0,t.wg)(),(0,t.iD)("span",W,(0,o.zw)(G.value),1)):(0,t.kq)("",!0)]),E.value.tasks?((0,t.wg)(),(0,t.j4)(ae,{key:0,flat:"",rows:E.value.tasks,columns:J,"row-key":"id",pagination:A,"table-header-class":"table-header"},{header:(0,t.w5)((e=>[(0,t.Wm)(X,{props:e,class:"bg-grey-2"},{default:(0,t.w5)((()=>[(0,t.Wm)(N,{"auto-width":""}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(N,{key:l.name,props:e},{default:(0,t.w5)((()=>[(0,t._)("span",j,(0,o.zw)(l.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,t.w5)((e=>[(0,t.Wm)(X,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(ee,{"auto-width":""},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{size:"sm",color:"primary",round:"",unelevated:"",dense:"",onClick:l=>e.expand=!e.expand,icon:e.expand?"visibility_off":"visibility"},null,8,["onClick","icon"])])),_:2},1024),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.cols,(l=>((0,t.wg)(),(0,t.j4)(ee,{key:l.name,props:e},{default:(0,t.w5)((()=>["is_done"===l.name?((0,t.wg)(),(0,t.iD)("span",Z,[l.value?((0,t.wg)(),(0,t.j4)(u,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,t.wg)(),(0,t.j4)(u,{key:1,name:"close",size:"20px",color:"negative"}))])):"is_repeatable"===l.name?((0,t.wg)(),(0,t.iD)("span",Q,[l.value?((0,t.wg)(),(0,t.j4)(u,{key:0,name:"check_circle",size:"20px",color:"positive"})):((0,t.wg)(),(0,t.j4)(u,{key:1,name:"close",size:"20px",color:"negative"}))])):"priority"===l.name?((0,t.wg)(),(0,t.iD)("span",V,[1===l.value?((0,t.wg)(),(0,t.j4)(le,{key:0,color:"positive",label:"Низкий"})):2===l.value?((0,t.wg)(),(0,t.j4)(le,{key:1,color:"warning",label:"Средний"})):3===l.value?((0,t.wg)(),(0,t.j4)(le,{key:2,color:"negative",label:"Высокий"})):(0,t.kq)("",!0)])):((0,t.wg)(),(0,t.iD)("span",Y,(0,o.zw)(l.value),1))])),_:2},1032,["props"])))),128))])),_:2},1032,["props"]),(0,t.wy)((0,t.Wm)(X,{props:e},{default:(0,t.w5)((()=>[(0,t.Wm)(ee,{colspan:"100%"},{default:(0,t.w5)((()=>[C,(0,t._)("p",null,(0,o.zw)(e.row.task),1),H,(0,t._)("p",null,(0,o.zw)(e.row.result),1)])),_:2},1024)])),_:2},1032,["props"]),[[s.F8,e.expand]])])),_:1},8,["rows"])):(0,t.kq)("",!0),E.value.form_result?((0,t.wg)(),(0,t.iD)("div",P,[(0,t._)("p",T,"Операционные показатели "+(0,o.zw)(E.value.form_rate),1),(0,t._)("table",U,[$,((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(E.value.form_result,((e,l)=>((0,t.wg)(),(0,t.iD)("tr",{key:l},[(0,t._)("td",null,(0,o.zw)(l+1),1),(0,t._)("td",null,(0,o.zw)(e.label),1),(0,t._)("td",null,(0,o.zw)(e.plan_amount),1),(0,t._)("td",null,(0,o.zw)(e.fact_amount),1),(0,t._)("td",null,(0,o.zw)(e.percent_done),1)])))),128))])])):((0,t.wg)(),(0,t.iD)("p",B,"Назначеных задач не было ")),F,(0,t._)("table",M,[(0,t._)("tr",null,[I,(0,t._)("td",K,(0,o.zw)(E.value.period_income),1)]),(0,t._)("tr",null,[L,(0,t._)("td",S,(0,o.zw)(E.value.period_outcome),1)])])])),_:1})}}};var O=a(9885),A=a(3119),G=a(2857),J=a(2765),N=a(2535),R=a(8879),X=a(1746),ee=a(1233),le=a(1682),ae=a(7220),te=a(990),oe=a(2146),se=a(9984),ne=a.n(se);const de=E,re=de;ne()(E,"components",{QPage:O.Z,QInput:A.Z,QIcon:G.Z,QPopupProxy:J.Z,QDate:N.Z,QBtn:R.Z,QTable:X.Z,QTr:ee.Z,QTh:le.Z,QTd:ae.Z,QBadge:te.Z}),ne()(E,"directives",{ClosePopup:oe.Z})}}]);